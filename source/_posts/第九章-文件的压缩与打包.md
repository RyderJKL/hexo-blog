---
title: 第九章-文件的压缩与打包
date: 2016-05-24 23:48:52
tags: ['鸟哥的Linux读书笔记基础篇']
toc: true
categories: technology

---
### 0x00 常见的压缩命令
linux中文件扩展名并么有多大的意义，但是为了方便人类的记忆我们还是将几种常用的压缩文件扩展名罗列如下：
```
.zip zip压缩的文件
.gz gzip压缩的文件
.bz2 bzip2 压缩的文件
.tar tar程序打包的文件，并么有压缩过
.tar.gz tar程序打包的文件，并且经过gzip压缩过
.tar.bz2 tar程序打包的文件，并经过bzip2压缩过
.tar.xz tar打包，xz压缩的文件
```
compress已经被gzip取代，而bzip2的作用则是为了取代gzip的。而不管是gzip还是bgzip2多只能对一个单一的文件进行压缩，而tat则可以将一些文件，或者目录打包到一起，两者结合，天下无双。

---
#### gzip，zcat/zmore/zless/zgrep
gzip命令没有压缩参数，会默认自动进行压缩。

__选项与参数 {Usage $: gzip -[cdtc] filename}__

* -k:保留源文件
* -d:解压缩
* -c:将压缩资料显示在屏幕上，可结合数据流重定向来处理
* v:显示压缩比等信息

```
➜  c_programer gzip -kv queue.c 
queue.c:	 35.6% -- replaced with queue.c.gz
➜  c_programer ls
queue.c queue.c.gz
```


---
#### bzip2,bzcat/bzmore/bzless/bzgrep
bzip2系列是作为gzip系列的升级版的，其使用方法与gzip一样，同样续的xz系列是bzip2的升级版，它是它们彼此之间好像并不兼容。当然每升级一级对应的压缩比例将更好，但是消耗的时间也会更多这里我们以bzip2系列进行记录。

##### bzip2
__选项与参数:{ Usage $: bzip2 [-cdkzv] filename }__
* -c:将解压过程产生的数据输出到屏幕上
* -d: 解压
* -z: 压缩
* -k: 保留原始文件

```
#不加-k参数将不会保留源文件
➜  c_programer bzip2 -z hello.c
  c_programer ls                
 hello.c.bz2  
#加入-k参数
➜  c_programer bzip2 -kz hello.c 
➜  c_programer ls
   hello.c  hello.c.bz2  
```
##### bzcat
__{ Usage $: bzcat filename.bz2 }__

我们知道cat命令可以读取纯文本文件，而bzcat作为zcat的升级版其作用是读取被压缩过的纯文本文件内容。
```
#使用bzcat查看hell.c.bz2
➜  c_programer bzcat hello.c.bz2 
#include<stdio.h>
int main(){
  printf("hello world!");
  return 0;
}
```

##### bzgrep 
bzgrep可以直接从文字压缩文件中查找关键字，而不需要将文件解压再以grep进行筛选。
```
➜  c_programer bzgrep -n 'include' queue.c.bz2 
1:#include<stdio.h>
```

---
#### xz,xzcat/xzmore/xzless/xzgrep

---
### 0x01 打包命令
tar 可以将多个目录或文件打包成一个大文件，同时还可以透过 gzip/bzip2 的支持，将该文件同时进行压缩。

__选项与参数:__
* 压缩:{ Usage $: tar [-z|-j|-J] [-cv] 要压缩的文件或者目录 -f filename.tar.* }
* 查询:{ Usage $: tar -[-z|-j|-J] [-tv] -f filename.tar.* }
* 解压:{ Usage $: tar [-z|-j|-J] [-xv] 要解压到的的包 -f filename.tar.bz2 -C 解压到哪个目录 }
其中:
-z|-j|-J：表示使用gzip,bzip2,xz技术
-c：表示创建打包文件，-v将显示正在处理的文件名称
-t：表示打包的文件中包含哪些文件名
-x：表示解压缩
-p：将保留源文件原本的权限与属性
-P：表示保留绝对路径

---
#### 使用tar将/etc目录打包到/tmp下
```
$: tar -jcv /etc -f /tmp/etc.tar.bz2 
➜  / ls /tmp 
etc.tar.bz2
```
---
#### 查看etc.tar.bz2里的文件名
```
➜  / tar -jtvf /tmp/etc.tar.bz2 
drwxr-xr-x root/root             0 2016-05-21 01:48 etc/resolvconf/update-libc.d/
。。。。。
```
---
#### 将etc.tar.bz2解压懂到/tpm/etc下
```
#使用-C时 要确认要解压到的目录是否存在，否则解压失败
➜  /tmp tar -jxv -f etc.tar.bz2 -C /tmp/etc
```
---
#### 配合grep命令解压单一文件
```
➜  /tmp tar -jxv -f etc.tar.bz2 | grep 'etc/udev'
etc/udev/
etc/udev/rules.d/
```
---
##### 打包某目录但是该目录下的某些除外
打包整个/tmp并命名为tmp.tar.gz2存放在/tmp同时不要打包bao本身，并且也不要打包/tmp/ect *的所有文件
```
➜  /tmp tar -jcv /tmp -f /tmp/tmp.tar.gz2 --exclude=tmp.tar.gz2 --exclude=/tmp/etc *
```
---
#### 仅仅备份比某个时刻新的文件
```
#找出比/etc/passwd的mtime还要新的文件
$: find /etc -newer /etc/passwd
#得到/etc/passwd的mtime
$:  ll /etc/passwd
-rw-r--r-- 1 root root 2944 5月  23 20:54 /etc/passwd
#打包比5/23还要新的文件
$: tar -jcv -f /root/etc.newer.then.passwd.tar.bz2 \\--newer-mtime="2016/04/22" /etc/*
```
---
#### 将数据打包到usb
```
$: tar -jcv /root/document/ -f /dev/usb1/data.tar.gz
```
---
### 利用管道与数据流
比如将待处理的文件一边打包一边解压到目标目录中
```
➜  /tmp tar -cvf- /etc | tar -xvf-
#类似与cp -r /etc /tmp，但是tar也有自己的用途
```


---
### 0x04 其它常见的压缩与备份工具
---
#### dd
dd可以直接读取磁盘，几乎是直接读取磁区的，然后将其整个备份。

__选项与参数{ Usage $: dd if=" " of=" " bs=" " count=" " }__
* if:即input file，可以是装置
* of:即output file，可以是装置
* bs:划分以block的大小，默认是512bytes
* count:多少个bs的

将/etc/passwd文件刻录到/tmp/passwd.back中
```
➜  /tmp dd if=/etc/passwd of=/tmp/passwd.back
记录了5+1 的读入
记录了5+1 的写出
2944字节(2.9 kB)已复制，0.000241941 秒，12.2 MB/秒
```
将iso镜像文件刻录到usb中
```
➜  /tmp dd if=/tmp/kail.iso of=/dev/sda
```


