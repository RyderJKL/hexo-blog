# DOM 基础

title: JS-DOM(1)DOM基础
date: 2016-10-13
tags: ['JavaScript','DOM']
toc: true
categories: technology

---

## 0x00 What's DOM

DOM(文档对象模型) 是针对 HTML 和 XML 文档的一个 API(Application Programing Interface 应用程序编程接口)。

DOM 描绘了一个层次化的节点数，允许开发人员添加，修改和移除页面的某一部分。

!> 注意 IE 中的所有 DOM 对象都是以 COM 对象的形式实现的，这意味着 IE 中的 DOM 对象与原生的 JS 对象的行为或活动点特点并不一致。

---

## 0x01 Node 类型

每一个节点都有一个`childNodes`属性，其中保存着一个`NodeList`对象。`NodeList`是一种类数组对象，用于保存一组有序的节点。

每个节点都有一个`NodeType`属性，用于表明节点类型。

`Node`一共有十二种节点类型，下面是常用的几种:

* Document 类型的节点类型为: 9
* Element 的节点类型: 1
* 文本节点的节点类型: 3

### 访问 Node

* someNode.nodeName:   获取节点名称
* someNode.nodeValue:   获取节点名称
* someNode.nodeType:   获取节点类型
* someNode.childNodes: 获取标签内所有节点
* someNode.children:   只获取标签类型的节点
* someNode.parentNode: 获取元素父级节点
* somdeNode.nextElementSibling:    获取下一个同级标签节点
* someNode.nextSibling:            获取下一个同级节点，不限节点类型
* someNode.previousElementSibling: 获取上一个同级标签节点
* someNode.previousSibling:        获取上一个同级节点，不限节点类型
* someNode.firstElementChild:      获取第一个子标签元素
* someNode.firstChild:             获取第一个子节点
* someNode.lastElementChild:       获取最后一个子标签元素
* someNode.lastChild:              获取最后一个子节点

关于`nodeName`和`nodeValue`属性:

`nodeName`和`nodeValue`这两个属性的值完全取决于节点类型，比如，对于元素节点，`nodeName`得到是元素的标签名，`nodeValue`得到永远是`null`。

```js
if (someNode.nodeType === 1) {
    value = somdeNode.nodeValue
}
```

### 操作 Node


###### appendChild()

向 childNodes 列表末尾添加一个节点

```
var newLi = document.createElement("li");
var newSpan = document.createElement("span");
newSpan.innerHTML = "我是 span";
newLi.appendChild(newSpan);
```

`appendChild()` 无法对类选择器等类数组形式的元素进行批量操作。

###### insertBefore()
该方法接收两个参数: 要插入的节点和作为参考的节点。

```
var ul = document.querySelector("ul");
var newLi = document.createElement("li");
var newSpan = document.createElement("span");
newLi.appendChild(newSpan);
ul.insertBefore(newLi,ul.firstChild);
```

###### replaceChild()
该方法接收两个参数： 要插入的节点和要替换的节点。

```
var ul = document.querySelector("ul");
var newLi = document.createElement("li");
ul.replaceChild(newLi,ul.firstChild);
// 替换第一个节点
ul.replaceChild(newLi,ul.lastChild);
// 替换最后一个节点
```

###### removeChild()
只接受一参数，即要移除的节点。

```
ul.removeChild(ul.firstChild);
```

以上四个操作方法都是某个节点的子节点，要使用这几个方法，必需先取得父节点。另外，并不是所有类型的节点都有子节点。以下两种方式则针对所有节点。

###### coloneNode()
该方法只接收一个布尔值作为参数，当参数为 `true` 则进行深层复制，当参数为 `flase` 则进行浅层复制。

```
var div = document.querySelector("#div");
var newDiv = div.cloneNode(true);
document.body.appendChild(newDiv);
```

> cloneNode() 方法不会复制添加到 DOM 中的 JavaScript 属性。

---
#### 属性操作

###### getAttribute()/setAttribute()
getAttribut() 方法用于获取元素的属性； setAttribute() 方法用户设置元素的属性。

一个经典场景是，用于网页换肤。

```
<link type = "text/css" href = "style.css">

<script>
    var link = document.querySelector("link");
    link.setAttribute("href","style2.css");
</script>
```

---
### 0x01 Document 类型
JS 使用 Document 类型表示文档。在浏览器中，document 对象是 HTMLDocument(继承自 Document 类型)的一个实例，以此表示整个 HTML 页面。而且，document 对象是 window 对象的一个属性。

---
#### 访问文档子节点
在 DOM 中最常用也是最快捷的访问子节点的方式是使用 **documentElement**　属性。该属性始终指向　HTML 页面中的 <html> 元素。


```
var html = document.documentElement; //取得对 <html> 的引用
var body = document.body;            //取得对 <body> 的引用
```

---
### 文档信息
document 对象作为 Document 对象的一个实例还具备了 Document 对象所没有的属性。 这些属性提供了 document 对象所表现的网页的一些信息。比如 `title`, `URL`, `domain`, `referrer`.

URL 属性包含完整的 URL（地址栏中显示的 URL），domain 属性只包含页面的域名，而 referrer 属性中保存着链接到当前页面的那个页面的 URL。所有的这些信息都存在于 HTTP 头部，只不过是通过这些属性让我们能够在 JS 中访问它而已。

```
var title = document.title;
// 获得文档标题
var url = document.URL;
// 获得完整 URL
var referrer = document.referrer;
// 获得来源页面的 URL
```


---
### 0x02 Element 类型
除 Document 类型外，Element 类型就算是 Web 编程中最常用的类型了。Element 类型用于表现 XML 或者 HTML 元素，提供了对元素标签名，子节点及特性的访问。

---
#### HTML 元素
所有的 HTML 元素都由 HTMLElement 类型表示，不是直接通过这个类型，也是通过它的子类型来表示。HTMLElement 类型直接继承自 Element 并添加了一些属性。

* id: 元素在文档中的唯一标识
* title: 有关元素的附加说明
* lang: 元素内容的语言代码，绝少使用
* dir: 语言方向，值为 "ltr"（left-to-right），绝少使用
* className: 与元素的 class 特性对应。

每个 HTML 元素都会有一个或者多个特性。这些特性的作用是给出相应元素或其内容的附加信息。操作特性的 DOM 方法主要有三个，`getAttribute()`, `setAttribute()`, `removeAttribute()`，但是使用这类方法访问对象元素时，不同的浏览器间会存在差异，所以，并不常用，而只是在取得自定义特性值的情况下，才会使用这类特性。

---
#### 创建元素
使用 **document.createElement()** 方法可以创建新元素。

```
var div = document.createElement("div");
```

该方法只接受一个参数，即要创建的元素的标签名。这个标签名在 HTML 中不区分大小写，而在 XML(包括 XHTML) 中需要区分大小写)。

使用 createElement() 创建新元素的同时，也为新元素设置了 ownerDocument 属性。此时，可以为其添加更多子节点，以及执行其他操作。

```
div.id = "myNewDiv";
div.className = "box";
```

但是以上操作只是为新元素赋予了相应信息，还需要使用 `appendChild()`, `insertBefore()`, `replaceChild()` 把新元素添加到文档树。

将 `div` 添加到 `body` 中

```
document.body.appendChild(div);
```

一旦将新元素添加到文档树种，浏览器就会立即解析该元素，此后对这个元素所作的任何修改都会实时反映在浏览中。

---
### 0x03 Text 类型
文本节点有 Text 类型表示，纯文本中可以包含转义后的 HTML 字符，但是不能包含 HTML 代码。

----
#### 创建文本节点
可以使用 **document.createTextNode()** 创建新的文本节点，该方法只接受一个参数---要插入节点的文本。


以方法可以操作节点中文本

###### appendData(text)
将 text 添加到节点的末尾

###### deleteDate(offset, count)
从 offset 指定的位置开始删除 count 个字符

###### insertDate(offset, text)
在 offset 指定的位置插入 text

###### replaceDate(offset, count, text)
用 text 替换从 offset 到 offset+count 为止的字符

###### splitText(offset)
从 offset 位置将文本分为两个文本节点

###### substringData(offset, count)
提取从 offset 到 offset+count 处的字符。

此外，还可以通过文本的 **text.length** 属性获得字符的长度。


---
### 0x04 DOM 操作技术

---
#### 关于 NodeList
理解 **NodeList**， 及其近亲，**NamedNodeMap**, 和 **HTMLCollection**，是彻底理解 DOM 的关键所在。 首先它们三个都是动态的，每当文档结构发生变化时，它们都会更新。

而从本质上来讲，所有 `NodeList` 对象都是在访问 DOM 文档时实时运行的查询。

所以，若是要迭代一个 `NodeList` ，那最好使用 `length` 属性初始化一个变量。

```
var divs = document.getElementByTagName("div");

i,
len,
div;

for( i = 0,len = divs.length; i < len;i ++){
    div = document.createElement("div");
    document.body.appendChild(div);
}
```

理解 DOM 的关键，便是要知道 DOM 对性能的影响。 DOM 操作往往是 JavaScript 程序中开销最大的部分，因为访问 NodeList 导致的问题的最多。NodeList 对象是动态的，这意味着每次访问 NodeList 对象，都会运行一次查询。所以，应该尽量减少 DOM 操作。


