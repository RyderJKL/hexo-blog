---
title: 模块(1)模块初识  
date: 2016-12-23 09:45              
tags: ['Node.js','模块']
toc: true
categories: technology

---
### 0x00 模块
为了解决一个文件中代码过多难于维护的问题，人们开始想具有不同功能的函数或者代码放在不同的文件中，这样每个文件包含的代码就相对较少，很多编程语言都采用这种组织代码的方式。

在 Node 环境中，一个 `.js` 文件就称之为一个模块（module）。

使用模块的好处是显而易见你的，不但提高的代码的可维护性，而且也避免了过多的重复造轮子，因为一个模块可以在多过地方被引用。

使用模块还可以避免函数名和变量名冲突。相同名字的函数和变量完全可以分别存在不同的模块中，而不必考虑名称是否会冲突。

---
#### module 和 require
我们将给出两个模块：`sub.js` 和 `main.js`

```
//sub.js
/**
 * Created by onejustone on 2016/12/23.
 */
'use strict';
var s = 'hello';

function greet(name) {
    console.log(s + ',' + name + '!');
}

module.exports = greet;
```

`module.exports` 将会暴露 `greet` 函数，以方便在其它模块中调用该函数。


```
//main.js
/**
 * Created by onejustone on 2016/12/23.
 */
'use strict';

// 引入 sub 模块
var  greet = require("./sub");
// 注意模块所在的路径

var s = 'jack';

greet(s);
```

在 `main.js` 模块中使用 Node 中提供的 `require` 方法获得 `sub.js` 模块中暴露的 `greet` 函数。

##### CommonJS 规范
这种模块加载机制被称为CommonJS规范。在这个规范下，每个 `.js` 文件都是一个模块，它们内部各自使用的变量名和函数名都互不冲突，例如，`sub.js` 和 `main.js` 都申明了全局变量 `var s = 'xxx'`，但互不影响。

一个模块想要对外暴露变量（函数也是变量），可以用 `module.exports = variable;` ，一个模块要引用其他模块暴露的变量，用 `var ref = require('module_name');` 就拿到了引用模块的变量。

> 输出的变量可以是任意对象，函数，数组等。

---
### 0x01 CommonJS模块机制
首先需要知道的是, `JavaScript` 语言本身并没有一种模块机制来保证不同模块可以使用相同的变量名。比如,在 `a.js` 中使用了全局变量 `s`，那么，在 `b.js` 中也使用全局变量 `s`，将造成冲突，`b.js` 中对 `s` 赋值会改变 `a.js` 的运行逻辑。

但是,Node.js 却做到了，为何?

闭包，Node.js 通过把一段JavaScript代码用一个函数包装起来，这段代码的所有“全局”变量就变成了函数内部的局部变量。

以 `hello.js` 为例,真正的通过 Node.js 加载后的样子是:

```
/**
 * Created by onejustone on 2016/12/23.
 */
(function () {
    var s = 'hello';
    var name = 'world';
    
    console.log(s + '' + name + '!');
    
})();
```

如此，全局变量 `s` 现在变成了匿名函数内部的局部变量。如果Node.js继续加载其他模块，这些模块中定义 **全局变量** `s` 也互不干扰。

---
### 0x02 module.exports VS exports
默认情况下，Node准备的 `exports` 变量和 `module.exports` 变量实际上是同一个变量，并且初始化为空对象 `{}`。

不过，当我们要输出的是一个函数或数组，那么，只能给 `module.exports` 赋值.

因此，强烈建议使用 `module.exports = xxx` 的方式来输出模块变量，这样，你只需要记忆一种方法。

```
module.exports = funciton () { return 'who are you?'};
```


---
### 0x03 在一个模块中暴露多个对象

```
// sub.js
/**
 * Created by onejustone on 2016/12/23.
 */
'use strict';

var who = 'who are you?';
var where = 'where are you from?';

function sayName(name) {
    console.log(who + ":" + name);
}

function sayLocation (location) {
    console.log(where + ":" + location)
}

module.exports.sayName = sayName;
module.exports.sayLocation = sayLocation;
```

```
/**
 * Created by onejustone on 2016/12/23.
 */
'use strict';

// 引入 sub 模块

var  subModule = require("./sub");

var name = 'jack';
var location = 'earth';

subModule.sayName(name);
subModule.sayLocation(location);
```

运行 `main.js`:

```
who are you?:jack
where are you from?:earth

Process finished with exit code 0
```

