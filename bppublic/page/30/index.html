<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="onejustone&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="onejustone">
<meta property="og:url" content="http://yoursite.com/page/30/index.html">
<meta property="og:site_name" content="onejustone">
<meta property="og:description" content="onejustone&apos;s blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="onejustone">
<meta name="twitter:description" content="onejustone&apos;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/30/">





  <title>onejustone</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">onejustone</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">--愿你内心有种不灭的火焰，将你与别人区分开来--</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/11/Python标准库(3)-时间与日期(time,datetime)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/11/Python标准库(3)-时间与日期(time,datetime)/" itemprop="url">Python标准库(3)时间与日期</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-11T15:30:00+08:00">
                2016-05-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h3><p>计算机只会为何一个挂钟时间(wall clock time),这个时间是从某个固定的起点到现在的时间间隔，时间点的选择与计算机相关，但一台计算机而言，这个时间点事固定的，其它日期也是基于此时间点计算而来的。此外计算机还可以测量CPU实际上的运行时间，即处理器时间(processor clock time),以测量计算机性能！</p>
<h3 id="0x00-time包"><a href="#0x00-time包" class="headerlink" title="0x00 time包"></a>0x00 time包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># -*-coding:utf-8-*-</span><br><span class="line">import time</span><br><span class="line">print(time.time())#挂钟时间，单位:秒</span><br><span class="line">print(time.clock())#c处理器时间，单位:秒</span><br><span class="line">print(time.gmtime())#返回struct_time格式的UTC时间</span><br><span class="line">print(time.localtime())#返回struct_time格式的当地时间</span><br><span class="line">print(time.mktime(st))#将struct_time格式转换成wall clock time</span><br></pre></td></tr></table></figure>
<h3 id="0x02-datetime包"><a href="#0x02-datetime包" class="headerlink" title="0x02 datetime包"></a>0x02 datetime包</h3><p>datetime包是基于time的高级包，可以理解为两部分time包(对应datetime.date类)和date包(对应datetime.time类)，只讲datetime.datetime类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># -*-coding:utf-8-*-</span><br><span class="line">import datetime</span><br><span class="line">t = datetime.datetime(2016,5,12,19,31)</span><br><span class="line">print(t)</span><br><span class="line">输出:</span><br><span class="line">2016-05-12 19:31:00</span><br></pre></td></tr></table></figure>
<p>所有返回的t包含的属性有:hour, minute, second, microsecond(微秒), year, month, day, weekday(周几)</p>
<ul>
<li><strong>运算</strong></li>
</ul>
<p>datetime包还定义了时间间隔对象(timedelta),一个时间点(datetime)加上一个时间间隔(timedelta)可以得到一个新的时间点(datetime),同理，两个时间点相减会得到一个时间间隔。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import datetime</span><br><span class="line"></span><br><span class="line">t = datetime.datetime(2016,5,12,19,31)</span><br><span class="line">t_next = datetime.datetime(2016,5,22,18,23)</span><br><span class="line">deltal1 = datetime.timedelta(seconds = 4000)</span><br><span class="line">deltal2 = datetime.timedelta(weeks = 4)</span><br><span class="line">print(t+deltal1)</span><br><span class="line">print(t+deltal2)</span><br><span class="line">输出:</span><br><span class="line">2016-05-12 20:37:40</span><br><span class="line">2016-06-09 19:31:00</span><br></pre></td></tr></table></figure>
<p>datetime.timedelta的参数可以是seconds, weeks, days, hours, milliseconds, miroseconds.<br>datetime对象之间还可以进行比较<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(t &gt; t_next)</span><br><span class="line">返回:False</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>datetime对象与字符串转换</strong></li>
</ul>
<p>一种方法是使用格式化读取的方式读取时间信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># -*-coding:utf-8-*-</span><br><span class="line"></span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">format = &quot;output-%Y-%m-%d-%H%M%S.txt&quot;</span><br><span class="line">str = &quot;output-1992-3-21-203234.txt&quot;</span><br><span class="line">t = datetime.strptime(str, format)</span><br><span class="line">print t</span><br><span class="line">输出:</span><br><span class="line">1992-03-21 20:32:34</span><br></pre></td></tr></table></figure></p>
<p>也可以反过来调用datetime的strftime()方法将datetime对象装换为特定格式的字符串<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(t.strftime(format))</span><br><span class="line">输出:</span><br><span class="line">output-1992-03-21-203234.txt</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/11/四层发现/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/11/四层发现/" itemprop="url">四层发现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-11T09:45:00+08:00">
                2016-05-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-碎语"><a href="#0x00-碎语" class="headerlink" title="0x00 碎语"></a>0x00 碎语</h3><p>首先我们要明确的是，发现的目的是扫描出可能存活的IP地址，四层发现虽然涉及端口扫描，但是并不对端口的状态进行识别，其本质是利用四层协议的一些通信来识别主机ip是否存在，至于端口的问题，以后在谈。</p>
<p>四层发现的优点是可路由且结果可靠；不太可能被防火墙过滤，甚至可以发现所有端口都被过滤的主机。缺点是基于状态过滤的防火墙可能过滤扫描；全端口(十几万个端口)扫描的速度慢。</p>
<hr>
<h3 id="0x01-四层发现如何探测目标"><a href="#0x01-四层发现如何探测目标" class="headerlink" title="0x01 四层发现如何探测目标"></a>0x01 四层发现如何探测目标</h3><hr>
<h4 id="TCP探测"><a href="#TCP探测" class="headerlink" title="TCP探测"></a>TCP探测</h4><p>正确tcp连接是通过三次握手建立通信过程，然后可以向目标发送资源申请的请求，本机再发送ack进行确认，这是一种基于连接的可靠的通信协议，当然这是正确的时候。如果我们之前没有建立tcp连接，而是直接向目标发送tcp资源请求，这时目标服务器回想本机发送一个RST包(意思是，你是谁，我不认识你啊，你不能连我哦)，因此，当目标服务器委婉且礼貌的拒绝我们时，便可以基于次探测目标主机是否存在了！这是已中国基于tcp协议的特征进行的一种判断。当然我们也可以通过正确的，即是通过三次握手建立通信连接，通过发送的SYN包来确定目标主机是否在线。</p>
<hr>
<h4 id="UDP探测"><a href="#UDP探测" class="headerlink" title="UDP探测"></a>UDP探测</h4><p>UDP不同于TCP，UDP没有通过握手建立连接的过程，UDP只是尽力而为而已，它是一种非连接的不可靠传输协议，因此基于UDP来探测主机，难度和发现的准确率都高于TCP。同样是基于UDP的一些特征信息来探测。</p>
<p>如果目标ip不在线，那我们对其发送的UDP包不会有任何的回应，但假如目标Ip在线，而且发送到UDP的目标端口处于开放状态，一般说来，这时目标主机接受到我的UDP包时也不会有任何回应，但有一种列外，即是目标端口没有开放时，会向我们发送一个ICMP不可达的包(但是到这里我们并不对其端口进行扫描)。</p>
<hr>
<h3 id="0x02-TCP发现"><a href="#0x02-TCP发现" class="headerlink" title="0x02 TCP发现"></a>0x02 TCP发现</h3><p><strong>原理:通过非正常TCP连接，探测目标主机(防火墙，交换机，服务器)是否存在</strong></p>
<p><strong>ACK–&gt;TCP Port–&gt;RST</strong><br>  将TCP包头的flag位设定为ACK，然后发送给一个目标/端口，最后判断是否收到RST响应包，以此确定目标是否存在！</p>
<p><em>无论是基于几层的探测扫描，得到结果也只不过是一种极大可能的参考，一切都可能不是真实的</em></p>
<h4 id="Scapy构造四层TCP探测数据包"><a href="#Scapy构造四层TCP探测数据包" class="headerlink" title="Scapy构造四层TCP探测数据包"></a>Scapy构造四层TCP探测数据包</h4><p>先构造三层ip包，再构成四层tcp，然后将三层/四层组合起来构成一个TCP包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~/scripts# scapy</span><br><span class="line">WARNING: No route found for IPv6 destination :: (no default route?)</span><br><span class="line">Welcome to Scapy (2.2.0)</span><br><span class="line">&gt;&gt;&gt; ip=IP() </span><br><span class="line">&gt;&gt;&gt; tcp=TCP()</span><br><span class="line">&gt;&gt;&gt; r=(ip/tcp)</span><br><span class="line">&gt;&gt;&gt; r[IP].dst=&quot;192.168.0.1&quot; #设置目标Ip地址</span><br><span class="line">&gt;&gt;&gt;r[TCP].flags=&quot;A&quot; #设置TCPflags为”ACK“</span><br><span class="line">&gt;&gt;&gt;r.display()</span><br><span class="line">###[ IP ]###</span><br><span class="line">  version= 4</span><br><span class="line">  ihl= None</span><br><span class="line">  tos= 0x0</span><br><span class="line">  len= None</span><br><span class="line">  id= 1</span><br><span class="line">  flags= </span><br><span class="line">  frag= 0</span><br><span class="line">  ttl= 64</span><br><span class="line">  proto= tcp</span><br><span class="line">  chksum= None</span><br><span class="line">  src= 192.168.0.109 #本机ip已经自动识别</span><br><span class="line">  dst= 192.168.0.1 #目标ip也已设置好</span><br><span class="line">  \options\</span><br><span class="line">###[ TCP ]###</span><br><span class="line">     sport= ftp_data</span><br><span class="line">     dport= http  #默认的tcp的端口是80端口</span><br><span class="line">     seq= 0</span><br><span class="line">     ack= 0</span><br><span class="line">     dataofs= None</span><br><span class="line">     reserved= 0</span><br><span class="line">     flags= A</span><br><span class="line">     window= 8192</span><br><span class="line">     chksum= None</span><br><span class="line">     urgptr= 0</span><br><span class="line">     options= &#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>开始发包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a=sr1(r)</span><br><span class="line">Begin emission:</span><br><span class="line">.Finished to send 1 packets.</span><br><span class="line">*</span><br><span class="line">Received 2 packets, got 1 answers, remaining 0 packets</span><br><span class="line">&gt;&gt;&gt; a.display()</span><br><span class="line">###[ IP ]###</span><br><span class="line">  version= 4L</span><br><span class="line">  ihl= 5L</span><br><span class="line">  tos= 0x0</span><br><span class="line">  len= 40</span><br><span class="line">  id= 14705</span><br><span class="line">  flags= </span><br><span class="line">  frag= 0L</span><br><span class="line">  ttl= 64</span><br><span class="line">  proto= tcp</span><br><span class="line">  chksum= 0xbfa0</span><br><span class="line">  src= 192.168.0.1</span><br><span class="line">  dst= 192.168.0.109</span><br><span class="line">  \options\</span><br><span class="line">###[ TCP ]###</span><br><span class="line">     sport= http</span><br><span class="line">     dport= ftp_data</span><br><span class="line">     seq= 0</span><br><span class="line">     ack= 0</span><br><span class="line">     dataofs= 5L</span><br><span class="line">     reserved= 0L</span><br><span class="line">     flags= R  &lt;---flags位由A变成了R</span><br><span class="line">     window= 0</span><br><span class="line">     chksum= 0x2dbe</span><br><span class="line">     urgptr= 0</span><br><span class="line">     options= &#123;&#125;</span><br><span class="line">###[ Padding ]###</span><br><span class="line">        load= &apos;\x00\x00\x13(\x82\x9e&apos;</span><br></pre></td></tr></table></figure></p>
<p>一条命令搞定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a=sr1(IP(dst=&quot;192.168.0.1&quot;)/TCP(dport=80,flags=&apos;A&apos;),timeout=1,verbose=0)</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">&lt;IP  version=4L ihl=5L tos=0x0 len=40 id=50048 flags= frag=0L ttl=64 proto=tcp chksum=0x3591 src=192.168.0.1 dst=192.168.0.109 options=[] |&lt;TCP  sport=http dport=ftp_data seq=0 ack=0 dataofs=5L reserved=0L flags=R window=0 chksum=0x2dbe urgptr=0 |&lt;Padding  load=&apos;\x00\x00\x80+\x86\xfe&apos; |&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="Python脚本实现TCP四层扫描"><a href="#Python脚本实现TCP四层扫描" class="headerlink" title="Python脚本实现TCP四层扫描"></a>Python脚本实现TCP四层扫描</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"></span><br><span class="line">import logging</span><br><span class="line">import subprocess</span><br><span class="line">logging.getLogger(&quot;scapy.runtime&quot;).setLevel(logging.ERROR)</span><br><span class="line">from scapy.all import *</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!= 2:</span><br><span class="line">  print &quot;Usage - ./ping1.py [/24 network address]&quot;</span><br><span class="line">  print &quot;Example - ./ping1.py 128.38.28.3&quot;</span><br><span class="line">  sys.exit()</span><br><span class="line"></span><br><span class="line">address = str(sys.argv[1])</span><br><span class="line">prefix = address.split(&quot;.&quot;)[0]+&apos;.&apos;+address.split(&quot;.&quot;)[1]+&apos;.&apos;+address.split(&quot;.&quot;)[2]+&apos;.&apos;</span><br><span class="line"></span><br><span class="line">for addr in range(1, 254):</span><br><span class="line">  response = sr1(IP(dst=prefix+str(addr))/TCP(dport=2222,flags=&apos;A&apos;),timeout=0.1,verbose=0)</span><br><span class="line">  try:</span><br><span class="line">    if int(response[TCP].flags)==4: #tcp中Reset对应的flags是倒数第三位，2^2=4</span><br><span class="line">      print(prefix+str(addr))</span><br><span class="line">  except:</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x03-UDP发现"><a href="#0x03-UDP发现" class="headerlink" title="0x03 UDP发现"></a>0x03 UDP发现</h3><p>一条命令搞定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a=sr1(IP(dst=&quot;192.168.0.1&quot;)/UDP(dport=7643),timeout=0.1,verbose=0)</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">&lt;IP  version=4L ihl=5L tos=0x0 len=56 id=63680 flags= frag=0L ttl=64 proto=icmp chksum=0x46 src=192.168.0.1 dst=192.168.0.109 options=[] |&lt;ICMP  type=dest-unreach code=port-unreachable chksum=0xdee4 unused=0 |&lt;IPerror  version=4L ihl=5L tos=0x0 len=28 id=1 flags= frag=0L ttl=64 proto=udp chksum=0xf911 src=192.168.0.109 dst=192.168.0.1 options=[] |&lt;UDPerror  sport=domain dport=7643 len=8 chksum=0x0 |&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="Python脚本实现UDP四层扫描"><a href="#Python脚本实现UDP四层扫描" class="headerlink" title="Python脚本实现UDP四层扫描"></a>Python脚本实现UDP四层扫描</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"></span><br><span class="line">import logging</span><br><span class="line">import subprocess</span><br><span class="line">logging.getLogger(&quot;scapy.runtime&quot;).setLevel(logging.ERROR)</span><br><span class="line">from scapy.all import *</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!= 2:</span><br><span class="line">  print &quot;Usage - ./ping1.py [/24 network address]&quot;</span><br><span class="line">  print &quot;Example - ./ping1.py 128.38.28.3&quot;</span><br><span class="line">  sys.exit()</span><br><span class="line"></span><br><span class="line">address = str(sys.argv[1])</span><br><span class="line">prefix = address.split(&quot;.&quot;)[0]+&apos;.&apos;+address.split(&quot;.&quot;)[1]+&apos;.&apos;+address.split(&quot;.&quot;)[2]+&apos;.&apos;</span><br><span class="line"></span><br><span class="line">for addr in range(1, 254):</span><br><span class="line">  response = sr1(IP(dst=prefix+str(addr))/UDP(dport=7634),timeout=0.1,verbose=0)</span><br><span class="line">  try:</span><br><span class="line">    if int(response[IP].proto)==1: #为何是protoco=1，</span><br><span class="line">#通过wireshark抓包可以发现</span><br><span class="line">#ip层有protocol字段，指向它的上层协议，TCP为6,ICMP为1,IJMP</span><br><span class="line">#为2，UDP为17，</span><br><span class="line">#由此我们可以知道ip上层协议不一定除了tcp，就是udp，</span><br><span class="line">#还可以是其它的很多类型的协议，在这里我们发送了一个udp包给</span><br><span class="line">#目标，我们由是否接受到来自目标的icmp包来判断ip是否存活</span><br><span class="line">      print(prefix+str(addr))</span><br><span class="line">  except:</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x04-nmap-四层发现"><a href="#0x04-nmap-四层发现" class="headerlink" title="0x04 nmap-四层发现"></a>0x04 nmap-四层发现</h3><p>nmap很强大，它除了可以实现三层扫描，第四层也是信手拈来，如探囊取物一般，当然他的强大远不止于此。</p>
<ul>
<li><p><strong>{ Usage $: nmap [ip段] -PU[port] -sn }</strong></p>
<p><strong>只对ip段进行四层发现而不进行端口扫描,类似于UDP扫描</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~/MyBlog/hexo/source/_posts# nmap 221.22.0.1-50 -PU80 -sn</span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2016-05-11 09:07 CST</span><br><span class="line">Nmap scan report for softbank221022000006.bbtec.net (221.22.0.6)</span><br><span class="line">Host is up (0.25s latency).</span><br><span class="line">Nmap scan report for softbank221022000025.bbtec.net (221.22.0.25)</span><br><span class="line">Host is up (0.18s latency).</span><br><span class="line">Nmap done: 50 IP addresses (2 hosts up) scanned in 11.75 seconds</span><br></pre></td></tr></table></figure>
<p>可以看到基于udp的扫描结果并不理想</p>
</li>
</ul>
<ul>
<li><p><strong> { Usage $: nmap [ip段] -PA[port] -sn }</strong></p>
<p><strong>只对ip段进行四层发现而不进行端口扫描,类似于Scapy扫描</strong></p>
</li>
<li><p><strong>{ Usage $: nmap -iL iplist.txt -PA[port] -sn}</strong></p>
<p><strong>对已有ip地址进行存活检测</strong></p>
</li>
</ul>
<p><em>无论如何，以上方法并不是适用于所有互联网设备，但是对大部分还是有所收获的</em></p>
<hr>
<h3 id="0x05-hping3-四层发现"><a href="#0x05-hping3-四层发现" class="headerlink" title="0x05 hping3 四层发现"></a>0x05 hping3 四层发现</h3><ul>
<li><p><strong>{ Usage $: hping3 -udp ip -c 1 }</strong></p>
<p><strong>hping3基于udp的四层发现</strong></p>
<p>udp_hping3.sh核心代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for addr in $(seq 1 254); do hping3 -udp $prefix.$addr -c 1 &gt;&gt; r.txt.done</span><br><span class="line">grep Unreachable r.txt | cut -d&quot; &quot; -f 5 | cut -d&quot;=&quot; -f 2</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>{Usage $: hping3 ip -c 1}</strong></p>
<p><strong>hping3基于tcp的四层发现，不加参数，默认就是</strong></p>
<p>tcp_hping3.sh核心代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">prefix=$(echo $1 | cut -d&quot;.&quot; -f 1-3)</span><br><span class="line">for addr in $(seq 1 254);do</span><br><span class="line">    hping3 $prefix.$addr -c 1 &gt;&gt; r.txt</span><br><span class="line">done</span><br><span class="line">grep ^len r.txt | cut -d&quot; &quot; -f 2 | cut -d&quot;=&quot; -f 2 &gt;&gt; output.txt</span><br><span class="line">rm r.txt</span><br></pre></td></tr></table></figure>
<p>凡是hping发送的tcp所有的flags位都是not set的，即都是0的状态，它不同于udp的扫描，它通过返回的ack+rst包来判断主机存活！</p>
</li>
</ul>
<p>hping3对四层扫描结果最不理想，当然这个就是智者见智！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/09/三层发现/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/09/三层发现/" itemprop="url">层发现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-09T21:45:00+08:00">
                2016-05-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-碎语"><a href="#0x00-碎语" class="headerlink" title="0x00 碎语"></a>0x00 碎语</h3><p>IP以及ICMP协议(internet管理协议)属于三层协议，icmp的作用其实就是用来实现intenet管理的，进行路径的发现，网路通信情况，或者目标主机的状态，三层发现中主要使用icmp协议，arp协议属于二层协议，它是基于广播的，所以不可路由。而ICMP协议是可以路由的，理论上可以使用icmp协议发现全球的ip，如果么有边界防火墙(禁止icmp的探测包)进行过滤的话，对目标主机进行扫描，则会收到相应的响应，从而进行扑捉，除此以外，三层发现的扫描速度也较二层要慢些</p>
<hr>
<h3 id="0x01-三层发现工具"><a href="#0x01-三层发现工具" class="headerlink" title="0x01 三层发现工具"></a>0x01 三层发现工具</h3><hr>
<h4 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h4><p>ping使用icmp协议中两种类型的数据包，icmp<br>协议根据包头中的type字段定义了16中(0-15)种包类型，ping发送探测数据时使用的是第8号数据包，而接收数据(如果目标主机没有防火墙的回馈信息)时使用的是第0号数据包。</p>
<p>除此外，linux和windows使用ping命令时发送的ping包是有很大差异了。</p>
<p>使用ping命令对自身网关发送5个ping包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~/scripts# ping 192.168.1.1 -c 5</span><br><span class="line">PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=1 ttl=251 time=5.38 ms</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=2 ttl=251 time=4.09 ms</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=3 ttl=251 time=3.56 ms</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=4 ttl=251 time=4.24 ms</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=5 ttl=251 time=18.8 ms</span><br></pre></td></tr></table></figure></p>
<p>可以看到从本机追踪到sina.com一共经过了10次路由跳转，其中第六次时没有返回相关信息，说明该主机很有可能开启了边界防火墙过滤规则，自动过滤了icmp包的探测。</p>
<hr>
<h5 id="Bash脚本实现"><a href="#Bash脚本实现" class="headerlink" title="Bash脚本实现"></a>Bash脚本实现</h5><p>ping命令结合bash脚本实现对IP段的扫描<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">if [ &quot;$#&quot; -ne 1 ];then  </span><br><span class="line">  echo &quot;Usage - ./ping.sh [/24 network address]&quot;</span><br><span class="line">  echo &quot;Usage - ./ping.sh 189.29.33.32&quot;</span><br><span class="line">  exit</span><br><span class="line">fi</span><br><span class="line">prefix=$(echo $1 | cut -d&apos;.&apos; -f 1-3)</span><br><span class="line">for addr in $(seq 1 254);do</span><br><span class="line">  ping -c 1 $prefix.$addr | grep &quot;bytes from&quot; | cut -d&apos; &apos; -f 4 | cut -d&apos;:&apos; -f 1 &amp;</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<hr>
<h5 id="Scapy"><a href="#Scapy" class="headerlink" title="Scapy"></a>Scapy</h5><p>先定义一个ip包头，在定义一个icmp包头，最后组合成一个ping包，然后发出去。</p>
<p>进入scapy<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~/scripts# scapy </span><br><span class="line">WARNING: No route found for IPv6 destination :: (no default route?)</span><br><span class="line">Welcome to Scapy (2.2.0)</span><br><span class="line">&gt;&gt;&gt; i=IP() #先定义一个IP变量</span><br><span class="line">&gt;&gt;&gt; p=ICMP() #然后定义一个icmp变量</span><br><span class="line">&gt;&gt;&gt; ping=(i/p) #将ip包与icmp包组合成一个icmp的ping包</span><br><span class="line">&gt;&gt;&gt; ping.display()#显示ping包的包头结构</span><br><span class="line">###[ IP ]###</span><br><span class="line">  version= 4</span><br><span class="line">  ihl= None</span><br><span class="line">  tos= 0x0</span><br><span class="line">  len= None</span><br><span class="line">  id= 1</span><br><span class="line">  flags= </span><br><span class="line">  frag= 0</span><br><span class="line">  ttl= 64</span><br><span class="line">  proto= icmp</span><br><span class="line">  chksum= None</span><br><span class="line">  src= 127.0.0.1</span><br><span class="line">  dst= 127.0.0.1</span><br><span class="line">  \options\</span><br><span class="line">###[ ICMP ]###</span><br><span class="line">     type= echo-request #已经被设置为8号包</span><br><span class="line">     code= 0</span><br><span class="line">     chksum= None</span><br><span class="line">     id= 0x0</span><br><span class="line">     seq= 0x0</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></p>
<p>设置要ping的目标ip地址(dst)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; ping[IP].dst=&quot;192.168.1.1&quot;</span><br><span class="line">&gt;&gt;&gt; ping.display()</span><br><span class="line">###[ IP ]###</span><br><span class="line">  version= 4</span><br><span class="line">  ihl= None</span><br><span class="line">  tos= 0x0</span><br><span class="line">  len= None</span><br><span class="line">  id= 1</span><br><span class="line">  flags= </span><br><span class="line">  frag= 0</span><br><span class="line">  ttl= 64</span><br><span class="line">  proto= icmp #从这里可以知道ip的上层协议为icmp协议</span><br><span class="line">  chksum= None</span><br><span class="line">  src= 192.168.0.109 #scapy会自动侦听网卡Ip地址</span><br><span class="line">  dst= 192.168.1.1</span><br><span class="line">  \options\</span><br><span class="line">###[ ICMP ]###</span><br><span class="line">     type= echo-request</span><br><span class="line">     code= 0</span><br><span class="line">     chksum= None</span><br><span class="line">     id= 0x0</span><br><span class="line">     seq= 0x0</span><br></pre></td></tr></table></figure></p>
<p>开始发包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; answer=sr1(ping)</span><br><span class="line">Begin emission:</span><br><span class="line">.Finished to send 1 packets.</span><br><span class="line">.*</span><br><span class="line">Received 3 packets, got 1 answers, remaining 0 packets</span><br></pre></td></tr></table></figure></p>
<p>显示下回包的内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; answer.display()</span><br><span class="line">###[ IP ]###</span><br><span class="line">  version= 4L</span><br><span class="line">  ihl= 5L</span><br><span class="line">  tos= 0x0</span><br><span class="line">  len= 28</span><br><span class="line">  id= 25387</span><br><span class="line">  flags= </span><br><span class="line">  frag= 0L</span><br><span class="line">  ttl= 128</span><br><span class="line">  proto= icmp</span><br><span class="line">  chksum= 0x558a</span><br><span class="line">  src= 192.168.0.110</span><br><span class="line">  dst= 192.168.0.109</span><br><span class="line">  \options\</span><br><span class="line">###[ ICMP ]###</span><br><span class="line">     type= echo-reply #icmp的type=0的数据包</span><br><span class="line">     code= 0</span><br><span class="line">     chksum= 0xffff</span><br><span class="line">     id= 0x0</span><br><span class="line">     seq= 0x0</span><br><span class="line">###[ Padding ]###</span><br><span class="line">        load= &apos;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&apos;</span><br></pre></td></tr></table></figure></p>
<p>以上过程也可以使用一条命令完成，以此实现我们在Python脚本中的调用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; sr1(IP(dst=&quot;192.168.0.101&quot;)/ICMP(),</span><br><span class="line">Begin emission:</span><br><span class="line">.Finished to send 1 packets.</span><br><span class="line">.*</span><br><span class="line">Received 3 packets, got 1 answers, remaining 0 packets</span><br><span class="line">&lt;IP  version=4L ihl=5L tos=0x0 len=28 id=32352 flags= frag=0L ttl=128 proto=icmp chksum=0x3a55 src=192.168.0.110 dst=192.168.0.109 options=[] |&lt;ICMP  type=echo-reply code=0 chksum=0xffff id=0x0 seq=0x0 |&lt;Padding  load=&apos;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&apos;</span><br></pre></td></tr></table></figure></p>
<p>但是，如果使用scapy发送的ip地址不存在时，它会一直发包，直到对方响应为止，显然这是不想发生的，所以我们还需要使用timeout参数设定如果对方超过时间无回应则自动放弃！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; sr1(IP(dst=&quot;192.168.0.111&quot;)/ICMP(), timeout=1, verbose=0)</span><br><span class="line">WARNING: Mac address to reach destination not found. Using broadcast.</span><br></pre></td></tr></table></figure></p>
<hr>
<h5 id="Python脚本实现"><a href="#Python脚本实现" class="headerlink" title="Python脚本实现"></a>Python脚本实现</h5> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"></span><br><span class="line">import logging</span><br><span class="line">import subprocess</span><br><span class="line">logging.getLogger(&quot;scapy.runtime&quot;).setLevel(logging.ERROR)</span><br><span class="line">from scapy.all import *</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!= 2:</span><br><span class="line">  print &quot;Usage - ./ping1.py [/24 network address]&quot;</span><br><span class="line">  print &quot;Example - ./ping1.py 128.38.28.3&quot;</span><br><span class="line">  sys.exit()</span><br><span class="line"></span><br><span class="line">address = str(sys.argv[1])</span><br><span class="line">prefix = address.split(&quot;.&quot;)[0]+&apos;.&apos;+address.split(&quot;.&quot;)[1]+&apos;.&apos;+address.split(&quot;.&quot;)[2]+&quot;.&quot;</span><br><span class="line"></span><br><span class="line">for addr in range(1, 254):</span><br><span class="line">  a=sr1(IP(dst=prefix+str(addr))/ICMP(),timeout=0.1,verbose=0)</span><br><span class="line">  if a == None:</span><br><span class="line">    pass</span><br><span class="line">  else:</span><br><span class="line">    print(prefix+str(addr))</span><br></pre></td></tr></table></figure>
<p>这里Python的脚本过于简单，并没有使用多线程取执行它，所有速度上可能略慢与bas脚本的执行速度~</p>
<p>下面调用能文件内存储的IP地址对可能存活的Ip地址进行检查<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"></span><br><span class="line">import logging</span><br><span class="line">import subprocess</span><br><span class="line">logging.getLogger(&quot;scapy.runtime&quot;).setLevel(logging.ERROR)</span><br><span class="line">from scapy.all import *</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!= 2:</span><br><span class="line">  print &quot;Usage - ./ping1.py [/24 network address]&quot;</span><br><span class="line">  print &quot;Example - ./ping1.py 128.38.28.3&quot;</span><br><span class="line">  sys.exit()</span><br><span class="line"></span><br><span class="line">filename = str(sys.argv[1])</span><br><span class="line">file = open(filename, &apos;r&apos;)</span><br><span class="line"></span><br><span class="line">for addr in file:</span><br><span class="line">  a=sr1(IP(dst=addr.strip())/ICMP(), timeout=0.1, verbose=0)</span><br><span class="line">  if a == None:</span><br><span class="line">    pass</span><br><span class="line">  else:</span><br><span class="line">    print addr.strip()</span><br><span class="line">运行:</span><br><span class="line">root@jack:~/scripts/三层扫描# ./ping2.py pingaddr.txt</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="traceroute-路由追踪"><a href="#traceroute-路由追踪" class="headerlink" title="traceroute 路由追踪"></a>traceroute 路由追踪</h4><p>traceroute同样使用的是icmp协议，使用traceroute命令可以追踪到目标主机之间跳转了多少次路由</p>
<p>使用traceroute追踪到sina.com<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# traceroute www.sina.com</span><br><span class="line">traceroute to www.sina.com (218.30.108.192), 30 hops max, 60 byte packets</span><br><span class="line"> 1  bogon (192.168.0.1)  0.931 ms  0.932 ms  0.921 ms</span><br><span class="line"> 2  134.644.342.1  4.634 ms  5.127 ms  5.570 ms</span><br><span class="line"> 3   5.125 ms  5.513 ms  5.525 ms</span><br><span class="line"> 4   15.332 ms  15.726 ms  15.717 ms</span><br><span class="line"> 5   (202.97.38.45)  39.178 ms 202.97.80.145 (202.97.80.145)  36.039 ms  35.970 ms</span><br><span class="line"> 6  * * *</span><br><span class="line"> 7  1062.362 ms 220.181.0.50 (220.181.0.50)  1017.043 ms *</span><br><span class="line"> 8  180.149.128.46 (180.149.128.46)  39.002 ms * 180.149.128.146 (180.149.128.146)  41.218 ms</span><br><span class="line"> 9  180.149.129.214 (180.149.129.214)  38.029 ms  38.058 ms  38.046 ms</span><br><span class="line">10  218.30.108.192 (218.30.108.192)  39.859 ms  37.563 ms  38.150 ms</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="fping命令"><a href="#fping命令" class="headerlink" title="fping命令"></a>fping命令</h4><ul>
<li><strong>fping 1.2.2.2 -c 1</strong></li>
<li><strong>fping -g 1.1.1.1 1.1.1.2</strong></li>
<li><strong>fping -g 1.1.1.0/24</strong></li>
<li><strong>fping -f iplist.txt</strong></li>
</ul>
<hr>
<h4 id="hping"><a href="#hping" class="headerlink" title="hping"></a>hping</h4><p>hping是一个很强大的命令，它能够发送几乎任意的TCP/IP包，除了可以一定程度上对ftp实现一个大量的压力测试(ddos)攻击，同时还可以实现第三层的扫描,但是每次只能扫描一个目标，但是这个不打紧！</p>
<p>hping实现三层icmp扫描<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~/scripts/三层扫描# hping3 192.168.0.1 --icmp -c 2</span><br></pre></td></tr></table></figure></p>
<p>一行命令实现对整个ip网段的扫描<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~/scripts/三层扫描# for addr in $(seq 1 254); do hping3\</span><br><span class="line">&gt; 192.168.0.$addr --icmp -c 1 &gt;&gt; handle.txt &amp; done</span><br><span class="line">#将结果保存到handle.txt是因为hping与fping一样，显示的信息太过杂乱，</span><br><span class="line">#先将其保存在文件中在进行分析</span><br></pre></td></tr></table></figure></p>
<p>然后通过分析文本我们发现每个活着的IP都会有一个”len”字符,使用grep提取活着的ip<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~/scripts/三层扫描# cat handle.txt | grep ^len</span><br><span class="line">len=46 ip=192.168.0.1 ttl=64 id=37158 icmp_seq=0 rtt=6.8 ms</span><br><span class="line">len=46 ip=192.168.0.110 ttl=128 id=21635 icmp_seq=0 rtt=3.6 ms</span><br><span class="line">len=46 ip=192.168.0.113 ttl=128 id=19190 icmp_seq=0 rtt=3.9 ms</span><br><span class="line">len=46 ip=192.168.0.104 ttl=64 id=25196 icmp_seq=0 rtt=6.3 ms</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/05/15.内存使用/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/05/15.内存使用/" itemprop="url">Python(15)-内存使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-05T11:03:00+08:00">
                2016-05-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>!&gt; Python作为一种动态类型的语言，其对象和引用分离，这跟曾经的面向过程语言有很大的区别，为了有效的释放内存，Python内置了<code>垃圾回收</code>的支持。</p>
<hr>
<h2 id="0x00-对象的内存使用"><a href="#0x00-对象的内存使用" class="headerlink" title="0x00 对象的内存使用"></a>0x00 对象的内存使用</h2><p>在Pthon中，整数和短小的字符，Python都会缓存这些对象，以便重复使用，当我们创建多个等于1的引用时，实际上是让所有的引用指向同一个对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">1</span></span><br><span class="line">print(id(a)，id(b))</span><br><span class="line"><span class="comment">#id()是python的内置函数，用于返回对象的内存地址</span></span><br><span class="line">(<span class="number">39019128L</span>, <span class="number">39019128L</span>)</span><br></pre></td></tr></table></figure>
<p>可见<code>a</code>和<code>b</code>实际上是指向同一个对象的引用。</p>
<p>我们还可以使用<code>is</code>关键字来判断两个引用所指的对象是否相同</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">"good"</span></span><br><span class="line">b = <span class="string">"good"</span></span><br><span class="line"><span class="keyword">print</span> (a <span class="keyword">is</span> b)</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line">a = <span class="string">"very good"</span></span><br><span class="line">b = <span class="string">"very good"</span></span><br><span class="line"><span class="keyword">print</span> (a <span class="keyword">is</span> b)</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line">a = []</span><br><span class="line">b = []</span><br><span class="line"><span class="keyword">print</span> (a <span class="keyword">is</span> b)</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">1</span></span><br><span class="line"><span class="keyword">print</span> (a <span class="keyword">is</span> b)</span><br><span class="line"><span class="keyword">True</span></span><br></pre></td></tr></table></figure>
<p>可以看到所有整数<code>1</code>的引用都指向同一对象。即使使用赋值语句，也只是创造了新的引用，而不是对象本身。长的字符串和其它对象可以有多个相同的对象，可以使用赋值语句创建出新的对象。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/02/12.动态类型/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/02/12.动态类型/" itemprop="url">Python(12)-动态类型(dynamic typing)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-02T22:38:00+08:00">
                2016-05-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="0x00-mutable-vs-immutable"><a href="#0x00-mutable-vs-immutable" class="headerlink" title="0x00 mutable vs immutable"></a>0x00 mutable vs immutable</h2><hr>
<p><strong>对象是存储在内存中的实体</strong>,但是我们并不能直接接触到该对象，在程序中所写的对象名，只是<strong>指向这一对象的引用(reference)</strong></p>
<p>C中的变量比如，数字，字符串，表等等，在Python中都是对象。</p>
<p><strong>对象和引用分离，是动态类型的核心</strong>,而引用可以随时指向一个新的对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">3</span></span><br><span class="line">a = <span class="string">'at'</span></span><br><span class="line"><span class="comment">#开始，3是存储在内存中的一个对象，通过赋值，引用a指向对象3</span></span><br><span class="line"><span class="comment">#然后，引用a指向了内存中的另一个对象'at',是一个字符串，此时, 3不在有引用指向</span></span><br></pre></td></tr></table></figure>
<p><strong>Python会自动销毁(destruct)没用引用指向的对象，从而释放相应内存！</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">5</span></span><br><span class="line">b = a</span><br><span class="line">a = a+<span class="number">2</span></span><br><span class="line"><span class="comment">#通过前两个句子，我们让a，b指向同一个对象</span></span><br><span class="line"><span class="comment">#b = a的意思是让引用b指向引用a所指向的那一个对象</span></span><br><span class="line"><span class="comment">#但第三个句子实际上是对引用a重新赋值，让a指向一个新的对象7</span></span><br></pre></td></tr></table></figure>
<p>此时，a，b指向不同的对象。可以看到，即使是多个引用指向同一个对象，如果一个引用值发生变化，那么实际上是让这个引用再指向一个新的引用，但并不影响其它引用的指向，即是各个引用相互独立，互不影响！</p>
<p>其它数据对象也是如此:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">l1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line">l2 = l1</span><br><span class="line">l1 = <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>但是以下则不一样:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">l1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">l2 = l1</span><br><span class="line">l2[<span class="number">2</span>] = <span class="number">99</span></span><br><span class="line"><span class="keyword">print</span> l1,l2</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">99</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">99</span>]</span><br></pre></td></tr></table></figure>
<p>l1,l2 同时发生了改变，为何?首先，我们使l2指向l1引用所指的对象，而对象是一个表，而表实际上是包含了多个引用的对象，l2[2] = 99这个操作并没有使l1，l2的指向发生变化，它们依然指向那个表，而是对l2[2]，也就是表对象的一一部分对象(元素)进行操作，所以，所有指向该对象(表中元素)的引用都受到影响！</p>
<p>(前一个列子的赋值操作都没有对对象自身发生作用，而是改变引用指向)</p>
<p>列表可以通过引用其元素，改变对象自身(in-place change)。这种对象类型，称为<code>可变数据对象(mutable object)</code>，词典也是这样的数据类型。<br>而像之前的数字和字符串，不能改变对象本身，只能改变引用的指向，称为<code>不可变数据对象(immutable object)</code>。<br>我们之前学的元组<code>tuple</code>，尽管可以调用引用元素，但不可以赋值，因此不能改变对象自身，所以也算是<code>immutable object</code>.</p>
<hr>
<h2 id="0x00-从动态类型看函数参数传递"><a href="#0x00-从动态类型看函数参数传递" class="headerlink" title="0x00 从动态类型看函数参数传递"></a>0x00 从动态类型看函数参数传递</h2><p>函数的参数传递，本质上传递的是引用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></span><br><span class="line">      x = <span class="number">100</span></span><br><span class="line">      <span class="keyword">print</span> x</span><br><span class="line"></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">f(a)</span><br><span class="line"><span class="keyword">print</span> a</span><br><span class="line"></span><br><span class="line"><span class="number">100</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>参数<code>x</code>是一个新的引用，指向a所指的对象，如果参数是不可变<code>immutable</code>的对象，那么<code>a</code>和<code>x</code>引用之间相互独立，对参数<code>x</code>的操作不会影响引用a。</p>
<p>如果传递的是可变<code>mutable</code>的对象，那么改变函数参数，有可能改变原对象，所有指向原对象的引用都会受到影响:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></span><br><span class="line">        x[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line">        <span class="keyword">print</span> x</span><br><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>]</span><br><span class="line">f(a)</span><br><span class="line"><span class="keyword">print</span> a</span><br><span class="line">[<span class="number">100</span>,<span class="number">2</span>,<span class="number">4</span>]</span><br><span class="line">[<span class="number">100</span>,<span class="number">2</span>,<span class="number">4</span>]</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/01/10.循环对象-生成器-表推导/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/01/10.循环对象-生成器-表推导/" itemprop="url">Python(10)－循环对象－生成器－表推导</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-01T11:44:00+08:00">
                2016-05-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>循环对象是这样一个对象，其包含一个<code>__next__</code>方法，这个方法的目的是进行到下一个结果，而在结束一系列结果之后，返回一个<code>StopIteration</code>错误。</p>
<p>当一个循环结构调用循环对象时，它就会每次循环的时候调用<code>next()</code>方法直到<code>StopIteration</code>出现，<code>for</code>循环接收到，就知道循环已经结束，停止调用<code>next</code>.</p>
<p>相较于序列，循环对象的优势在于:不用在循环还没开始的时候，就生成要使用的元素，而是所有元素可以在循环的过程中逐次生成，节省空间，提高效率！</p>
<h2 id="0x01-迭代器-iterator"><a href="#0x01-迭代器-iterator" class="headerlink" title="0x01 迭代器(iterator)"></a>0x01 迭代器(iterator)</h2><hr>
<p>从技术上来说，<code>循环对象</code>和<code>for循环</code>调用之间还有一个中间层，就是要将循环对象转换成迭代器(iterator)。这一转换是通过使用<code>iter()</code>函数实现的。但从逻辑层面上，常常可以忽略这一层，所以循环对象和迭代器常常相互指代对方</p>
<h2 id="0x02-生成器-genetator"><a href="#0x02-生成器-genetator" class="headerlink" title="0x02 生成器(genetator)"></a>0x02 生成器(genetator)</h2><hr>
<p>生成器的主要目的是构成一个用户自定义的循环对象，其编写方法与函数类似，只是将<code>return</code>改为了<code>yield</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">()</span>:</span></span><br><span class="line">    a = <span class="number">10</span></span><br><span class="line">    <span class="keyword">yield</span> a</span><br><span class="line">    a = a*<span class="number">8</span></span><br><span class="line">    <span class="keyword">yield</span> a</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1000</span>  &lt;===gen是一个生成器</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> gen():</span><br><span class="line">    <span class="keyword">print</span> i</span><br></pre></td></tr></table></figure>
<p><code>gen</code>生成器共有三个<code>yield</code>，如果用作循环器，如上，将会进行三次循环</p>
<p>再看下面的一个生成器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br></pre></td></tr></table></figure>
<p>它又可以写成一个生成器表达式(<code>Generator Expression</code>):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">G = (x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">4</span>))</span><br></pre></td></tr></table></figure>
<p>生成器表达式是生成器的一种简便的编写方式</p>
<h2 id="0x03-表推导-List-Comprehension"><a href="#0x03-表推导-List-Comprehension" class="headerlink" title="0x03 表推导(List Comprehension)"></a>0x03 表推导(List Comprehension)</h2><hr>
<p>表推导是快速生成表的方法。假设我生成表L</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">L = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">      L.append(x**<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>但实际上有快捷的写法，也就是<strong>表推导</strong>的方式:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">L = [x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>) ]</span><br></pre></td></tr></table></figure>
<p>这个与生成器类似，不过使用的是中括号<code>[]</code></p>
<p>看看下面的推导会是什么</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x1 = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line">y1 = [<span class="number">9</span>, <span class="number">12</span>, <span class="number">13</span>]</span><br><span class="line">L = [x**<span class="number">2</span> <span class="keyword">for</span>(x, y) <span class="keyword">in</span> zip(x1, y1) <span class="keyword">if</span> y &gt; <span class="number">10</span>]</span><br><span class="line"><span class="keyword">print</span> L</span><br><span class="line">[<span class="number">9</span>,<span class="number">25</span>]</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/27/第十七章-程序管理与SELinux/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/27/第十七章-程序管理与SELinux/" itemprop="url">第十七章-程序管理与SELLinux</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-27T18:22:52+08:00">
                2016-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-什么是程序管理"><a href="#0x00-什么是程序管理" class="headerlink" title="0x00 什么是程序管理"></a>0x00 什么是程序管理</h3><hr>
<h4 id="进程与程序-process-amp-amp-program"><a href="#进程与程序-process-amp-amp-program" class="headerlink" title="进程与程序(process &amp;&amp; program)"></a>进程与程序(process &amp;&amp; program)</h4><p>当我们运行一个命令或者程序的时候，系统就会产生一个进程，并分配给这个进程一个id，即PID，每个进程对应一个PID，每个PID也只对应一个进程！</p>
<p><strong>Linux的fork机制</strong><br>在linux里面基本上每一个子程序的产生都是由父程序以复制(fork)的方式，而这个程序与父程序唯一的差别就是PPID不同。</p>
<p><strong>服务</strong><br>服务(daemon)，其实就是常驻在内存当中的程序，通常负责一些系统所提供的功能以服务使用者各项任务。</p>
<hr>
<h3 id="0x01-工作管理-job-control"><a href="#0x01-工作管理-job-control" class="headerlink" title="0x01 工作管理(job control)"></a>0x01 工作管理(job control)</h3><p>job control的意思是:当我们登陆系统取得 bash shell之后，在单一终端机介面下同时进行多个工作的行为管理,比如一边复制文件一边打包，一边进行vi编辑。</p>
<hr>
<h4 id="工作管理"><a href="#工作管理" class="headerlink" title="工作管理?"></a>工作管理?</h4><p>我们把可以出现提示字节让你操作的环境就称为前景(foreground)，至于其他工作就可以让你放入背景 (background) 去暂停或运行。</p>
<h5 id="job-control-amp-ctrl-z-jobs-fg-bg-kill"><a href="#job-control-amp-ctrl-z-jobs-fg-bg-kill" class="headerlink" title="job control:&amp;,[ctrl-z],jobs,fg,bg,kill"></a>job control:&amp;,[ctrl-z],jobs,fg,bg,kill</h5><ul>
<li><p><strong>直接将命令丢到背景中运行:&amp;</strong></p>
<p>假如我们将整个/etc备份成为/tmp/etc.tar.gz，且不想等待，则可以这样做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# tar -zpcvf /tmp/etc.tar.gz /etc &gt; /tmp/log.txt 2&gt;&amp;1 &amp;</span><br><span class="line">[1] 2130</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>输入一条命令后，在命令后加上&amp;就代表将该命令丢到背景中，此时bash给予该命令一个工作号码，其实就是该命令的pid了。然后我们使用数据流重定向，将该命令可能产生的错误输出到/tmp/log.txt文件中，当命令完成时会在终端中出现如下信息:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1]+  已完成  tar -zpcvf /tmp/etc.tar.gz /etc &gt; /tmp/log.txt 2&gt;&amp;1</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><strong>ctrl-z</strong></p>
<p>有时我们会正在使用vi对一个文件进行编辑，但是突然要查找某个文件，这时你会按下<strong>ctrl-z</strong>退出vi(其实按下<strong>ctrl-z</strong>并没有真正的退出vi编辑，系统只是将这个任务<strong>暂停</strong>了)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# vim /tmp/log.txt </span><br><span class="line">(ctrl-z)</span><br><span class="line">[1]+  已停止               vim /tmp/log.txt</span><br><span class="line">root@jack:~# find / -print </span><br><span class="line">...</span><br><span class="line">(ctrl-z)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>观察目前背景中作状态:jobs</strong></p>
<p><strong>{ Usage $: jobs -[lrs] }</strong></p>
<p><strong>选项与参数:</strong></p>
<ul>
<li>-l:除了列出 job number 与命令串之外，同时列出 PID 的号码；</li>
<li>-r:仅列出正在背景 run 的工作</li>
<li>-s:仅列出正在背景当中暂停 (stop) 的工作<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# jobs -l</span><br><span class="line">[1]-  2156 停止                  vim /tmp/log.txt</span><br><span class="line">[2]+  2168 停止                  find / -print</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>+ 代表最近被放到背景的工作号码， - 代表最近最后第二个被放置到背景中的工作号码</p>
<ul>
<li><p><strong>fg从背景中取出工作</strong></p>
<p>fg(foreground)的意思就是将背景中的过工作拿到前景中来了</p>
<p><strong>{ Usage $: fg %jobnumber }是工作号码，不是PID哈</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# jobs -l</span><br><span class="line">[1]-  2156 停止                  vim /tmp/log.txt</span><br><span class="line">[2]+  2168 停止                  find / -print</span><br><span class="line">root@jack:~# fg %1</span><br><span class="line">vim /tmp/log.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>让工作在背景下运行bg</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# jobs;bg 2;jobs</span><br><span class="line">[1]-  已停止               vim /tmp/log.txt</span><br><span class="line">[2]+  已停止               find / - print &gt; /tmp/find.txt</span><br><span class="line">[2]+ find / - print &gt; /tmp/find.txt &amp;</span><br><span class="line">[1]+  已停止               vim /tmp/log.txt</span><br><span class="line">[2]-  运行中               find / - print &gt; /tmp/find.txt &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>kill进程终结者</strong></p>
<p><strong>{ Usage $: kill [-1 9 15] }</strong></p>
<p><strong>选项与参数:</strong></p>
<ul>
<li>-1:重新读取一次参数的配置档 (类似 reload)</li>
<li>-9:立刻强制删除一个工作</li>
<li>-15:以正常的程序方式终止一项工作。与 -9 是不一样的</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# jobs -l</span><br><span class="line">[1]+  2270 停止                  vim /tmp/log.txt</span><br><span class="line">root@jack:~# kill -9 2270</span><br><span class="line">root@jack:~# jobs</span><br><span class="line">[1]+  已杀死               vim /tmp/log.txt</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>此外，需要注意的是 kill 后面接的数字默认会是 PID ，如果想要管理 bash 的工作控制，就得要加上 %数字<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# jobs</span><br><span class="line">[1]+  已停止               vim /tmp/log.txt</span><br><span class="line">root@jack:~# kill -9 %1</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><strong>离线管理:nohup</strong></p>
<p>想要让在背景的工作在你注销后还能够继续的运行，那么使用 nohup 搭配 &amp; 是不错的运行情境:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# nohup ./sleepsh02.sh &amp;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="0x02-程序管理"><a href="#0x02-程序管理" class="headerlink" title="0x02 程序管理"></a>0x02 程序管理</h3><p>下面我们将了解如何观察程序与程序的状态，然后再加以程序控制！</p>
<hr>
<h4 id="观察程序-ps-top-pstree"><a href="#观察程序-ps-top-pstree" class="headerlink" title="观察程序:ps,top,pstree"></a>观察程序:ps,top,pstree</h4><h5 id="ps静态观察"><a href="#ps静态观察" class="headerlink" title="ps静态观察"></a>ps静态观察</h5><p> <strong>选项与参数</strong></p>
<ul>
<li>ps aux:观察系统所有的程序数据</li>
<li>ps -l:仅观察自己的相关程序</li>
<li><p>ps axjf:连同部分程序树</p>
<p>仅观察自己的相关程序:ps -l</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# ps -l</span><br><span class="line">F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">0 S     0  2253  2247  0  80   0 -  6308 -      pts/1    00:00:00 bash</span><br><span class="line">0 R     0  2482  2253  0  80   0 -  2708 -      pts/1    00:00:00 ps</span><br><span class="line">#-----#</span><br><span class="line">F:代表程序旗标，常见的０表示此程序的权限为root</span><br><span class="line">S:代表程序状态(stat),D(runing),S(sleep),D(不可唤醒的睡眠状态),Ｔ(stoop),Z(Zombie)僵尸态</span><br><span class="line">UID/PID/PPID:</span><br><span class="line">C:CPU使用率</span><br><span class="line">PRI/NI:Priority/Nice缩写，此程序被cpu所运行的优先顺序，数字越小越优先</span><br><span class="line">ADDR/SZ/WCHAN:与内存有关</span><br><span class="line">TTY:登录者的终端机，远程为(pst/n)</span><br><span class="line">TIME:占用cpu的时间</span><br><span class="line">CMD:command的缩写</span><br></pre></td></tr></table></figure>
<p>ps -l 则仅列出与你的操作环境 (bash) 有关的程序而已， 亦即最上一级的父程序会是你自己的 bash 而没有延伸到 init 这支程序,他的内容如下:</p>
<p>_bash 的程序属於 UID 为 0 的使用者，状态为睡眠 (sleep)， 之所以为睡眠因为他触发了 ps (状态为 run) 之故。此程序的 PID 为 2253，优先运行顺序为 80 ， 下达 bash 所取得的终端介面为 pts/1 ，运行状态为等待 (wait) _</p>
</li>
</ul>
<h5 id="ps-aux观察系统所有程序"><a href="#ps-aux观察系统所有程序" class="headerlink" title="ps aux观察系统所有程序"></a>ps aux观察系统所有程序</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# ps aux</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  0.0  0.0 176724  5028 ?        Ss   08:37   0:01 /lib/systemd/s</span><br><span class="line">#-----#</span><br><span class="line">%CPU:该程序使用的cpu百分比</span><br><span class="line">%MEN:该程序使用的实体内存百分比</span><br><span class="line">STAT:程序状态(R/S/D/T/Z)</span><br><span class="line">START:该程序启动时间</span><br><span class="line">TIME:已实际使用cpu运行的时间</span><br><span class="line">COMMAND:该程序实际命令</span><br></pre></td></tr></table></figure>
<p>找出与 cron 与 syslog 这两个服务有关的 PID 号码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# ps aux | egrep &apos;(cron|syslog)&apos;</span><br><span class="line">root       671  0.0  0.0  27644  2780 ?        Ss   08:37   0:00 /usr/sbin/cron -f</span><br><span class="line">root       723  0.0  0.0 258672  3420 ?        Ssl  08:37   0:00 /usr/sbin/rsyslogd -n</span><br><span class="line">Debian-+   852  0.0  0.1 361492  9408 ?        S&lt;l  08:37   0:00 /usr/bin/pulseaudio --start --log-target=syslog</span><br><span class="line">root      2514  0.0  0.0  12892  1556 pts/1    S+   11:03   0:00 grep -E (cron|syslog)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>zombie</strong><br>发现在某个程序的 CMD 后面还接上 <defunct> 时，就代表该程序是僵尸程序啦,这时我们就需要一步一步跟踪它直到找出它的父程序然后杀掉它！</defunct></li>
</ul>
<h5 id="top"><a href="#top" class="headerlink" title="top"></a>top</h5><p>不同于ps，top可以将目前系统程序运行状态动态的显示出来:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">　root@jack:~# top</span><br><span class="line">　top - 11:13:32 up  2:36,  2 users,  load average: 0.15, 0.18, 0.17</span><br><span class="line">Tasks: 175 total,   2 running, 172 sleeping,   1 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  3.0 us,  0.7 sy,  0.0 ni, 96.3 id,  0.1 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem:   5792464 total,  2549740 used,  3242724 free,   231280 buffers</span><br><span class="line">KiB Swap:  7908348 total,        0 used,  7908348 free.   833968 cached Mem</span><br><span class="line">PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                               </span><br><span class="line"> 1168 root      20   0 2011860 231160  59236 S   5.4  4.0   3:35.12 gnome-shell</span><br></pre></td></tr></table></figure></p>
<p>top默认使用能cpu占用率进行排序！</p>
<h5 id="pstree"><a href="#pstree" class="headerlink" title="pstree"></a>pstree</h5><p> 要找到进程之间的相关性，pstress是必不可少的命令，它会使用线段将相关性进程连接起来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# pstree -up</span><br><span class="line">#列出每个进程的PID以及所属的账号名称</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="进程管理-signal-kill-killall"><a href="#进程管理-signal-kill-killall" class="headerlink" title="进程管理:signal,kill,killall"></a>进程管理:signal,kill,killall</h4><p>进程之间是可以相互控制的，但是又是如何相互控制的呢？其实就是信号了，我们通过给某个进程传递一个讯号从而告知该进程想要它做什么，因此这个信号就很重要了！</p>
<p>下面是主要的一些信号内容:</p>
<table>
<thead>
<tr>
<th style="text-align:center">数字</th>
<th style="text-align:center">名称</th>
<th style="text-align:left">内容</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">SIGHUP</td>
<td style="text-align:left">启动被终止的进程，可让该 PID 重新读取自己的配置档，类似重新启动</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">SIGINT</td>
<td style="text-align:left">相当于用键盘输入 [ctrl]-c 来中断一个进程的进行</td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td style="text-align:center">SIGKILL</td>
<td style="text-align:left">代表强制中断一个进程的进行，如果该进程进行到一半， 那么尚未完成的部分可能会有『半产品』产生，类似 vim会有 .filename.swp 保留下来。</td>
</tr>
<tr>
<td style="text-align:center">15</td>
<td style="text-align:center">SIGTERM</td>
<td style="text-align:left">以正常的结束进程来终止该进程，不是使用于当该进程已近发生错误</td>
</tr>
<tr>
<td style="text-align:center">17</td>
<td style="text-align:center">SIGSTOP</td>
<td style="text-align:left">相当於用键盘输入 [ctrl]-z 来暂停一个进程的进行</td>
</tr>
</tbody>
</table>
<p>那么如何将信号传递给进程呢？就是kill，killall命令了</p>
<ul>
<li><p><strong>kill -singal PID 管理单个进程</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# kill -9 %1</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>killall -singal 进程名称 管理整个服务</strong><br>强制杀掉所有以httpd启动的服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# killall -9 httpd</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>需要强调的是， kill 后面直接加数字（代表进程PID）与加上 %number(jobs查询到的工作号码) 的情况是不同的！</p>
<blockquote>
<h6 id="关于进程的运行顺序"><a href="#关于进程的运行顺序" class="headerlink" title="关于进程的运行顺序"></a>关于进程的运行顺序</h6></blockquote>
<p>Liunx中进程运行的优先顺序与PRI(priority)值有关，PRI的值越低代表越优先的意思，但是这个PRI的值是由系统核心动态调整的，使用者无法直接调整PRI的值，如果想要改变进程的优先顺序，就得通过Nice值，它们的关系是: __PRI(new)=PRI(old)+nice</p>
<p>对root而言nice的可调整范围为:-20-19,一般使用者为0-19,然后我们有两种方式给予某给进程nice值</p>
<ul>
<li><p><strong>nice:在进程开始运行时给予nice值</strong></p>
<p><strong>{ Usage $: nice [-n 数字] command }</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# nice -n -5 vi &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>renice:调整已经运行进程的nice值</strong></p>
<p><strong>{ Usage $: renice [number] PID }</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# ps -l</span><br><span class="line">F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">4 T     0  2384  1606  0  75  -5 - 43557 -      pts/0    00:00:00 vi</span><br><span class="line">0 R     0  2390  1606  0  80   0 -  2708 -      pts/0    00:00:00 ps</span><br><span class="line">root@jack:~# renice 6 2384</span><br><span class="line">2384 (process ID) old priority -5, new priority 6</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h6 id="系统资源观察"><a href="#系统资源观察" class="headerlink" title="系统资源观察"></a>系统资源观察</h6></blockquote>
<ul>
<li><p><strong>free</strong>观察内存使用情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# free </span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:       5792464    1537280    4255184     148380      50304     576536</span><br><span class="line">-/+ buffers/cache:     910440    4882024</span><br><span class="line">Swap:      7908348          0    7908348</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>uname</strong>查看系统核心信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# uname -a</span><br><span class="line">Linux jack 4.0.0-kali1-amd64 #1 SMP Debian 4.0.4-1+kali2 (2015-06-03) x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>uptime</strong>系统启动时间与工作负载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# uptime</span><br><span class="line"> 13:35:42 up 10 min,  2 users,  load average: 0.29, 0.26, 0.21</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>netstat</strong>追踪网络和系统插槽</p>
<p>找出目前系统上已经在监听的网络及其PID</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# netstat -tlnp</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>dmesg</strong>:分析核心信息<br>例如，查看启动时硬盘的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# dmesg | grep -i hd</span><br><span class="line">[    0.082322] NMI watchdog: enabled on all CPUs, permanently consumes one hw-PMU counter.</span><br><span class="line">[    7.737685] iTCO_wdt: Intel TCO WatchDog Timer Driver v1.11</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>或者查看系统网卡相关信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# dmesg | grep -i eth</span><br><span class="line">[    0.881331] e1000e 0000:00:19.0 eth0: registered PHC clock</span><br><span class="line">[    0.881352] e1000e 0000:00:19.0 eth0: (PCI Express:2.5GT/s:Width x1)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>vmstat</strong>检测系统资源变化<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# vmstat</span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line"> 1  0      0 4290044  51168 581576    0    0    96    11   79  420  3  1 93  2  0</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h4 id="0x03-特殊文件与程序"><a href="#0x03-特殊文件与程序" class="headerlink" title="0x03 特殊文件与程序"></a>0x03 特殊文件与程序</h4></blockquote>
<hr>
<blockquote>
<h6 id="具有SUID-SGID权限的命令运行状态"><a href="#具有SUID-SGID权限的命令运行状态" class="headerlink" title="具有SUID/SGID权限的命令运行状态"></a>具有SUID/SGID权限的命令运行状态</h6></blockquote>
<p>如何查找具有SUID/SGID权限的文件和目录？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@jack:/tmp# find / -perm +6000</span><br></pre></td></tr></table></figure></p>
<blockquote>
<h6 id="proc-的意义"><a href="#proc-的意义" class="headerlink" title="/proc/* 的意义"></a>/proc/* 的意义</h6></blockquote>
<p>程序都是存放在内存中的，而内存中的数据又都写到来/proc这个目录中，基本上，目前主机上面的各个程序的 PID 都是以目录的型态存在於 /proc 当中。</p>
<blockquote>
<h6 id="运行文查询-fuser-lsof-pidof"><a href="#运行文查询-fuser-lsof-pidof" class="headerlink" title="运行文查询:fuser,lsof,pidof"></a>运行文查询:fuser,lsof,pidof</h6></blockquote>
<ul>
<li><p><strong>fuser借文件找出正在使用该文件的程序</strong></p>
<p>找出所有使用到/proc这个文件系统的程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# fuser -mvu /proc</span><br><span class="line">                     用户     进程号 权限   命令</span><br><span class="line">/proc:               root     kernel mount (root)/proc</span><br><span class="line">                     root          1 f.... (root)systemd</span><br><span class="line">                     root        241 f.... (root)systemd-journal</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>找出使用到单个文件系统的程序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# fuser -uv /run/systemd//sessions/1.ref </span><br><span class="line">                     用户     进程号 权限   命令</span><br><span class="line">/run/systemd/sessions/1.ref:</span><br><span class="line">                     root        677 f.... (root)systemd-logind</span><br><span class="line">                     root        906 F.... (root)gdm-session-wor</span><br></pre></td></tr></table></figure></p>
<p>杀死该进程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# fuser -ki /run/systemd//sessions/1.ref </span><br><span class="line">/run/systemd/sessions/1.ref:   677   906</span><br><span class="line">杀死进程 677 ? (y/N) n</span><br><span class="line">杀死进程 906 ? (y/N) n</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><strong>lsof找出进程所开启的文件</strong></p>
<p>找出该目录下正在被使用的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# lsof +d /dev</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>找出属于root的bash正在使用的文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# lsof -u root | grep bash</span><br><span class="line">bash      1606 root  cwd       DIR               8,13     4096     524289 /root</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>pidof找出某个正在运行进程的PID</strong><br>找出init进程的pid<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# pidof init</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h4 id="0x04-SELinux"><a href="#0x04-SELinux" class="headerlink" title="0x04 SELinux"></a>0x04 SELinux</h4></blockquote>
<hr>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/27/9.关键字-闭包/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/27/9.关键字-闭包/" itemprop="url">Python(9)-关键字－闭包</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-27T14:06:00+08:00">
                2016-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="0x00-Keywords-关键字"><a href="#0x00-Keywords-关键字" class="headerlink" title="0x00 Keywords(关键字)"></a>0x00 Keywords(关键字)</h2><table>
<thead>
<tr>
<th style="text-align:center">keywords</th>
<th style="text-align:center">description</th>
<th style="text-align:left">example</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">as</td>
<td style="text-align:center">上下文管理器</td>
<td style="text-align:left">with…as…</td>
</tr>
<tr>
<td style="text-align:center">assert</td>
<td style="text-align:center">…</td>
<td style="text-align:left">…</td>
</tr>
<tr>
<td style="text-align:center">break</td>
<td style="text-align:center">跳出循环</td>
<td style="text-align:left">while Treu:break</td>
</tr>
<tr>
<td style="text-align:center">class</td>
<td style="text-align:center">类</td>
<td style="text-align:left">class persion</td>
</tr>
<tr>
<td style="text-align:center">del</td>
<td style="text-align:center">删除字典</td>
<td style="text-align:left">del x[y]</td>
</tr>
<tr>
<td style="text-align:center">except</td>
<td style="text-align:center">异常抛出</td>
<td style="text-align:left">….</td>
</tr>
<tr>
<td style="text-align:center">finally</td>
<td style="text-align:center">最后强制执行</td>
<td style="text-align:left">…</td>
</tr>
<tr>
<td style="text-align:center">global</td>
<td style="text-align:center">全局变量</td>
<td style="text-align:left">…</td>
</tr>
<tr>
<td style="text-align:center">is</td>
<td style="text-align:center">与“==”类似</td>
<td style="text-align:left">…</td>
</tr>
<tr>
<td style="text-align:center">lambad</td>
<td style="text-align:center">自定义函数</td>
<td style="text-align:left">…</td>
</tr>
<tr>
<td style="text-align:center">with</td>
<td style="text-align:center">将一个表达式作为变量</td>
<td style="text-align:left">with x as y:pass</td>
</tr>
<tr>
<td style="text-align:center">yield</td>
<td style="text-align:center">暂停并放回声音</td>
<td style="text-align:left">def x():yield y;x().next()</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="0x01-格式化字符串"><a href="#0x01-格式化字符串" class="headerlink" title="0x01 格式化字符串"></a>0x01 格式化字符串</h2><table>
<thead>
<tr>
<th style="text-align:center">符号</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%d</td>
<td style="text-align:left">整数</td>
<td>“%d” % 45 == ‘45’</td>
</tr>
<tr>
<td style="text-align:center">%i</td>
<td style="text-align:left">与%d一样</td>
<td>…</td>
</tr>
<tr>
<td style="text-align:center">%o</td>
<td style="text-align:left">八进制数</td>
<td>“%o” % 1000 == ‘1750’</td>
</tr>
<tr>
<td style="text-align:center">%u</td>
<td style="text-align:left">无符号十进制数</td>
<td>“%u” % -100 == ‘-100’</td>
</tr>
<tr>
<td style="text-align:center">%c</td>
<td style="text-align:left">字符转换</td>
<td>“%c” % 34 == “ ‘ “</td>
</tr>
<tr>
<td style="text-align:center">%r</td>
<td style="text-align:left">调式，原生输出</td>
<td>“%r” % int == “<type 'int'="">“</type></td>
</tr>
<tr>
<td style="text-align:center">%s</td>
<td style="text-align:left">格式化字符串</td>
<td>“%s there” % “hi” == ‘hi there’</td>
</tr>
<tr>
<td style="text-align:center">%%</td>
<td style="text-align:left">百分号</td>
<td>…</td>
</tr>
<tr>
<td style="text-align:center">%x</td>
<td style="text-align:left">小写十六进制</td>
<td>…</td>
</tr>
<tr>
<td style="text-align:center">%X</td>
<td style="text-align:left">大写十六进制</td>
<td>…</td>
</tr>
<tr>
<td style="text-align:center">%e</td>
<td style="text-align:left">小写科学计数法</td>
<td>…</td>
</tr>
<tr>
<td style="text-align:center">%E</td>
<td style="text-align:left">大写科学计数法</td>
<td>…</td>
</tr>
<tr>
<td style="text-align:center">%f</td>
<td style="text-align:left">浮点数</td>
<td>…</td>
</tr>
<tr>
<td style="text-align:center">%F</td>
<td style="text-align:left">与%f一样</td>
<td>…</td>
</tr>
<tr>
<td style="text-align:center">%g</td>
<td style="text-align:left">%f或者%e，那个短用那个</td>
<td>…</td>
</tr>
<tr>
<td style="text-align:center">%G</td>
<td style="text-align:left">与%g一样，但是大写显示</td>
<td>…</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="0x02-with…as…与上下文管理器"><a href="#0x02-with…as…与上下文管理器" class="headerlink" title="0x02 with…as…与上下文管理器"></a>0x02 with…as…与上下文管理器</h2><p>简单的说<code>with/as</code>语句的设计是作为常见的<code>try/finally</code>用法的模式替代方案.用于定义必须执行的终止或清理行为。</p>
<p>其实这里有一个关于上下文管理器的概念(<code>context manager</code>),是从 python2.5 开始支持的一种语法，用于规定某个对象的使用范围，它的语法形式就是<code>with...as...</code></p>
<p>程序猿们常常在对文件进行操作以后而忘记关闭文件，上下文管理器可以在不需要文件时，自动关闭文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'test.txt'</span>,<span class="string">'w'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    print(file.closed)</span><br><span class="line">    file.write(<span class="string">"hello world"</span>)</span><br><span class="line">print(file.closed)</span><br><span class="line">输出结果:</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line"><span class="keyword">True</span></span><br></pre></td></tr></table></figure>
<p>上下文管理器有隶属于它的程序块,当隶属的程序块执行结束的时候(也就是不再缩进)，上下文管理器自动关闭了文件 (我们通过file.closed来查询文件是否关闭)。我们相当于使用缩进规定了文件对象<code>file</code>的使用范围。</p>
<hr>
<h2 id="0x03-闭包"><a href="#0x03-闭包" class="headerlink" title="0x03 闭包"></a>0x03 闭包</h2><p><code>闭包(closure)</code>是函数式编程的重要语法结构，在面向过程中编程中我们见过函数(function)，在面向对象中编程中我们见过对象(object),以及现在的闭包，它们的根本目的都是一样的，以某种逻辑方式组织代码，提高可重复使用性(reusability).</p>
<p> 先说结论，python中的闭包其实就是一个含有环境变量(你也可以理解为局部变量)取值的函数对象，一个函数和它的环境变量合在一起就构成了一个闭包。</p>
<p> 我们看下面的例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">line_conf</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">line</span><span class="params">(x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> a*x+b</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">def</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line">line1=line_conf(1, 1)</span><br><span class="line">line2=line_conf(<span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">print(line1(<span class="number">5</span>), line2(<span class="number">5</span>))</span><br><span class="line">返回结果:(<span class="number">6</span>,<span class="number">14</span>)</span><br></pre></td></tr></table></figure>
<p>在这个例子中，函数<code>line</code>与环境变量<code>a</code>，<code>b</code>构成了闭包。在创建闭包的时候我们，<code>line_conf</code>的参数<code>a</code>，<code>b</code>说明了这两个变量的取值，我们只需要变换<code>a</code>，<code>b</code>就可以获得不同的直线表达式，由此我们可以看到闭包具有提高代码可重复性的作用！</p>
<blockquote>
<p>参考来源:<a href="http://www.cnblogs.com/vamei/archive/2012/11/23/2772445.html" target="_blank" rel="noopener">http://www.cnblogs.com/vamei/archive/2012/11/23/2772445.html</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/27/第十六章-例行性工作/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/27/第十六章-例行性工作/" itemprop="url">第十六章-例行性管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-27T11:00:00+08:00">
                2016-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-what’s-例行性工作"><a href="#0x00-what’s-例行性工作" class="headerlink" title="0x00 what’s 例行性工作?"></a>0x00 what’s 例行性工作?</h3><p>例行性安排就是计划任务了，简单的讲就是计划一些将来需要执行的程序，我们设置好时间，Linux会负责执行的！</p>
<hr>
<h3 id="0x01-仅运行一次的工作安排-at"><a href="#0x01-仅运行一次的工作安排-at" class="headerlink" title="0x01 仅运行一次的工作安排:at"></a>0x01 仅运行一次的工作安排:at</h3><p>at 是个可以处理仅运行一次就结束排程的命令,不过，并不是所有的人都可以进行 at 工作排程,因为安全性问题哈，所以可以利用 /etc/at.allow 与 /etc/at.deny 这两个文件来进行 at 的使用限制</p>
<ul>
<li>先找寻 <strong>/etc/at.allow</strong> 这个文件，写在这个文件中的使用者才能使用 at，没有在这个文件中的使用者则不能使用at </li>
<li>如果 /etc/at.allow 不存在，就寻找<strong> /etc/at.deny</strong> 这个文件，若写在这个at.deny 的使用者则不能使用 at ，而没有在这个 at.deny 文件中的使用者，就可以使用    at 咯</li>
<li>如果两个文件都不存在，那么只有 root 可以使用 at 这个命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# at now +5 minutes</span><br><span class="line">#root@jack:~# at 23:00 2016-5-1</span><br><span class="line">warning: commands will be executed using /bin/sh</span><br><span class="line">at&gt; ping www.sina.com &gt;&gt; pingsina.txt</span><br><span class="line">at&gt; &lt;EOT&gt;</span><br><span class="line">job 6 at Wed Apr 27 09:49:00 2016</span><br></pre></td></tr></table></figure>
<p>五分钟以后ping sina.com并将结果保存到pingsina.txt文件里<br>当我们输入at命令以后，会进去一个at shell的工作环境里，所以当我们在次at里在写入例行程序时最好使用绝对路径哈！</p>
<p>然后，使用atq查询at工作安排<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# atq</span><br><span class="line">6	Wed Apr 27 09:49:00 2016 a root</span><br></pre></td></tr></table></figure></p>
<p>最后，使用atrm + 例行程序id，atq查询所得的前面的数字代表了该例行程序的ID:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# atrm 7</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="0x02-循环运行的工作安排"><a href="#0x02-循环运行的工作安排" class="headerlink" title="0x02 循环运行的工作安排"></a>0x02 循环运行的工作安排</h3><p> at 是仅运行一次的工作，循环运行的例行性工作排程则是由 cron (crond)这个系统服务来控制的,由於使用者自己也可以进行例行性工作排程，so, Linux 也提供使用者控制例行性工作排程的命(crontab)</p>
<p>与 at 同样的，我们可以限制使用 crontab 的使用者帐号:</p>
<ul>
<li>/etc/cron.allow将可以使用 crontab 的帐号写入其中，若不在这个文件内的使用者则不可使用 crontab</li>
<li>/etc/cron.deny在文件下的账号均不可使用crontab</li>
</ul>
<h4 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h4><p><strong>{ Usage $ : crontab [-u username] [-l | e | -r] }</strong></p>
<ul>
<li>-u:只有root才能运行这个任务</li>
<li>-e:编辑crontab的工作内容</li>
<li>-l:查询工作内容</li>
<li>-r :移除所有工作内容</li>
</ul>
<p>假若你的女朋友生日是 5 月 2 日，你想要在 5 月 1 日的 23:59 发一封信给他，这封信的内容已经写在 /home/dmtsai/lover.txt 内了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# crontab -e</span><br><span class="line">59 23 1 5 * mail kili &lt;/home/jack/birthday.txt&gt;</span><br><span class="line">crontab: installing new crontab</span><br><span class="line">root@jack:~# crontab -l</span><br><span class="line">59 23 1 5 * mail kili &lt;/home/jack/birthday.txt&gt;</span><br></pre></td></tr></table></figure></p>
<p>crontab -e主要是针对使用者的，如果要是对系统经行例行行安排那么请直接修改/etc/crontab文件就行了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# cat /etc/crontab</span><br><span class="line"># /etc/crontab: system-wide crontab</span><br><span class="line"># m h dom mon dow user	command</span><br><span class="line">17 *	* * *	root    cd / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class="line">25 6	* * *	root	test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class="line">47 6	* * 7	root	test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )#</span><br></pre></td></tr></table></figure>
<p><code></code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/25/第十四章-账号管理与ACL权限/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/25/第十四章-账号管理与ACL权限/" itemprop="url">第十四章-账号管理与ACl权限</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-25T20:22:52+08:00">
                2016-04-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-账号与群组"><a href="#0x00-账号与群组" class="headerlink" title="0x00 账号与群组"></a>0x00 账号与群组</h3><hr>
<h4 id="使用者标志符-UID，GID"><a href="#使用者标志符-UID，GID" class="headerlink" title="使用者标志符:UID，GID"></a>使用者标志符:UID，GID</h4><p>在第六章我们提到过，每个文件都具有<strong>使用者与群组</strong>的属性，因为每个登录者都会有两个ID,一个是使用者ID(User ID,UID)，一个是群组ID(Group ID,检查GID)，而每个文件都会有所谓的UID与GID，当我们有要显示文件属性需求时，系统会根据/etc/passwd,/etc/group的内容，找到UID/GID对应的账号与组名在显示出来。</p>
<hr>
<h4 id="使用者账号-etc-passwd，-etc-shadow文件结构"><a href="#使用者账号-etc-passwd，-etc-shadow文件结构" class="headerlink" title="使用者账号:/etc/passwd，/etc/shadow文件结构"></a>使用者账号:/etc/passwd，/etc/shadow文件结构</h4><p>简单的讲/etc/passwd主要记录与UID/GID有关的参数，而/etc/shadow则是就来登录密码的</p>
<h5 id="etc-passwd文件"><a href="#etc-passwd文件" class="headerlink" title="/etc/passwd文件"></a>/etc/passwd文件</h5><p> 该文件结构如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# head -n 4 /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">账号名称/早期口令/UID/GID/用户信息说明兰/家目录/Shell</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br></pre></td></tr></table></figure></p>
<p>该文件使用”:”隔开，共分为7段，说明如下:</p>
<ul>
<li>x:早期unix口令存放段，由于安全性，现已弃用</li>
<li>UID:UID是0是代表该账号是系统超级用户，所以只要将某个使用者的UID改为0，那么他便成为超级用户，但，最好别这样玩。</li>
<li>GID:与/etc/group有关，其实/etc/group与/etc/passwd差不多</li>
<li>用户信息栏:无多大意义</li>
<li>家目录:默认用户的家目录是在/home/yourIDname</li>
<li>Shell:当用户登陆系统后就会取得一个 Shell 来与系统的核心沟通以进行用户的操作任务</li>
</ul>
<h5 id="etc-shadow文件"><a href="#etc-shadow文件" class="headerlink" title="/etc/shadow文件"></a>/etc/shadow文件</h5><p> 该文件结构如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# head -n 2 /etc/shadow</span><br><span class="line">root:$6$OxMBc0:16885:0:99999:7:::</span><br><span class="line">daemon:*:16658:0:99999:7:::</span><br></pre></td></tr></table></figure></p>
<p>同样的该文件使用”:”隔开，共分为9段，说明如下:</p>
<ul>
<li>账号名称：与/etc/passwd对应</li>
<li>密码:经过MD5加密</li>
<li><p>最近更改密码日期:why?16885,这个是因为计算 Linux 日期的时间是以 1970 年 1 月 1 日作为 1 而累加的日期，1971 年 1 月 1 日则为 366 .<br>至于想要知道某个日期的累积日数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# echo $(($(date --date=&quot;2016/04/25&quot; +%s)/86400+1))</span><br><span class="line">16916</span><br></pre></td></tr></table></figure>
</li>
<li><p>密码不可更改天数:0代表随时可改</p>
</li>
<li>密码需重新更改天数:为了强制要求用户变更口令，这个字段可以指定在最近一次更改口令后， 在多少天数内需要再次的变更口令才行。</li>
<li>密码需更改期限前的警告天数</li>
<li>密码过期后的宽限时间（密码失效日）</li>
<li>账号失效日期: 这个账号在此字段规定的日期之后，将无法再使用。    就是所谓的『账号失效』，此时不论你的口令是否有过期，这个『账号』都不能再被使用！    这个字段会被使用通常应该是在『收费服务』的系统中，你可以规定一个日期让该账号不能再使用啦！</li>
<li>保留</li>
</ul>
<hr>
<h4 id="关于群组-etc-group文件结构"><a href="#关于群组-etc-group文件结构" class="headerlink" title="关于群组:/etc/group文件结构"></a>关于群组:/etc/group文件结构</h4><p>该文件结构如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# head -4 /etc/group</span><br><span class="line">root:x:0:</span><br><span class="line">组名/群组口令/GID/该群组支持的账号名称</span><br><span class="line">daemon:x:1:</span><br><span class="line">bin:x:2:</span><br><span class="line">sys:x:3:</span><br></pre></td></tr></table></figure></p>
<p>pass</p>
<hr>
<h3 id="0x01-账号管理"><a href="#0x01-账号管理" class="headerlink" title="0x01 账号管理"></a>0x01 账号管理</h3><hr>
<h4 id="增加与删除使用者"><a href="#增加与删除使用者" class="headerlink" title="增加与删除使用者"></a>增加与删除使用者</h4><h5 id="useradd"><a href="#useradd" class="headerlink" title="useradd"></a>useradd</h5><p> <strong>{ usage $: useradd -[u UID] [-g 初始群组] [-mM] [-d 家目录绝对路径] 账号名 }</strong></p>
<p> 新添加一个用户:jack<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# useradd -g root -d /home jack</span><br></pre></td></tr></table></figure></p>
<h5 id="passwd-口令更改"><a href="#passwd-口令更改" class="headerlink" title="passwd 口令更改"></a>passwd 口令更改</h5><p> <strong>{ usage $ : passwd 账号名 } &lt;=root功能</strong></p>
<p> <strong>{ usage $ : passwd [–stdin] } &lt;==所有人均可更改自己口令</strong></p>
<p> 在root下更改jack口令:<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vroot@jack:~# passwd jack</span><br><span class="line">输入新的 UNIX 密码：</span><br><span class="line">重新输入新的 UNIX 密码：</span><br></pre></td></tr></table></figure></p>
<p>使用stdin更改口令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@jack:~# echo &quot;234&quot; | passwd --stdin jack</span><br><span class="line">``</span><br><span class="line">当然这个不是所有的linux发行版都支持的，比如kali就不支持了</span><br><span class="line"></span><br><span class="line">##### userdel 用户删除</span><br><span class="line"></span><br><span class="line"> __ &#123; usage $ : userdel [-r] username &#125;__</span><br><span class="line">删除jack，连同家目录也删除，并删除所有jack</span><br></pre></td></tr></table></figure></p>
<p>root@jack:~# userdel -r jack<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">其实用户如果在系统上面操作过一阵子了，那么该用户其实在系统内可能会含有其他文件的，如果想要完整的将某个账号完整的移除，最好可以在下达 userdel -r username 之前， 先以『 find / -user username 』查出整个系统内属于 username 的文件，然后再加以删除吧！</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">#### 用户功能</span><br><span class="line"></span><br><span class="line">下面了解下一般使用者常用的系统命令</span><br><span class="line">* __finger__:用来查询用户相关信息，大多是/etc/passwd里面信息</span><br><span class="line">* __chfn__:可理解为chang finger，意义不大</span><br><span class="line">* __chsh__:change shell的缩写，即是更改该用户使用的shell</span><br><span class="line">* __id__:查询自己相关的uid/gid信息，__&#123;id 账号名称&#125;__可用来判断某账号存在不存在</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">#### 新增与删除群组</span><br><span class="line"></span><br><span class="line">##### groupadd:增加群组</span><br><span class="line"> </span><br><span class="line"> __&#123; usage $ : groupadd [-g gid] [-r] 组名 &#125;__</span><br><span class="line"></span><br><span class="line">##### groupdel:删除群组</span><br><span class="line"></span><br><span class="line"> __&#123; usage $ : groupdel 组名 &#125;__</span><br><span class="line">但是删除群组时要确认 /etc/passwd 内的账号没有任何人使用该群组作为initial group 才能删除</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">### 0x02 主机的细部权限规划</span><br><span class="line"></span><br><span class="line">----</span><br><span class="line">#### 什么是ACL？</span><br><span class="line"></span><br><span class="line">ACL是针对单一使用者，对单一文件或目录来进行rwx的权限规范，对于需要特殊权限的使用状况非常有帮助！</span><br><span class="line"></span><br><span class="line">它可以针对使用者，群组，或者在该目录下创建新文件/目录时，配置默认权限。</span><br><span class="line"></span><br><span class="line">##### setfacl:配置某个文件/目录的ACL</span><br><span class="line"></span><br><span class="line">  __&#123; usage $: setfacl [-bkRd] [&#123;-m|-x&#125; acl参数] filename &#125;__</span><br><span class="line"></span><br><span class="line"> __选项与参数:__</span><br><span class="line"> * -m ：配置后续的 acl 参数给文件使用，不可与 -x 合用；</span><br><span class="line"> * -x ：删除后续的 acl 参数，不可与 -m 合用；</span><br><span class="line"> * -b ：移除所有的 ACL 配置参数；</span><br><span class="line"> * -k ：移除默认的 ACL 参数，关于所谓的『默认』参数于后续范例中介绍；</span><br><span class="line"> * -R ：递归配置 acl ，亦即包括次目录都会被配置起来；</span><br><span class="line"> * -d ：配置『默认 acl 参数』的意思！只对目录有效，在该目录新建的数据会引用此默认值</span><br><span class="line"></span><br><span class="line"> 赋予jack用户test文件的rw权限</span><br></pre></td></tr></table></figure></p>
<p>root@jack:~# setfacl -m u:jack:rw test<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### getfacl:查看某个文件/目录的ACL配置</span><br></pre></td></tr></table></figure></p>
<p>root@jack:~# getfacl test </p>
<h1 id="file-test"><a href="#file-test" class="headerlink" title="file: test"></a>file: test</h1><h1 id="owner-root"><a href="#owner-root" class="headerlink" title="owner: root"></a>owner: root</h1><h1 id="group-root"><a href="#group-root" class="headerlink" title="group: root"></a>group: root</h1><p>user::rw-<br>user:jack:rw-  &lt;===新增加的acl权限<br>group::r–<br>mask::rw-<br>other::r–<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">再次查看test文件，发现多了一&quot; + &quot;的权限，就是acl了:</span><br></pre></td></tr></table></figure></p>
<p>root@jack:~# ll test<br>-rw-rw-r–+ 1 root root 0 4月  26 15:37 test<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">如果想要取消文件的全部acl权限，使用__&#123; $ : setfacl -b filename &#125;__就ok了！</span><br><span class="line"></span><br><span class="line">----</span><br><span class="line">### 0x03 使用者切换</span><br><span class="line"></span><br><span class="line">----</span><br><span class="line">#### su</span><br><span class="line"></span><br><span class="line">su用户身份切换，可以直接切换到root，或由root切换到一般用户</span><br><span class="line"></span><br><span class="line">----</span><br><span class="line">#### sudo </span><br><span class="line"></span><br><span class="line">sudo运行root的命令串，但并非所有人都能够运行 sudo ，而是仅有规范到 /etc/sudoers 内的用户才能够运行 sudo 这个命令。</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">### 0x04 使用者的特殊shell与PAM模块</span><br><span class="line"></span><br><span class="line">PAM 可以说是一套应用程序编程接口 (Application Programming Interface, API)，他提供了一连串的验证机制，只要使用者将验证阶段的需求告知 PAM 后， PAM 就能够回报使用者验证的结果 (成功或失败)。</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">### 0x05 用户的信息传递</span><br><span class="line">我们知道查询一个用户的相关信息可以使用id和finger命令，查询最近的登录信息可以使用last，现在我们来了解的多一点。</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">#### w或者who</span><br><span class="line">  想要知道目前已登录在系统上的用户，可以使用w和who</span><br></pre></td></tr></table></figure></p>
<p>root@jack:~# w<br> 16:30:11 up  2:32,  4 users,  load average: 0.26, 0.23, 0.16<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>root     :0       :0               13:58   ?xdm?  11:31   0.09s gdm-session-worker [pam/gdm-password]<br>root     pts/0    :0               14:12    0.00s  0.57s  0.00s w<br>root     pts/1    :0               16:29   23.00s  0.05s  0.00s sh</p>
<p>#第一行显示目前时间，启动多久，几个用户，平均负载</p>
<p>#第二行为各个项目的说明<br>root@jack:~# who<br>root     :0           2016-04-26 13:58 (:0)<br>root     pts/0        2016-04-26 14:12 (:0)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">要知道每个账号的最近登陆的时间，则可以使用 lastlog 这个命令</span><br></pre></td></tr></table></figure></p>
<p>root@jack:~# lastlog<br>用户名           端口     来自             最后登陆时间<br>root                                       <strong>从未登录过</strong><br>daemon                                     <strong>从未登录过</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line">#### write,wall,mesg</span><br><span class="line"></span><br><span class="line"> 用于linux用户间的通信</span><br></pre></td></tr></table></figure></p>
<p>root@jack:~# write jack pts/2 “i am fine ,thank for you “<br><code>`</code><br>wall用于广播信息，mesg用于是否接受信息<strong>{ mesg n }:表示不接受信息</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/29/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><span class="page-number current">30</span><a class="page-number" href="/page/31/">31</a><span class="space">&hellip;</span><a class="page-number" href="/page/33/">33</a><a class="extend next" rel="next" href="/page/31/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">onejustonee</p>
              <p class="site-description motion-element" itemprop="description">onejustone's blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">329</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">103</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">onejustonee</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
