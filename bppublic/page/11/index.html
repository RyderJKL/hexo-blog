<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="onejustone&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="onejustone">
<meta property="og:url" content="http://yoursite.com/page/11/index.html">
<meta property="og:site_name" content="onejustone">
<meta property="og:description" content="onejustone&apos;s blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="onejustone">
<meta name="twitter:description" content="onejustone&apos;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/11/">





  <title>onejustone</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">onejustone</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">--愿你内心有种不灭的火焰，将你与别人区分开来--</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/30/从一个博客说起(2)模板引擎/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/30/从一个博客说起(2)模板引擎/" itemprop="url">从一个博客说起(2)模板引擎</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-30T20:30:00+08:00">
                2016-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-模板引擎"><a href="#0x00-模板引擎" class="headerlink" title="0x00 模板引擎"></a>0x00 模板引擎</h3><p>模板引擎（Template Engine）是一个将页面模板和数据结合起来生成 html 的工具。</p>
<p>模板引擎有很多种，ejs 是其中一种，我们将在项目中使用这种模板引擎:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i ejs --save</span><br></pre></td></tr></table></figure>
<p>比如现在有一个 Express 项目的 <code>app.js</code> 文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const app = express();</span><br><span class="line">app.set(&apos;views&apos;, path.join(__dirname, &apos;views&apos;));// 设置存放模板文件的目录</span><br><span class="line">app.set(&apos;view engine&apos;, &apos;ejs&apos;);// 设置模板引擎为 ejs</span><br></pre></td></tr></table></figure>
<p>通过 <code>app.set</code> 设置模板引擎为 <code>ejs</code> 和存放模板的目录。</p>
<p>然后当我们通过浏览访问网站的时候，Express 将会通过路由解析响应的 <code>url</code>，这时我们就可以使用 <code>res.render</code> 函数渲染 <code>ejs</code> 模板了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var router = express.Router();</span><br><span class="line"></span><br><span class="line">router.get(&apos;/:name&apos;, function(req, res) &#123;</span><br><span class="line">  res.render(&apos;users&apos;, &#123;</span><br><span class="line">    name: req.params.name</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>res.render</code> 的作用就是将模板和数据结合生成 <code>html</code>，同时设置响应头中的 <code>Content-Type: text/html</code>，告诉浏览器我返回的是 <code>html</code>，不是纯文本，要按 <code>html</code> 展示。</p>
<p>ejs 有三种标签:</p>
<ol>
<li><code>&lt;% code %&gt;</code>：运行 JavaScript 代码，不输出</li>
<li><code>&lt;%= code %&gt;</code>：显示转义后的 HTML内容</li>
<li><code>&lt;%- code %&gt;</code>：显示原始 HTML 内容</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/30/从一个博客说起(1)Express初识/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/30/从一个博客说起(1)Express初识/" itemprop="url">从一个博客说起(1)Expresss初识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-30T20:30:00+08:00">
                2016-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-安装-Express"><a href="#0x00-安装-Express" class="headerlink" title="0x00 安装 Express"></a>0x00 安装 Express</h3><p>使用 Express 的前提是，已经安装了 <code>Node.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -g express --save</span><br><span class="line">// 全局安装 Express 并将其保存到依赖列表中：</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x01-使用-Express-生成器"><a href="#0x01-使用-Express-生成器" class="headerlink" title="0x01 使用 Express 生成器"></a>0x01 使用 Express 生成器</h3><p>通过应用生成器工具 express 可以快速创建一个应用的骨架。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install express-generator -g</span><br><span class="line">// 全局安装生成器</span><br><span class="line">express -e NEMBlog</span><br><span class="line">//当前工作目录下创建一个命名为 blog 的应用,并制定模板引擎为 ejs</span><br></pre></td></tr></table></figure>
<p>生成如下目录和文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">λ  express -e NEMBlog</span><br><span class="line"></span><br><span class="line">  D:\Git-Repository\NEMBlogPS&gt;express -e .</span><br><span class="line"></span><br><span class="line">  warning: option `--ejs&apos; has been renamed to `--view=ejs&apos;</span><br><span class="line"></span><br><span class="line">destination is not empty, continue? [y/N] y</span><br><span class="line"></span><br><span class="line">   create : .</span><br><span class="line">   create : ./package.json</span><br><span class="line">   create : ./app.js</span><br><span class="line">   create : ./public</span><br><span class="line">   create : ./public/images</span><br><span class="line">   create : ./public/stylesheets</span><br><span class="line">   create : ./public/stylesheets/style.css</span><br><span class="line">   create : ./public/javascripts</span><br><span class="line">   create : ./routes</span><br><span class="line">   create : ./routes/index.js</span><br><span class="line">   create : ./routes/users.js</span><br><span class="line">   create : ./views</span><br><span class="line">   create : ./views/index.ejs</span><br><span class="line">   create : ./views/error.ejs</span><br><span class="line">   create : ./bin</span><br><span class="line">   create : ./bin/www</span><br><span class="line"></span><br><span class="line">   install dependencies:</span><br><span class="line">     &gt; cd . &amp;&amp; npm install</span><br><span class="line"></span><br><span class="line">   run the app:</span><br><span class="line">     &gt; SET DEBUG=nemblog:* &amp; npm start</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd blog </span><br><span class="line">// 进入应用目录</span><br><span class="line">npm install</span><br><span class="line">// 安装相关依赖</span><br><span class="line">set DEBUG=blog</span><br><span class="line">// 设置测试模式</span><br><span class="line">npm start</span><br><span class="line">// 启动应用</span><br><span class="line">// DEBUG=blog npm start(Mac or Linux)</span><br><span class="line">//启动这个应用</span><br></pre></td></tr></table></figure>
<p>当看到如下信息，代表启动成功:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">D:\blog</span><br><span class="line">λ  set BEBUG=blog</span><br><span class="line">D:\blog</span><br><span class="line">λ  npm start</span><br><span class="line"></span><br><span class="line">&gt; blog@0.0.0 start D:\blog</span><br><span class="line">&gt; node ./bin/www</span><br><span class="line"></span><br><span class="line">GET / 200 1442.953 ms - 170</span><br><span class="line">GET /stylesheets/style.css 200 41.876 ms - 111</span><br></pre></td></tr></table></figure>
<p>访问 <code>localhost:300</code> 可看到 Express 的欢迎页面。</p>
<hr>
<h3 id="0x02-工程结构"><a href="#0x02-工程结构" class="headerlink" title="0x02 工程结构"></a>0x02 工程结构</h3><p>如此，我们使用 Express 初始化了一个工程项目。该工程项目的内部结构如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">D:\blog</span><br><span class="line">λ  ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    目录: D:\blog</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime     Length Name</span><br><span class="line">----                -------------     ------ ----</span><br><span class="line">d----        2016/12/30     16:16            bin</span><br><span class="line">d----        2016/12/30     16:34            node_modules</span><br><span class="line">d----        2016/12/30     16:16            public</span><br><span class="line">d----        2016/12/30     16:16            routes</span><br><span class="line">d----        2016/12/30     16:16            views</span><br><span class="line">-a---        2016/12/30     16:16       1257 app.js</span><br><span class="line">-a---        2016/12/30     16:16        324 package.json</span><br></pre></td></tr></table></figure>
<ul>
<li>app.js: 启动文件。</li>
<li>packages.json: 存储与工程相关的信息及模块依赖。当在 <code>dependecies</code> 中添加依赖的模块时，运行 <code>npm install</code>,npm 会检查当前目录下的 <code>package.json</code>，并自动安装所有指定的模块。</li>
<li>node_modules: 存放 <code>package.json</code> 中安装的模块。</li>
<li>public: 存放 image,css,js等文件。</li>
<li>routes：存放路由文件。</li>
<li>views: 存放视图文件，或者说模块文件。</li>
<li>bin: 存放启动项目的脚本文件。比如，当我们运行 <code>npm start</code> 的时候实际上运行的是 <code>node ./bin/www</code> 命令。</li>
</ul>
<hr>
<h4 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h4><p>我们来看一下 <code>app.js</code> 文件中的内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">D:\blog</span><br><span class="line">λ  cat .\app.js</span><br><span class="line">// 加载依赖库</span><br><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var path = require(&apos;path&apos;);</span><br><span class="line">var favicon = require(&apos;serve-favicon&apos;);</span><br><span class="line">var logger = require(&apos;morgan&apos;);</span><br><span class="line">var cookieParser = require(&apos;cookie-parser&apos;);</span><br><span class="line">var bodyParser = require(&apos;body-parser&apos;);</span><br><span class="line"></span><br><span class="line">// 加载路由控制</span><br><span class="line">var index = require(&apos;./routes/index&apos;);</span><br><span class="line">var users = require(&apos;./routes/users&apos;);</span><br><span class="line"></span><br><span class="line">// 创建项目实例</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">//  定义EJS模板引擎和模板文件位置，也可以使用ejs或其他模型引擎</span><br><span class="line">// view engine setup</span><br><span class="line">app.set(&apos;views&apos;, path.join(__dirname, &apos;views&apos;));</span><br><span class="line">app.set(&apos;view engine&apos;, &apos;jade&apos;);</span><br><span class="line"></span><br><span class="line">// uncomment after placing your favicon in /public</span><br><span class="line">// 定义 icon 图标</span><br><span class="line">//app.use(favicon(path.join(__dirname, &apos;public&apos;, &apos;favicon.ico&apos;)));</span><br><span class="line">// 定义日志和输出级别</span><br><span class="line">app.use(logger(&apos;dev&apos;));</span><br><span class="line">// 定义数据解析器</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; extended: false &#125;));</span><br><span class="line">// 定义cookie解析器</span><br><span class="line">app.use(cookieParser());</span><br><span class="line">// 定义静态文件目录</span><br><span class="line">app.use(express.static(path.join(__dirname, &apos;public&apos;)));</span><br><span class="line"></span><br><span class="line">// 匹配路径和路由</span><br><span class="line">app.use(&apos;/&apos;, index);</span><br><span class="line">app.use(&apos;/users&apos;, users);</span><br><span class="line"></span><br><span class="line">// catch 404 and forward to error handler</span><br><span class="line">// 404 错误处理</span><br><span class="line">app.use(function(req, res, next) &#123;</span><br><span class="line">  var err = new Error(&apos;Not Found&apos;);</span><br><span class="line">  err.status = 404;</span><br><span class="line">  next(err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// error handler</span><br><span class="line">// 生产环境，500 错误处理和错误堆栈跟踪</span><br><span class="line">app.use(function(err, req, res, next) &#123;</span><br><span class="line">  // set locals, only providing error in development</span><br><span class="line">  res.locals.message = err.message;</span><br><span class="line">  res.locals.error = req.app.get(&apos;env&apos;) === &apos;development&apos; ? err : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  // render the error page</span><br><span class="line">  res.status(err.status || 500);</span><br><span class="line">  res.render(&apos;error&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 输出模型</span><br><span class="line">module.exports = app;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="www"><a href="#www" class="headerlink" title="www"></a>www</h4><p><code>bin/www</code> 是一个 node 脚本文件，用于分离配置和启动程序:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">D:\blog\bin</span><br><span class="line">λ  cat www</span><br><span class="line">#!/usr/bin/env node</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Module dependencies.(依赖加载)</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">var app = require(&apos;../app&apos;);</span><br><span class="line">var debug = require(&apos;debug&apos;)(&apos;blog:server&apos;);</span><br><span class="line">var http = require(&apos;http&apos;);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Get port from environment and store in Express.(自定义启动端口)</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">var port = normalizePort(process.env.PORT || &apos;3000&apos;);</span><br><span class="line">app.set(&apos;port&apos;, port);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Create HTTP server.(创建 HTTP 服务器实例)</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">var server = http.createServer(app);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Listen on provided port, on all network interfaces.(启动网络服务监听端口)</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">server.listen(port);</span><br><span class="line">server.on(&apos;error&apos;, onError);</span><br><span class="line">server.on(&apos;listening&apos;, onListening);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Normalize a port into a number, string, or false.(标准化函数)</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">function normalizePort(val) &#123;</span><br><span class="line">  var port = parseInt(val, 10);</span><br><span class="line"></span><br><span class="line">  if (isNaN(port)) &#123;</span><br><span class="line">    // named pipe</span><br><span class="line">    return val;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (port &gt;= 0) &#123;</span><br><span class="line">    // port number</span><br><span class="line">    return port;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Event listener for HTTP server &quot;error&quot; event.（http 异常事件处理程序）</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">function onError(error) &#123;</span><br><span class="line">  if (error.syscall !== &apos;listen&apos;) &#123;</span><br><span class="line">    throw error;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  var bind = typeof port === &apos;string&apos;</span><br><span class="line">    ? &apos;Pipe &apos; + port</span><br><span class="line">    : &apos;Port &apos; + port;</span><br><span class="line"></span><br><span class="line">  // handle specific listen errors with friendly messages</span><br><span class="line">  switch (error.code) &#123;</span><br><span class="line">    case &apos;EACCES&apos;:</span><br><span class="line">      console.error(bind + &apos; requires elevated privileges&apos;);</span><br><span class="line">      process.exit(1);</span><br><span class="line">      break;</span><br><span class="line">    case &apos;EADDRINUSE&apos;:</span><br><span class="line">      console.error(bind + &apos; is already in use&apos;);</span><br><span class="line">      process.exit(1);</span><br><span class="line">      break;</span><br><span class="line">    default:</span><br><span class="line">      throw error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Event listener for HTTP server &quot;listening&quot; event.(事件绑定函数)</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">function onListening() &#123;</span><br><span class="line">  var addr = server.address();</span><br><span class="line">  var bind = typeof addr === &apos;string&apos;</span><br><span class="line">    ? &apos;pipe &apos; + addr</span><br><span class="line">    : &apos;port &apos; + addr.port;</span><br><span class="line">  debug(&apos;Listening on &apos; + bind);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x03-关于静态目录"><a href="#0x03-关于静态目录" class="headerlink" title="0x03 关于静态目录"></a>0x03 关于静态目录</h3><p>可以通过 Express 中的 <code>express.static</code> 内置中间件函数设置静态目录。将包含静态资源的目录的名称传递给 <code>express.static</code> 中间件函数便可以直接访问图像、CSS 文件和 JavaScript 文件之类的静态文件。</p>
<h5 id="几个路径问题-dirname-filename-process-cwd"><a href="#几个路径问题-dirname-filename-process-cwd" class="headerlink" title="几个路径问题 dirname,filename, process.cwd() , ./, ../"></a>几个路径问题 <strong>dirname,</strong>filename, process.cwd() , ./, ../</h5><p>假如 <code>app.js</code> 文件位于 <code></code> 下,我们在 <code>app.js</code> 中运行如下代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server.listen(7880, function()&#123;</span><br><span class="line">	console.log(&apos;Web Server Start&apos;);</span><br><span class="line">	console.log(&apos;__dirname:&apos;+ __dirname)</span><br><span class="line">	console.log(&apos;__filename:&apos; + __filename)</span><br><span class="line">	console.log(&apos;process.cwd:&apos; + process.cwd())</span><br><span class="line">	console.log(&apos;./&apos;+ path.resolve(&apos;./&apos;));</span><br><span class="line">	console.log(&apos;../:&apos;+ path.resolve(&apos;../&apos;))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// path.resolve(&apos;./&apos;) 可以将(./)等转换为绝对路径。</span><br><span class="line"></span><br><span class="line">输出结果如下:</span><br><span class="line"></span><br><span class="line">__dirname:D:\Git-Repository\GoChat</span><br><span class="line">__filename:D:\Git-Repository\GoChat\app.js</span><br><span class="line">process.cwd:D:\Git-Repository\GoChat</span><br><span class="line">./D:\Git-Repository\GoChat</span><br><span class="line">../:D:\Git-Repository</span><br></pre></td></tr></table></figure>
<p>如此得出如下结果:</p>
<ul>
<li><code>__dirname</code>:  当前文件所在文件夹的绝对路径</li>
<li><code>__filename</code>: 当前文件的绝对路径</li>
<li><code>process.cwd()</code>:总是返回运行 node 命令时所在的文件夹的绝对路径</li>
<li><code>./</code>: 当前文件所在路径</li>
<li><p><code>../</code>: 当前文件的上一级路径</p>
<hr>
<h3 id="0x04-使用-supervisor"><a href="#0x04-使用-supervisor" class="headerlink" title="0x04 使用 supervisor"></a>0x04 使用 supervisor</h3></li>
</ul>
<p>supervisor 相当于 node 的热修复，它会监听当前目录下 node 和 js 后缀的文件，当这些文件发生改动时，supervisor 会自动重启程序,而我们不用手动重新启动整个程序。</p>
<p>全局安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g supervisor</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/30/从一个博客说起(2)Express路由/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/30/从一个博客说起(2)Express路由/" itemprop="url">从一个博客说起(2)Express路由</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-30T20:30:00+08:00">
                2016-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/30/从一个博客说起(3)使用MongoDB/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/30/从一个博客说起(3)使用MongoDB/" itemprop="url">从一个博客说起(3)使用MongoDB</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-30T20:30:00+08:00">
                2016-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-关于-MongoDB"><a href="#0x00-关于-MongoDB" class="headerlink" title="0x00 关于 MongoDB"></a>0x00 关于 MongoDB</h3><p>MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。<br>MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。</p>
<hr>
<h3 id="0x01-安装-MongoDB"><a href="#0x01-安装-MongoDB" class="headerlink" title="0x01 安装 MongoDB"></a>0x01 安装 MongoDB</h3><h4 id="创建数据目录"><a href="#创建数据目录" class="headerlink" title="创建数据目录"></a>创建数据目录</h4><p>创建数据目录( <code>\data\db</code> )用于存放 MongoDB 数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Path</span><br><span class="line">----</span><br><span class="line">D:\Git-Repository\NEMBlog\data\db</span><br></pre></td></tr></table></figure>
<h4 id="命令下运行-MongoDB-数据库服务"><a href="#命令下运行-MongoDB-数据库服务" class="headerlink" title="命令下运行 MongoDB 数据库服务"></a>命令下运行 MongoDB 数据库服务</h4><p>为了从命令提示符下运行MongoDB服务器，你必须从MongoDB目录的 <code>bin</code> 目录中执行 <code>mongod.exe</code> 文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\MongoDB\Server\3.4\bin\mongod.exe --dbpath D:\Git-Repository\NEMBlog\data\db</span><br></pre></td></tr></table></figure>
<p>当然，每次都这么运行的话，我会疯掉的，懒人 Tips : 在 <code>PowerShell</code> 中添加命令别名，以快速获得启动的路径:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">function run-Mongod &#123;&quot;&apos;C:\Program Files\MongoDB\Server\3.4\bin\mongod.exe&apos; --dbpath D:\Git-Repository\NEMBlog\data\db&quot;&#125;</span><br><span class="line">Set-Alias mongod run-Mongod</span><br></pre></td></tr></table></figure>
<p>如果执行成功，会输出如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\onejustone</span><br><span class="line">λ  &amp; &apos;C:\Program Files\MongoDB\Server\3.4\bin\mongod.exe&apos; --dbpath D:\Git-Repository\NEMBlog\data\db</span><br><span class="line">2017-01-20T11:39:55.542+0800 I CONTROL  [initandlisten] MongoDB starting : pid=1420 port=27017 dbpath=D:\Git-Repository\NEMBlog\data\db 64-bit host=onejustone404</span><br><span class="line">2017-01-20T11:39:55.545+0800 I CONTROL  [initandlisten] targetMinOS: Windows 7/Windows Server 2008 R2</span><br><span class="line">2017-01-20T11:39:55.546+0800 I CONTROL  [initandlisten] db version v3.4.0</span><br><span class="line">2017-01-20T11:39:55.546+0800 I CONTROL  [initandlisten] git version: f4240c60f005be757399042dc12f6addbc3170c1</span><br><span class="line">2017-01-20T11:39:55.546+0800 I CONTROL  [initandlisten] OpenSSL version: OpenSSL 1.0.1t-fips  3 May 2016</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="MongoDB后台管理-Shell"><a href="#MongoDB后台管理-Shell" class="headerlink" title="MongoDB后台管理 Shell"></a>MongoDB后台管理 Shell</h4><p>如果你需要进入MongoDB后台管理，你需要先打开 <code>mongodb</code> 装目录的下的 <code>bin</code> 目录，然后执行 <code>mongo.exe</code> 文件，MongoDB Shell是MongoDB自带的交互式 Javascript shell,用来对MongoDB进行操作和管理的交互式环境。</p>
<p>默认连接 <code>test</code> 数据库:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">λ  mongo</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line"></span><br><span class="line">&gt; db</span><br><span class="line">test</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="0x02-使用-Node-js-连接-MongonDB-数据库"><a href="#0x02-使用-Node-js-连接-MongonDB-数据库" class="headerlink" title="0x02 使用 Node.js 连接 MongonDB 数据库"></a>0x02 使用 Node.js 连接 MongonDB 数据库</h4><p>首先需要官方提供的 <code>node-mongodb-native</code> 驱动模块，在 <code>package.json</code> 文件的 <code>dependencies</code> 自动添加依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;mongodb&quot;: &quot;*&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行 <code>npm install</code> 等待模块下载完成。</p>
<p>然后在工程根目录中创建 <code>settings.js</code> 文件，用于保存工程的配置信息，比如，数据库连接信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">moduel.export = &#123;</span><br><span class="line">	db: &apos;db&apos;,</span><br><span class="line">	// db ：代表数据库名称</span><br><span class="line">	host: &apos;localhost&apos;</span><br><span class="line">	// host: 数据库地址</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着在工程根目录下创建 <code>models</code> 文件夹，并在该文件夹中新建 <code>db.js</code> 文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by onejustone on 2017/1/18.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">var settings = rquire(&apos;../settings&apos;),</span><br><span class="line">	Db = require(&apos;mongodb&apos;).Db,</span><br><span class="line">	Connection = rquire(&apos;mongodb&apos;).Connection,</span><br><span class="line">	Server = rquire(&apos;mongodb&apos;).Server;</span><br><span class="line"></span><br><span class="line">module.exports = new Db(settings.db,</span><br><span class="line">	new Server(settings.host,</span><br><span class="line">	Connection.DEFAULT_PORT,</span><br><span class="line">	&#123;&#125;),&#123;safe: true&#125;</span><br><span class="line">	// 创建一数据库连接实例，并通过 module.exports 导出该实例</span><br><span class="line">	// 设置数据库名，数据库地址，数据库端口</span><br><span class="line">	);</span><br></pre></td></tr></table></figure>
<p>如上，我们创建了一个数据库连接实例，以后便可以通过 <code>require</code> 来对该数据库进行读写操作了。</p>
<hr>
<h3 id="0x03-添加-Session-会话支持"><a href="#0x03-添加-Session-会话支持" class="headerlink" title="0x03 添加 Session 会话支持"></a>0x03 添加 Session 会话支持</h3><p>运行 <code>npm install express-session</code> 安装 <code>session</code> ， 等待依赖模块安装完成。然后在 <code>app.js</code> 的 <em>var path = require(‘path’)</em> 后添加如下代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var session = require(&apos;express-session&apos;);</span><br><span class="line">var  MongoStore = require(&apos;connect-mongo&apos;)(session);</span><br><span class="line">var settings = require(&apos;./settings&apos;);</span><br></pre></td></tr></table></figure>
<p>在 <code>app.use(cookieParser());</code> 后添加如下代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.use(cookieParser());</span><br><span class="line">app.use(session(&#123;</span><br><span class="line">  secret: settings.cookieSecret,</span><br><span class="line">    key: settings.db, // cookie name</span><br><span class="line">    cookie: &#123;maxAge: 1000*60*60*24*30&#125;, // 30days</span><br><span class="line">    store: new MongoStore(&#123;</span><br><span class="line">	    url: &apos;mongodb://localhost/&apos; + settings.db,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<p>如上，<code>cookieParse()</code> 是用来解析 Cookie 的中间件。而 <code>express.session</code> 则用来提供会话支持，<code>secret</code> 用于防止篡改 Cookie，<code>key</code> 是 Cookie 的名字,<code>maxAgae</code> 设置 Cookie 的生命周期为 30 天。设置其 <code>store</code> 参数为 <code>MongoStroe</code> 实例，把会话信息存储到数据库中。</p>
<blockquote>
<p>好吧，Express 升级到 4.x 后全是坑，我也会醉了。。。</p>
</blockquote>
<p>最后，推荐使用, <code>supervisor</code> , 安装命令: <code>npm install supervisor</code> ，以此便于调试，以后每次修改代码，直接刷新浏览器就行，无需再次重启服务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">D:\Git-Repository\NEMBlogPS&gt;supervisor app</span><br><span class="line"></span><br><span class="line">Running node-supervisor with</span><br><span class="line">  program &apos;app&apos;</span><br><span class="line">  --watch &apos;.&apos;</span><br><span class="line">  --extensions &apos;node,js&apos;</span><br><span class="line">  --exec &apos;node&apos;</span><br><span class="line"></span><br><span class="line">Starting child process with &apos;node app&apos;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/27/http模块(1)之客户端/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/27/http模块(1)之客户端/" itemprop="url">http模块(1)之客户端</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-27T09:18:00+08:00">
                2016-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-http-模块对-HTTP-客户端的支持"><a href="#0x00-http-模块对-HTTP-客户端的支持" class="headerlink" title="0x00 http 模块对 HTTP 客户端的支持"></a>0x00 http 模块对 HTTP 客户端的支持</h3><p><code>http</code> 模块提供了创建HTTP客户端对象的方法，使用客户端对象可以创建对HTTP服务的访问。</p>
<p>我们有两种方式去创建出一个 HTTP 客户端。 <code>http.request</code> 和 <code>http.get</code>，以向服务器发送请求。</p>
<p><code>http.get()</code>方法实际上是一个快捷方法，因为在HTTP请求中，使用最多的是没有报文体的 GET 请求，所以Node提供了这个简便的方法。和 <code>http.request()</code>不同点在于，这个方法会自动设置HTTP请求方式为 <code>GET</code>，并自动调用<code>req.end()</code>方法。</p>
<hr>
<h4 id="http-request-创建-HTTP-客户端"><a href="#http-request-创建-HTTP-客户端" class="headerlink" title="http.request() 创建 HTTP 客户端"></a>http.request() 创建 HTTP 客户端</h4><p><code>http.request(optons [, callback])</code> 方法用于创建HTTP请求，该方法会返回一个 <code>http.ClientRequest</code> 对象的实例。  </p>
<p><code>ClientRequest</code> 实例是一个可写流对象。当使用POST请求给服务器发送数据时，就要将其写入到 <code>ClientRequest</code> 对象。</p>
<p>此外,<code>options</code> 可以是一个对象或一个字符串。如果 <code>options</code> 是一个字符串, 它将自动使用 <code>url.parse()</code> 解析。如果是一个对象，可能包含以下值：</p>
<ul>
<li>host：请求的服务器域名或 IP 地址。默认：<code>localhost</code></li>
<li>hostname：用于支持 <code>url.parse()</code>。<code>hostname</code>优于<code>host</code></li>
<li>port：远程服务器端口。 默认： 80.</li>
<li>localAddress：用于绑定网络连接的本地接口</li>
<li>socketPath：<code>Unix域socket</code>（使用host:port或socketPath）</li>
<li>method：HTTP请求方法。默认：<code>GET</code>。</li>
<li>path：请求路径。默认：’/‘。如果有查询字符串（查询参数），则需要包含。例如 <code>/index.html?page=12</code>。请求路径包含非法字符时抛出异常。目前，只有空格不支持，以后可能改变。</li>
<li>headers：包含请求头的对象</li>
<li>auth：用于计算认证头的基本认证，即 <code>user:password</code></li>
<li>agent：控制<code>Agent</code>的行为。当使用了一个<code>Agent</code>的时候，请求将默认为 <code>Connection: * keep-alive</code>。可能的值为：<ul>
<li>undefined (default)：在这个主机和端口上使用 <code>global Agent</code></li>
<li>Agent object：在<code>Agent</code>中显式使用 <code>passed</code></li>
<li>false：选择性停用连接池，默认请求为：<code>Connection: close</code></li>
</ul>
</li>
<li>keepAlive：{Boolean} 用于保持资源池周围的socket，未来可能会用于其它请求。默认值为false。</li>
<li>keepAliveMsecs：{Integer} 使用HTTP KeepAlive的时候，通过正在保持活动的sockets发送TCP KeepAlive包的频繁程度。默认值为1000。仅当keepAlive为true时才可用。</li>
</ul>
<hr>
<h3 id="0x01-http-ClientRequest-客户端请求对象"><a href="#0x01-http-ClientRequest-客户端请求对象" class="headerlink" title="0x01 http.ClientRequest 客户端请求对象"></a>0x01 http.ClientRequest 客户端请求对象</h3><p><code>http.ClientRequest</code> 对象由 <code>http.request()</code> 或者 <code>http.get()</code> 创建后返回。其表示的是一个 <em>正在处理的 HTTP 请求</em> ，其头部已经进入请求队列，但是依然可以通过 <code>setHeader(name, value</code>),<code>getHeader(name)</code>,<code>removeHeader(name)</code> 等对其进行修改。实际的头部会随着第一个数据块发送，或在连接关闭时发送。</p>
<p> <code>http.request()</code> 方法的 <code>callback</code> 参数或<code>response</code>事件监听器，获得的是服务端响应对象，即 <code>http.IncomingMessage</code> 实例。</p>
<p>在 <code>response</code> 事件期间，可以为响应对象添加监听器，尤其是监听 <code>data</code> 事件，即可获取服务端响应数据。如果没有添加 <code>response</code> 处理函数，响应将被完全忽略。</p>
<p><code>ClientRequest</code> 是一个 <code>Writable Stream</code>，同时还是一个 <code>EventEmitter</code>。</p>
<hr>
<h4 id="http-ClientRequest-中的事件"><a href="#http-ClientRequest-中的事件" class="headerlink" title="http.ClientRequest 中的事件"></a>http.ClientRequest 中的事件</h4><h5 id="response-事件"><a href="#response-事件" class="headerlink" title="response 事件"></a>response 事件</h5><p>监听函数 <code>function (response) { }</code>。<br>当接收到请求的响应时触发，该事件只被触发一次。<code>response</code> 参数是 <code>http.IncomingMessage</code> 的一个实例。</p>
<h5 id="socket-事件"><a href="#socket-事件" class="headerlink" title="socket 事件"></a>socket 事件</h5><p>监听函数 <code>function (socket) { }</code> Socket 附加到这个请求的时候触发。</p>
<h5 id="connect-事件"><a href="#connect-事件" class="headerlink" title="connect 事件"></a>connect 事件</h5><p>监听函数 <code>function (response, socket, head) { }</code><br>每次服务器使用 <code>CONNECT</code> 方法响应一个请求时触发。如果该事件未被监听，接收 <code>CONNECT</code> 方法的客户端将关闭它们的连接。</p>
<hr>
<h4 id="http-ClientRequest-中的方法"><a href="#http-ClientRequest-中的方法" class="headerlink" title="http.ClientRequest 中的方法"></a>http.ClientRequest 中的方法</h4><h5 id="request-write-chunk-encoding"><a href="#request-write-chunk-encoding" class="headerlink" title="request.write(chunk, [encoding])"></a>request.write(chunk, [encoding])</h5><p>发送一块请求体。通过多次调用这个函数，用户可以流式地发送请求体至服务器。在这种情况下，创建请求时建议使用 <code>[&#39;Transfer-Encoding&#39;, &#39;chunked&#39;]</code> 头。</p>
<p>参数：<code>chunk</code> 必须是Buffer或字符串。<code>encoding</code> 参数是可选的, 只能在 <code>chunk</code> 是 <code>string</code> 类型的时候才能设置，默认是 <code>utf8</code>。</p>
<h5 id="request-end-data-encoding"><a href="#request-end-data-encoding" class="headerlink" title="request.end([data], [encoding])"></a>request.end([data], [encoding])</h5><p>结束发送请求。如果请求体中还有未发送数据，该函数将会把它们flush到流中。</p>
<p>如果指定了 <code>data</code>，那么相当于 先调用 <code>request.write(data, encoding)</code> 方法，再调用 <code>request.end()</code> 方法。</p>
<h5 id="request-abort"><a href="#request-abort" class="headerlink" title="request.abort()"></a>request.abort()</h5><p>终止一个请求。</p>
<h5 id="request-setTimeout-timeout-callback"><a href="#request-setTimeout-timeout-callback" class="headerlink" title="request.setTimeout(timeout, [callback])"></a>request.setTimeout(timeout, [callback])</h5><p>一旦一个套接字被分配给该请求并且完成连接，<code>socket.setTimeout()</code> 将会被调用。</p>
<hr>
<h3 id="0x02-创建一个HTTP客户端"><a href="#0x02-创建一个HTTP客户端" class="headerlink" title="0x02 创建一个HTTP客户端"></a>0x02 创建一个HTTP客户端</h3><p>创建一个HTTP客户端，<code>GET</code> 请求 baidu.com网站的根目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">let http = require(&apos;http&apos;)</span><br><span class="line"></span><br><span class="line">let options = &#123;</span><br><span class="line">    host:&apos;itbilu.com&apos;,</span><br><span class="line">    method:&apos;GET&apos;,</span><br><span class="line">    path:&apos;/&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let req = http.request(options)</span><br><span class="line">req.on(&apos;response&apos;, function (res) &#123;</span><br><span class="line">    res.setEncoding(&apos;utf-8&apos;)</span><br><span class="line">    res.on(&apos;data&apos;, function (chunk) &#123;</span><br><span class="line">        console.log(&apos;收到数据: %s&apos;,chunk);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">req.end()</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/26/ http(2)模块之服务器端/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/26/ http(2)模块之服务器端/" itemprop="url">http模块(2)之服务器端</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-26T14:45:00+08:00">
                2016-12-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-http-模块"><a href="#0x00-http-模块" class="headerlink" title="0x00 http 模块"></a>0x00 http 模块</h3><p>通过 Node.js  的 <code>http</code> 模块中的 <code>http.createServer</code> 方法我们可以很轻松的创建出一个 <code>http</code> 服务器或者使用 <code>http.request</code> 方法创建出一个 <code>http</code> 客户端。 Node 对 HTTP 协议及其相关的 API 的封装是比较底层的其仅能处理流和消息，对于消息的处理，也仅解析成报文头和报文体，但是不解析实际的报文头和报文体内容。如此使得其对 HTTP 的应用更加灵活。</p>
<hr>
<h3 id="0x01-http-模块对-HTTP-服务端的支持"><a href="#0x01-http-模块对-HTTP-服务端的支持" class="headerlink" title="0x01 http 模块对 HTTP 服务端的支持"></a>0x01 http 模块对 HTTP 服务端的支持</h3><p>我们需要通过一个 <code>http.Server</code> 对象来创建一个 HTTP 服务器。<br>有两种方式可以创建出 <code>http.Server</code> 对象，<code>http.createServer()</code> 或 <code>new http.Server()</code>。</p>
<hr>
<h4 id="http-Server-创建-HTTP-服务器"><a href="#http-Server-创建-HTTP-服务器" class="headerlink" title="http.Server() 创建 HTTP 服务器"></a>http.Server() 创建 HTTP 服务器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line">let http = require(&apos;http&apos;)</span><br><span class="line"></span><br><span class="line">// 创建 server 对象，并通过 server 对象的 request 事件添加事件监听器</span><br><span class="line">let server = new http.Server()</span><br><span class="line">server.on(&apos;request&apos;,function (req, res) &#123;</span><br><span class="line">    res.writeHead(200, &#123;&apos;Content-Type&apos;:&apos;text/html&apos;&#125;)</span><br><span class="line">    res.end(&quot;&lt;h1&gt;hello world!&lt;/h1&gt;&quot;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(8088)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="http-createServer-requestListener-创建-HTTP-服务器"><a href="#http-createServer-requestListener-创建-HTTP-服务器" class="headerlink" title="http.createServer([requestListener]) 创建 HTTP 服务器"></a>http.createServer([requestListener]) 创建 HTTP 服务器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line">let http = require(&apos;http&apos;)</span><br><span class="line"></span><br><span class="line">// 创建 server 对象，并添加 request 事件监听器</span><br><span class="line">let server = http.createServer(function (request, response) &#123;</span><br><span class="line">    console.log(request.method+&apos;:&apos;+request.url)</span><br><span class="line">    response.writeHead(200, &#123;&apos;Content-Type&apos;:&apos;text/html&apos;&#125;)</span><br><span class="line">    response.end(&apos;&lt;h1&gt;hello world&lt;/h1&gt;&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(8088)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x02-关于-http-Server-对象"><a href="#0x02-关于-http-Server-对象" class="headerlink" title="0x02 关于 http.Server 对象"></a>0x02 关于 http.Server 对象</h3><p><code>http.Server</code> 对象其实是一个事件发射器 <code>EventEmitter</code>。在其事件监听器中也会创建一些对象，如：<code>request</code> 事件会创建http.<code>IncomingMessage</code>和<code>http.ServerResponse</code>。</p>
<hr>
<h4 id="http-Server-对象中的事件"><a href="#http-Server-对象中的事件" class="headerlink" title="http.Server 对象中的事件"></a>http.Server 对象中的事件</h4><p>在此只列出来几个常用的事件。</p>
<h5 id="request-事件"><a href="#request-事件" class="headerlink" title="request 事件"></a>request 事件</h5><p><code>request</code> 事件监听函数为 <code>function (request, response) {}</code>，其接收的两个参数:<code>request</code> 是一个 <code>http.IncomingMessage</code> 实例，而 <code>response</code> 是一个 <code>http.ServerResponse</code> 实例。</p>
<h5 id="close-事件"><a href="#close-事件" class="headerlink" title="close 事件"></a>close 事件</h5><p>其监听函数格式为 <code>function () { }</code> ，当此服务器关闭时触发。</p>
<h5 id="clientError-事件"><a href="#clientError-事件" class="headerlink" title="clientError 事件"></a>clientError 事件</h5><p>其监听函数格式为<code>function (exception, socket) { }</code></p>
<p>当客户端连接触发了一个<code>error</code>事件时，事件会被传送到这里.</p>
<hr>
<h4 id="http-Server-对象中的方法"><a href="#http-Server-对象中的方法" class="headerlink" title="http.Server 对象中的方法"></a>http.Server 对象中的方法</h4><h5 id="server-listen-hostname-port-callbakc"><a href="#server-listen-hostname-port-callbakc" class="headerlink" title="server.listen([hostname],port,callbakc)"></a>server.listen([hostname],port,callbakc)</h5><p>调用 <code>http.Server</code> 对象的 <code>server.listen</code> 事件监听方法以后就可以接受客户端的连接了。</p>
<h5 id="server-close-callback"><a href="#server-close-callback" class="headerlink" title="server.close([callback])"></a>server.close([callback])</h5><p>服务器停止接收新的连接，保持现有连接。当所有连接结束的时候服务器会关闭，并会触发 <code>close</code> 事件。</p>
<h5 id="server-setTimeout-msecs-callback"><a href="#server-setTimeout-msecs-callback" class="headerlink" title="server.setTimeout(msecs, callback)"></a>server.setTimeout(msecs, callback)</h5><p>设置 <code>Socket</code> 套接字的超时时间，单位 msecs 为秒。如果一个超时发生，那么Server对象上会分发一个<code>timeout</code> 事件，同时将套接字作为参数传递。Server默认超时时间为 2 分钟，如果超时将会销毁 <code>Socket</code>。</p>
<hr>
<h4 id="http-Server-对象中的属性"><a href="#http-Server-对象中的属性" class="headerlink" title="http.Server 对象中的属性"></a>http.Server 对象中的属性</h4><h5 id="server-maxHeadersCount"><a href="#server-maxHeadersCount" class="headerlink" title="server.maxHeadersCount"></a>server.maxHeadersCount</h5><p>最大请求头的数量限制，默认 1000。如果设置为 0，则不做任何限制</p>
<h5 id="server-timeout"><a href="#server-timeout" class="headerlink" title="server.timeout"></a>server.timeout</h5><p><code>Socket</code> 套接字被判断为超时时间，单位为毫秒，默认 12000（2分钟）。设置为 0后，则不受超时限制。</p>
<hr>
<h3 id="0x03-http-ServerResponse-对象"><a href="#0x03-http-ServerResponse-对象" class="headerlink" title="0x03 http.ServerResponse 对象"></a>0x03 http.ServerResponse 对象</h3><p><code>http.ServerResponse</code> 是一个由 <code>http.Server</code> 创建的服务器响应对象。在触发<code>request</code>事件后，做事件回调函数的第二个参数传递给回调函数。<code>http.ServerResponse</code> 实现了Writable Stream接口，它同样也是一个 <code>EventEmitter</code>。</p>
<hr>
<h4 id="http-ServerResponse-中的事件"><a href="#http-ServerResponse-中的事件" class="headerlink" title="http.ServerResponse 中的事件"></a>http.ServerResponse 中的事件</h4><h5 id="close-事件-1"><a href="#close-事件-1" class="headerlink" title="close 事件"></a>close 事件</h5><p>事件：<code>close</code>，其监听函数格式为 <code>function () { }</code></p>
<p>在调用 <code>response.end()</code>，或准备 <code>flush</code> 前触发，触发后底层连接结束。</p>
<h5 id="finish-事件"><a href="#finish-事件" class="headerlink" title="finish 事件"></a>finish 事件</h5><p>事件：<code>finish</code>，其监听函数格式为 <code>function () { }</code></p>
<p>发送完响应后（服务器响应完成）触发。响应头和响应体最后一段数据离开操作系统，通过网络来传输时被触发，这并不代表客户端已经收到数据。这个事件之后,<code>http.ServerResponse</code> 不会再触发任何事件。</p>
<hr>
<h4 id="http-ServerResponse-中的方法"><a href="#http-ServerResponse-中的方法" class="headerlink" title="http.ServerResponse 中的方法"></a>http.ServerResponse 中的方法</h4><h5 id="response-writeContinue"><a href="#response-writeContinue" class="headerlink" title="response.writeContinue()"></a>response.writeContinue()</h5><p>发送HTTP/1.1 100 Continue 消息给客户端，表示请求体可以发送，会触发 <code>http.Server</code> 的<code>checkContinue</code> 事件。</p>
<h5 id="response-writeHead-statusCode-statusMessage-headers"><a href="#response-writeHead-statusCode-statusMessage-headers" class="headerlink" title="response.writeHead(statusCode[, statusMessage][, headers])"></a>response.writeHead(statusCode[, statusMessage][, headers])</h5><p>向客户端请求发送一个响应头。<code>statusCode</code> 状态码是 3 位数字，如：404。可通过 <code>statusMessage</code> 设置状态消息。最后一个参数 <code>headers</code> 是响应头。</p>
<p>该方法方法在当前请求中仅能调用一次，而且必须在 <code>response.end()</code> 前调用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let body = &apos;example.com&apos;</span><br><span class="line">response.writeHead(200, &apos;OK&apos;,&#123;</span><br><span class="line">    &apos;Content-Length&apos;:body.length,</span><br><span class="line">    &apos;Content-Type&apos;:&apos;text/plain&apos;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="response-setHeader-name-value"><a href="#response-setHeader-name-value" class="headerlink" title="response.setHeader(name, value)"></a>response.setHeader(name, value)</h5><p>为默认或者已存在的头设置一条单独的头内容。如果这个头已经存在于，将会覆盖原来的内容。如果想设置多个值， 就使用一个相同名字的字符串数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(&apos;Content-Type&apos;, &apos;text/html&apos;)</span><br><span class="line">response.setHeader(&apos;Set-Cookie&apos;, [&apos;userName = jack&apos;,&apos;password=123&apos;])</span><br></pre></td></tr></table></figure>
<h5 id="response-setTimeout-msecs-callback"><a href="#response-setTimeout-msecs-callback" class="headerlink" title="response.setTimeout(msecs, callback)"></a>response.setTimeout(msecs, callback)</h5><p>设置<code>Socket</code>套接字的超时时间，单位 <code>msecs</code> 为秒。如果提供了回调函数，其将会做为响应对象的<code>timeout</code>事件的监听器。</p>
<h5 id="response-write-chunk-encoding"><a href="#response-write-chunk-encoding" class="headerlink" title="response.write(chunk, [encoding])"></a>response.write(chunk, [encoding])</h5><p>向响应流发送一个数据块。这个方法可能被调用多次，以提供响应体内容。如果调用了这个方法，但还没有调用 <code>response.writeHead()</code>，将会向响应体提供默认的 <code>header</code>。</p>
<p>参数chunk可以是字符串或者Buffer缓存。</p>
<h5 id="response-end-data-encoding"><a href="#response-end-data-encoding" class="headerlink" title="response.end([data], [encoding])"></a>response.end([data], [encoding])</h5><p>当所有的响应报头和报文被发送完成时这个方法将信号发送给服务器，服务器会认为这个消息完成了。 每次响应完成之后必须调用该方法。</p>
<p>如果指定了参数 <code>data</code>，就相当于先调用 <code>response.write(data, encoding)</code> 再调用 <code>response.end()</code>。</p>
<hr>
<h4 id="http-ServerResponse-中的属性"><a href="#http-ServerResponse-中的属性" class="headerlink" title="http.ServerResponse 中的属性"></a>http.ServerResponse 中的属性</h4><h5 id="response-statusCode"><a href="#response-statusCode" class="headerlink" title="response.statusCode"></a>response.statusCode</h5><p>当使用默认 <code>header</code> 时（没有显式地调用 <code>response.writeHead()</code> 来修改 <code>header</code>），这个属性决定 <code>header</code> 更新时被传回客户端的HTTP状态码。当响应头已经被发送回客户端，那么这个属性则表示已经被发送出去的状态码。</p>
<h5 id="response-headersSent"><a href="#response-headersSent" class="headerlink" title="response.headersSent"></a>response.headersSent</h5><p><code>Boolean</code> 值(只读)，如果 <code>headers</code> 发送完毕，则为 <code>true</code>，否则为 <code>false</code>。</p>
<h5 id="response-sendDate"><a href="#response-sendDate" class="headerlink" title="response.sendDate"></a>response.sendDate</h5><p>默认值为 <code>true</code>。若为 <code>true</code>，当 <code>headers</code> 里没有 <code>Date</code> 值时，自动生成 <code>Date</code> 并发送。只有在测试环境才能禁用，因为HTTP要求响应包含 <code>Date</code> 头。</p>
<hr>
<h3 id="0x04-http-IncomingMessage-对象"><a href="#0x04-http-IncomingMessage-对象" class="headerlink" title="0x04 http.IncomingMessage 对象"></a>0x04 http.IncomingMessage 对象</h3><p><code>IncomingMessage</code> 对象是由 <code>http.Server</code> 或 <code>http.ClientRequest</code> 创建的，并作为第一参数分别传递给 <code>http.Server</code>的 <code>request</code> 事件和 <code>http.ClientRequest</code> 的 <code>response</code> 事件。它也可以用来访问应答的状态、头文件和数据等。 <code>IncomingMessage</code> 对象实现了 <code>Readable Stream</code> 接口，对象中还有一些事件，方法和属性。<code>在http.Server</code> 或 <code>http.ClientRequest</code> 中略有不同。</p>
<hr>
<h4 id="http-IncomingMessage-对象中的事件"><a href="#http-IncomingMessage-对象中的事件" class="headerlink" title="http.IncomingMessage 对象中的事件"></a>http.IncomingMessage 对象中的事件</h4><h5 id="close-事件-2"><a href="#close-事件-2" class="headerlink" title="close 事件"></a>close 事件</h5><p><code>close</code> 事件表示在 <code>response.end()</code> 被调用或强制刷新之前，底层的连接已经被终止了。</p>
<hr>
<h4 id="http-IncomingMessage-对象中的方法"><a href="#http-IncomingMessage-对象中的方法" class="headerlink" title="http.IncomingMessage 对象中的方法"></a>http.IncomingMessage 对象中的方法</h4><h5 id="message-setTimeout-msecs-callback"><a href="#message-setTimeout-msecs-callback" class="headerlink" title="message.setTimeout(msecs, callback)"></a>message.setTimeout(msecs, callback)</h5><p>设置连接超时，参数 <code>msecs</code> 为超时时间（秒）。该方法本质是调用 <code>message.connection.setTimeout(msecs, callback)</code> 方法。</p>
<hr>
<h4 id="http-IncomingMessage-对象中的属性"><a href="#http-IncomingMessage-对象中的属性" class="headerlink" title="http.IncomingMessage 对象中的属性"></a>http.IncomingMessage 对象中的属性</h4><h5 id="message-httpVersion"><a href="#message-httpVersion" class="headerlink" title="message.httpVersion"></a>message.httpVersion</h5><p><code>message.httpVersion</code>：在http.Server中表示客户端向服务器发出请求时，客户端发送的HTTP版本；在http.ClientRequest中表示服务器向客户端返回应答时，服务器的HTTP版本</p>
<h5 id="message-headers"><a href="#message-headers" class="headerlink" title="message.headers"></a>message.headers</h5><p><code>message.headers</code>: 请求/响应头对象。只读的文件头信息的键值对的集合，全小写。</p>
<h5 id="message-method"><a href="#message-method" class="headerlink" title="message.method"></a>message.method</h5><p><code>message.method</code>：仅对http.Server有效，表示客户端的HTTP请求方式</p>
<h5 id="message-url"><a href="#message-url" class="headerlink" title="message.url"></a>message.url</h5><p><code>message.url</code>：仅对http.Server有效，表示客户端请求的URL字符串。</p>
<h5 id="message-statusCode"><a href="#message-statusCode" class="headerlink" title="message.statusCode"></a>message.statusCode</h5><p><code>message.statusCode</code>：仅对 <code>http.ClientRequest</code> 有效，表示HTTP服务器的响应状态，如：200、404等。</p>
<h5 id="message-statusCode-1"><a href="#message-statusCode-1" class="headerlink" title="message.statusCode"></a>message.statusCode</h5><p><code>message.statusCode</code>：仅对 <code>http.ClientRequest</code> 有效，表示HTTP服务器的响应状态信息，如：OK、Internal Server Error等。</p>
<h6 id="message-socket"><a href="#message-socket" class="headerlink" title="message.socket"></a>message.socket</h6><p><code>message.socket</code>：与此连接关联的net.Socket对象</p>
<hr>
<h3 id="0x05-完备的-HTTP-服务器"><a href="#0x05-完备的-HTTP-服务器" class="headerlink" title="0x05 完备的 HTTP 服务器"></a>0x05 完备的 HTTP 服务器</h3><h5 id="1-创建一个-http-Server"><a href="#1-创建一个-http-Server" class="headerlink" title="1.创建一个 http.Server"></a>1.创建一个 http.Server</h5><p>不同于 <code>new http.Server()</code> 的方式，使用 <code>http.createServer</code> 方法来创建一个 <code>http.Serve</code> 的实例，不需要为其显示的添加 <code>request</code> 事件处理程序，因为它将会自动在服务端监听来自客户端的  <code>request</code> 事件,然后在其回调函数中会返回一个 <code>http.IncomingMessage(req)</code> 实例和一个  <code>http.ServerResponse(res)</code> 实例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by onejustone on 2016/12/26.</span><br><span class="line"> *</span><br><span class="line"> * @param &#123;Object&#125; req 是一个http.IncomingMessag实例</span><br><span class="line"> * @param &#123;Object&#125; res 是一个http.ServerResponse实例</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">let http = require(&apos;http&apos;)</span><br><span class="line">// 导入 http m模块</span><br><span class="line"></span><br><span class="line">let server = http.createServer(function (req, res) &#123;</span><br><span class="line">// 创建 http server</span><br><span class="line">    res.writeHeader(200, &#123;&apos;Content-Type&apos;:&apos;video/mp4&apos;&#125;)</span><br><span class="line">    // 改写响应的头部信息 </span><br><span class="line">    let rs = require(&apos;fs&apos;).createReadStream(&apos;./臭屁虫2.mp4&apos;)</span><br><span class="line">    // 创建一个流文件，读取 MP4 媒体数据</span><br><span class="line">    rs.pipe(res)</span><br><span class="line">    // 将 MP4 文件流通过管道输送到 HTTP 响应中</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.maxHeadersCount = 1000;</span><br><span class="line">// 设置最大请求头限制</span><br><span class="line">server.setTimeout(1000,function () &#123;</span><br><span class="line">// 设置套接字超时时间</span><br><span class="line">    console.log(&quot;oh, time out~~&quot;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server.listen(8088, function () &#123;</span><br><span class="line">// 监听本地端口。启动服务器</span><br><span class="line">    console.log(&apos;服务器已启动！&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>http.ServerResponse</code> 实例是一个可写流，所以可以将一个文件流转接到 <code>res</code> 响应流中，然后传输给客户端。</p>
<p>此外，我们还有可以通过 <code>req.headers</code> 来查看客户端的请求信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let server = http.createServer(function (req, res) &#123;</span><br><span class="line">    console.log(req.headers)</span><br><span class="line">    res.writeHeader(200, &#123;&apos;Content-Type&apos;:&apos;text/plain&apos;&#125;)</span><br><span class="line">    res.end()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/26/ES6(16)Promise/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/26/ES6(16)Promise/" itemprop="url">ES6(16)Promise</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-26T00:00:00+08:00">
                2016-12-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-初见-Promise"><a href="#0x00-初见-Promise" class="headerlink" title="0x00 初见 Promise"></a>0x00 初见 Promise</h3><p><code>Promise</code> 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。</p>
<p>在传统的 Node 异步编程中，比如按照一定顺序去读取多个文件进行异步操作时，很容易陷入 <em>回调地狱</em>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var fs = require(&apos;fs&apos;);</span><br><span class="line">fs.readFile(&quot;fileName1&quot;, function (err, data) &#123;</span><br><span class="line">	if (!err)&#123;</span><br><span class="line">		fs.readFile(&quot;fileName1&quot;, function (err,data) &#123;</span><br><span class="line">			if (!err)&#123;</span><br><span class="line">			//	......</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>本节不会去深究 Promise 的底层实现，而是讨论如何使用 Promise 对象去进行异步操作。</p>
<p>Promise 的两个特点:</p>
<ul>
<li>对象的状态不受外界影响。Promise对象代表一个异步操作，有三种状态：<code>Pending</code>（进行中）、<code>Resolved</code>（已完成，又称 <code>Fulfilled</code>）和<code>Rejected</code>（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。</li>
<li>一旦状态改变，就不会在变，任何时候都可以得到这个结果。Promise对象的状态改变，只有两种可能：从<code>Pending</code>变为<code>Resolved</code>和从<code>Pending</code>变为<code>Rejected</code>。</li>
</ul>
<p>有了 Promise 对象，便可以将异步操作以同步操作的流程表达出来，避免回调地狱。</p>
<p>当然，Promise 也是有缺点的，就是在于其状态的不可中断特性。因为在实际的开发过程中，是很有可能需要去中断这个状态的。</p>
<hr>
<h3 id="0x01-使用-Promise"><a href="#0x01-使用-Promise" class="headerlink" title="0x01 使用 Promise"></a>0x01 使用 Promise</h3><p>ES6规定，Promise对象是一个构造函数，用来生成Promise实例。其接受两个<code>resolve</code> 和 <code>reject</code> 函数作为参数。</p>
<p><code>resolve</code> 函数的在异步操作成功时调用，并将异步操作成功的结果作为参数传递出去。而 <code>reject</code> 函数在异步操作失败时调用，并将异步操作失败时返回的结果作为参数传递出去。这两个函数，由JavaScript引擎提供，不用自己部署。</p>
<p>以下代码创建 Promise 实例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let promise = new Promise(function (resolve, reject)&#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>Promise实例生成以后，可以用<code>then</code>方法分别指定R<code>esolved</code>状态和<code>Reject</code>状态的回调函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">promise.then(function (value) &#123;</span><br><span class="line">//	success</span><br><span class="line">&#125;,function (err) &#123;</span><br><span class="line">//	error</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>then</code> 接受两个回调函数作为参数。第一个回调函数是Promise对象的状态变为<code>Resolved</code>时调用，第二个回调函数是Promise对象的状态变为<code>Reject</code>时调用,而第二个参数是可选的。<strong>这两个函数都接受Promise对象传出的值作为参数。</strong></p>
<p>Promise 一旦创建便会立即执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">let promise = new Promise(function (resolve, reject)&#123;</span><br><span class="line">	console.log(&apos;Promise&apos;);</span><br><span class="line">	resolve();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(function (value) &#123;</span><br><span class="line">//	success</span><br><span class="line">	console.log(&quot;Resolved&quot;);</span><br><span class="line">&#125;,function (err) &#123;</span><br><span class="line">//	error</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(&quot;hi&quot;);</span><br><span class="line">//Promise</span><br><span class="line">//hi</span><br><span class="line">//Resolved</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="使用-Promise-发送-Ajax-请求"><a href="#使用-Promise-发送-Ajax-请求" class="headerlink" title="使用 Promise 发送 Ajax 请求"></a>使用 Promise 发送 Ajax 请求</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">let getJSON = function (url) &#123;</span><br><span class="line">	return new Promise(function (resolve, reject) &#123;</span><br><span class="line">		let client = new XMLHttpRequest();</span><br><span class="line">		client.open(&quot;GET&quot;, url, true);</span><br><span class="line">		client.onreadystatechange = handler;</span><br><span class="line">		client.responseType = &quot;json&quot;;</span><br><span class="line">		client.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;)</span><br><span class="line">		client.send();</span><br><span class="line"></span><br><span class="line">		function handler () &#123;</span><br><span class="line">			if (this.readyState!== 4)&#123;</span><br><span class="line">				return;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			if (this.status === 200)&#123;</span><br><span class="line">				resolve(this.response);</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				reject(new Error(this.statusText));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">getJSON(url).then(function (json) &#123;</span><br><span class="line">	console.log(&quot;Contents: &quot; + json);</span><br><span class="line">&#125;, function (err) &#123;</span><br><span class="line">	console.log(&quot;Error: &quot; + err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注意，在 <code>getJSON</code> 内部，在 <code>then</code> 方法中，调用函数 <code>resolve</code> 和函数 <code>reject</code> 时都带有参数，而在这些参数都将会被传递个回调函数。reject函数的参数通常是 <code>Error</code> 对象的实例，表示抛出的错误；<code>resolve</code> 函数的参数除了正常的值以外，还可能是另一个 Promise 实例。</p>
<p><a href="https://github.com/onejustone/JavaScript/tree/master/Promise_demo" target="_blank" rel="noopener">源代码</a></p>
<hr>
<h4 id="Promise-prototype-then"><a href="#Promise-prototype-then" class="headerlink" title="Promise.prototype.then()"></a>Promise.prototype.then()</h4><p><code>then()</code> 方法的作用是为 Promise 实例添加状态改变时的回调函数。在函数执行完成以后<code>then</code> 方法会返回一个新的 Promise 实例，以形成链式调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getJSON(url).then( value =&gt; value.commentURl)</span><br><span class="line">.then(</span><br><span class="line">	value =&gt; console.log(vlaue),</span><br><span class="line">	err =&gt; console.log(err)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Promise-prototype-catch"><a href="#Promise-prototype-catch" class="headerlink" title="Promise.prototype.catch()"></a>Promise.prototype.catch()</h4><p><code>catch()</code> 方法是 <code>then(null, rejection)</code> 方法的别名。通常来说，我们并不建议直接在 <code>then()</code> 方法中去处理异步操作可能产生的错误，即不要在 <code>then</code> 方法里面定义 <code>Reject</code> 状态的回调函数（即then的第二个参数）而是使用 <code>catch</code> 方法去捕获错误。</p>
<p>首先，Promise 对象中的错误具有冒泡性质，错误会一直向后传递。其次，Promise 对象中的错误也不会传递到外层代码中去，如果不使用 <code>catch</code> 方法，是不会捕获到错误的。这跟传统的 <code>try/catch</code> 代码块不同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// bad</span><br><span class="line">promise</span><br><span class="line">  .then(function(data) &#123;</span><br><span class="line">    // success</span><br><span class="line">  &#125;, function(err) &#123;</span><br><span class="line">    // error</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">// good</span><br><span class="line">promise</span><br><span class="line">  .then(function(data) &#123; //cb</span><br><span class="line">    // success</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(function(err) &#123;</span><br><span class="line">    // error</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p> Node 中的 <code>unhandledRejection</code> 事件，专门用来监听为处理的 <code>reject</code> 错误:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">process.on(&apos;unhandledRejection&apos;, function (err, p) &#123;</span><br><span class="line">  console.error(err.stack)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>其接受两个参数,第一个是错误对象，第二个是报错的Promise实例。</p>
<hr>
<h3 id="0x02-不存在与-ES6-中的-Promise-方法"><a href="#0x02-不存在与-ES6-中的-Promise-方法" class="headerlink" title="0x02 不存在与 ES6 中的 Promise 方法"></a>0x02 不存在与 ES6 中的 Promise 方法</h3><hr>
<h4 id="done"><a href="#done" class="headerlink" title="done()"></a>done()</h4><p><code>done()</code> 方法用于捕获 Promise 回调链尾部可能抛出的任何错误:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Promise.prototype.done = function (resolve, reject) &#123;</span><br><span class="line">	this.then(resolve, reject)</span><br><span class="line">	.catch(function (reason)&#123;</span><br><span class="line">	// 抛出一个全局错误</span><br><span class="line">		setTimeout( () =&gt; &#123; throw reason;&#125;, 0);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="finally"><a href="#finally" class="headerlink" title="finally()"></a>finally()</h4><p><code>finally()</code> 方法用于指定不管Promise对象最后状态如何，都会执行的操作。其接受一个普遍的回调函数作为参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Promise.prototype.finally = function (callback)&#123;</span><br><span class="line">	let P = this.constructor;</span><br><span class="line">	return this.then(&#123;</span><br><span class="line">		value =&gt; P.resolve(callback()).then( () =&gt; value),</span><br><span class="line">		reason =&gt; P.resolve(callback()).then( () =&gt; &#123;throw reason&#125;)</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x03-应用"><a href="#0x03-应用" class="headerlink" title="0x03 应用"></a>0x03 应用</h3><hr>
<h4 id="加载图片"><a href="#加载图片" class="headerlink" title="加载图片"></a>加载图片</h4><p>将图片的加载写成一个Promise，一旦加载完成，Promise的状态就发生变化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const  preLoadImagePro = function (path) &#123;</span><br><span class="line">    return new Promise(function (resolve, reject) &#123;</span><br><span class="line">        let image = new Image();</span><br><span class="line">        image.onload = resolve;</span><br><span class="line">        image.onerror = reject;</span><br><span class="line">        image.src = path;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="构建顺序执行异步任务"><a href="#构建顺序执行异步任务" class="headerlink" title="构建顺序执行异步任务"></a>构建顺序执行异步任务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var sequence = Promise.resolve();</span><br><span class="line">array.forEach(function(item) &#123;</span><br><span class="line">	sequence = sequence.then(//deal item)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/26/ ES6(8)函数/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/26/ ES6(8)函数/" itemprop="url">ES6(8)函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-26T00:00:00+08:00">
                2016-12-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-参数默认值"><a href="#0x00-参数默认值" class="headerlink" title="0x00 参数默认值"></a>0x00 参数默认值</h3><p>ES6 可以直接为函数的参数指定一个默认值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function Poing ( x = 0, y = 5)&#123;</span><br><span class="line">    this.x = x;</span><br><span class="line">    this.y = y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如此一来，使得得函数的书写更简洁，也便于阅读，更有利于将来的代码维护。</p>
<p>需要注意的是，<em>参数变量是默认声明的</em> 所以不能再用 <code>let</code> 或者 <code>const</code> 再次声明。</p>
<hr>
<h3 id="0x01-参数默认值解构赋值"><a href="#0x01-参数默认值解构赋值" class="headerlink" title="0x01 参数默认值解构赋值"></a>0x01 参数默认值解构赋值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function Point( &#123;x =1, y = 5&#125;)&#123;</span><br><span class="line">    this.x = x;</span><br><span class="line">    this.y = y;</span><br><span class="line">    console.log(x * y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var p = new Point(&#123;x:200, y:40&#125;)</span><br><span class="line">// 双重默认值，2000 和 40 将会覆盖原始默认值</span><br><span class="line">// 8000</span><br><span class="line"></span><br><span class="line">Point()</span><br><span class="line">// TypeError</span><br><span class="line"></span><br><span class="line">Ponit(&#123;&#125;)</span><br><span class="line">// 5</span><br></pre></td></tr></table></figure>
<p>如上，函数的参数是一个对象， 参数变量 <code>x</code> 和 <code>y</code> 通过解构赋值而生成。</p>
<p>当传递给函数的参数不是一个对象时，将会报错。</p>
<p>请注意以下写法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function fetch(url, &#123; body = &apos;&apos;, method = &apos;GET&apos;, headers = &#123;&#125; &#125; = &#123;&#125;) &#123;</span><br><span class="line">   alert(method)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetch(&apos;https://www.sina.com/page/1&apos;)</span><br></pre></td></tr></table></figure>
<p><code>fetch</code> 函数的第二参数可以省略，因为已经在声明函数的同时结合结构对第二个参数进行了默认赋初值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function fetch1(url, &#123; body = &apos;&apos;, method = &apos;GET&apos;, headers = &#123;&#125; &#125;) &#123;</span><br><span class="line">   alert(method)</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">fetch(&apos;https://ww.sian.com/page/1&apos;,&#123;&#125;)</span><br></pre></td></tr></table></figure>
<p><code>fetch1</code> 函数的第二参数是一个对象，在调用该函数时不可省略，其和第一个参数 <code>url</code> 的性质是一样的。</p>
<p>在看以下两种写法的差别:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 写法一</span><br><span class="line">function m1 ( &#123; x = 0, y = 0&#125; = &#123;&#125;)&#123;</span><br><span class="line">    return [x, y]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 写法二</span><br><span class="line">function m2 ( &#123;x, y&#125; = &#123;x:0, y:0&#125;)&#123;</span><br><span class="line">    return [x, y]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 函数没有参数的情况</span><br><span class="line">m1() // [0, 0]</span><br><span class="line">m2() // [0, 0]</span><br><span class="line"></span><br><span class="line">// x和y都无值的情况</span><br><span class="line">m1(&#123;&#125;) // [0, 0];</span><br><span class="line">m2(&#123;&#125;) // [undefined, undefined]</span><br></pre></td></tr></table></figure>
<p>上面两种写法都对函数的参数设定了默认值，区别是写法一函数参数的默认值是空对象，但是设置了对象解构赋值的默认值；写法二函数参数的默认值是一个有具体属性的对象，但是没有设置对象解构赋值的默认值。</p>
<blockquote>
<p>一旦函数有多个参数并指定了默认值，那么调用函数时，便不能省略非尾部的参数</p>
</blockquote>
<hr>
<h4 id="函数作用域小探"><a href="#函数作用域小探" class="headerlink" title="函数作用域小探"></a>函数作用域小探</h4><p>来看一个复杂点的例子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var x = 1</span><br><span class="line">function foo(x, y = function () &#123; x = 2&#125;)&#123;</span><br><span class="line">    console.log(x)</span><br><span class="line">    var x = 3</span><br><span class="line">    y()</span><br><span class="line">    console.log(x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo()</span><br><span class="line">// undefined</span><br><span class="line">// 3</span><br></pre></td></tr></table></figure>
<p>如上，函数 <code>foo</code> 的参数 y 的默认值是一个匿名函数。函数<code>foo</code>调用时，它的参数 <code>x</code> 的值为 <code>undefined</code>，所以 y 函数内部的 x 一开始是 <code>undefined</code> ，后来被重新赋值 2。但是，函数 <code>foo</code> 内部重新声明了一个 <code>x</code>，值为3，这两个 <code>x</code> 是不一样的，互相不产生影响，因此最后输出 3。</p>
<hr>
<h3 id="0x02-rest-参数"><a href="#0x02-rest-参数" class="headerlink" title="0x02 rest 参数"></a>0x02 rest 参数</h3><p>ES6引入 <code>rest</code> 参数（形式为“…变量名”），用于获取函数的多余参数，这样就不需要使用 <code>arguments</code> 对象了。<code>rest</code> 参数中的变量代表一个数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function  add(...values) &#123;</span><br><span class="line">    let sum = 0;</span><br><span class="line">    for( let val of values)&#123;</span><br><span class="line">        sum += val</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(3,45,56,6)</span><br></pre></td></tr></table></figure>
<h4 id="使用-rest-参数替代-arguments"><a href="#使用-rest-参数替代-arguments" class="headerlink" title="使用 rest 参数替代 arguments"></a>使用 rest 参数替代 arguments</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// arguments 对象写法</span><br><span class="line">function sortNumbers() &#123;</span><br><span class="line">        return Array.prototype.slice.call(arguments).sort()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// rest 参数写法</span><br><span class="line">const sortNumbers1 = (...numbers) =&gt; numbers.sort()</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x03-扩展运算符-…"><a href="#0x03-扩展运算符-…" class="headerlink" title="0x03 扩展运算符 …"></a>0x03 扩展运算符 …</h3><p><strong>扩展运算符</strong>（spread）是三个点 (…)。我们将其看作 <strong>rest</strong> 参数的逆操作，该运算符将一个数组，变为参数序列。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function add(x, y) &#123;</span><br><span class="line">    return x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var numbers = [4, 38]</span><br><span class="line">add(...numbers) //42</span><br></pre></td></tr></table></figure>
<p>扩展运算符与正常的函数参数可以结合使用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function f(u, v, w, x, y) &#123;&#125;</span><br><span class="line">var args = [0, 1]</span><br><span class="line">f(-1, ...args, 2, ...[3])</span><br></pre></td></tr></table></figure>
<h5 id="替代数组-apply-方法"><a href="#替代数组-apply-方法" class="headerlink" title="替代数组 apply 方法"></a>替代数组 apply 方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var arr1 = [0, 1, 2]</span><br><span class="line">var arr2 = [3, 4, 5]</span><br><span class="line"></span><br><span class="line">// ES5</span><br><span class="line">Array.prototype.push.apply(arr1, arr2)</span><br><span class="line"></span><br><span class="line">// ES6</span><br><span class="line">arr1.push(...arr2)</span><br></pre></td></tr></table></figure>
<p><code>push</code> 方法的参数不能是数组，所以只好通过 <code>apply</code> 方法变通使用 <code>push</code>方法。有了 <strong>扩展运算符</strong>，就可以直接将数组传入 <code>push</code> 方法.</p>
<h5 id="合并数组"><a href="#合并数组" class="headerlink" title="合并数组"></a>合并数组</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var arr1 = [&apos;a&apos;, &apos;b&apos;];</span><br><span class="line">var arr2 = [&apos;c&apos;];</span><br><span class="line">var arr3 = [&apos;d&apos;, &apos;e&apos;];</span><br><span class="line"></span><br><span class="line">// ES5的合并数组</span><br><span class="line">arr1.concat(arr2, arr3);</span><br><span class="line">// [ &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos; ]</span><br><span class="line"></span><br><span class="line">// ES6的合并数组</span><br><span class="line">[...arr1, ...arr2, ...arr3]</span><br><span class="line">// [ &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos; ]</span><br></pre></td></tr></table></figure>
<h5 id="与解构赋值结合"><a href="#与解构赋值结合" class="headerlink" title="与解构赋值结合"></a>与解构赋值结合</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const [first, ...rest] = [1, 2, 3, 4]</span><br><span class="line">first // 1</span><br><span class="line">rest  // [2, 3, 4]</span><br></pre></td></tr></table></figure>
<h4 id="将字符串转换为数组"><a href="#将字符串转换为数组" class="headerlink" title="将字符串转换为数组"></a>将字符串转换为数组</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[...&apos;Hello&apos;]</span><br><span class="line">// [&quot;h&quot;, &quot;e&quot;, &quot;l&quot;, &quot;l&quot;, &quot;o&quot;]</span><br></pre></td></tr></table></figure>
<h5 id="将-Iterator-接口的对象转换为数组"><a href="#将-Iterator-接口的对象转换为数组" class="headerlink" title="将 Iterator 接口的对象转换为数组"></a>将 Iterator 接口的对象转换为数组</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var nodeList = document.querySelector(&apos;div&apos;)</span><br><span class="line">var array = [...nodeList]</span><br></pre></td></tr></table></figure>
<p>如下，我们将一个 <code>nodeList</code> 对象转换为了一个数组。</p>
<p>但是，扩展运算符无法转换那些没有部署 <code>Iterator</code> 接口的类似数组的对象。在这种情况下，可以改为使用 <code>Array.from</code> 方法将 <code>arrayLike</code> 转为真正的数组。</p>
<hr>
<h3 id="0x04-箭头函数"><a href="#0x04-箭头函数" class="headerlink" title="0x04 箭头函数"></a>0x04 箭头函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var f = v =&gt; v;</span><br><span class="line"></span><br><span class="line">//等同于:</span><br><span class="line">var f = function (v) &#123; return v;&#125;;</span><br></pre></td></tr></table></figure>
<p>如果没有参数或者需要多个参数，就使用一个圆括号代表参数部分。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var f = () =&gt; 5;</span><br><span class="line">// 等同于 </span><br><span class="line">var f = function () &#123; return 5;&#125;;</span><br><span class="line"></span><br><span class="line">var sum = (sum1, sum2) =&gt; &#123;sum1 + sum2;&#125;;</span><br><span class="line">// 等同于</span><br><span class="line">var sum = function (sum1 + sum2) &#123;return sum1 + sum2&#125;</span><br></pre></td></tr></table></figure>
<p>如上，当函数体多于一条语句的时候便使用大括号 <code>{}</code> 将其括起。 </p>
<hr>
<h4 id="箭头函数使用场景"><a href="#箭头函数使用场景" class="headerlink" title="箭头函数使用场景"></a>箭头函数使用场景</h4><p>下面是一些箭头函数使用的场景:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3].map( x =&gt; x * x);</span><br><span class="line"></span><br><span class="line">// 对数组排序</span><br><span class="line">var result = values.sort((a, b) =&gt; a - b)</span><br><span class="line"></span><br><span class="line">// 结合 rest 参数</span><br><span class="line">const numbers = (...nums) =&gt; nums;</span><br><span class="line">numbers(1, 2, 4, 5)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="箭头函数注意点"><a href="#箭头函数注意点" class="headerlink" title="箭头函数注意点"></a>箭头函数注意点</h4><ol>
<li>函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象。箭头函数中，<code>this</code> 它是固定的。</li>
<li>不可以当作构造函数，也就是说，不可以使用 <code>new</code> 命令。</li>
<li>不可以使用 <code>arguments</code> 对象，该对象在函数体内不存在。如果要用，可以用 <code>Rest</code> 参数代替。</li>
<li>不可以使用 <code>yield</code> 命令，因此箭头函数不能用作 <code>Generator</code> 函数。</li>
</ol>
<p>由于箭头函数没有自己的 <code>this</code>，所以当然也就不能用<code>call()</code>、<code>apply()</code>、<code>bind()</code>这些方法去改变 <code>this</code> 的指向。</p>
<p>###</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/26/ES6(7)数组的扩展/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/26/ES6(7)数组的扩展/" itemprop="url">ES6(7)数组的扩展</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-26T00:00:00+08:00">
                2016-12-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-Array-from"><a href="#0x00-Array-from" class="headerlink" title="0x00 Array.from()"></a>0x00 Array.from()</h3><p><code>Array.from</code> 方法用于将两类对象转为真正的数组：类似数组的对象（array-like object）和可遍历（iterable）的对象（包括ES6新增的数据结构Set和Map）。</p>
<p>比如函数的内部对象，<code>arguments</code> 是一个类数组对象，我们可以通过 <code>Array.from</code> 将其转换为数组对象:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function calArguments (arr)&#123;</span><br><span class="line">	return Array.from(arguments).map( (x) =&gt; x * 2 )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(calArguments(1,2,3));</span><br></pre></td></tr></table></figure>
<p>同样我们还可以将可迭代的对象转换为数组比如 <code>NodeList</code> 对象:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x01-Array-of"><a href="#0x01-Array-of" class="headerlink" title="0x01 Array.of()"></a>0x01 Array.of()</h3><p><code>Array.of()</code> 方法同样是 ES6 中的 API 方法，用于将一组数值转换为数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let a = Array.of(3,5,6);</span><br><span class="line">console.log(a)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x02-数组的实例方法"><a href="#0x02-数组的实例方法" class="headerlink" title="0x02 数组的实例方法"></a>0x02 数组的实例方法</h3><hr>
<h4 id="Array-copyWithin"><a href="#Array-copyWithin" class="headerlink" title="Array.copyWithin()"></a>Array.copyWithin()</h4><p><code>Array.copyWithin(target [,start][,end])</code> 接收三个参数，后两个参数是可选的。<br>用于替换数组，从 <code>target</code> 位置开始。</p>
<hr>
<h4 id="Array-find"><a href="#Array-find" class="headerlink" title="Array.find()"></a>Array.find()</h4><p><code>Array.find(function (value, index, arr){})</code> 用于找出第一个符合条件的数组成员。它的参数是一个回调函数，所有数组成员依次执行该回调函数，直到找出第一个返回值为 <code>true</code> 的成员，然后返回该成员。如果没有符合条件的成员，则返回 <code>undefined</code>。</p>
<hr>
<h4 id="Array-fill"><a href="#Array-fill" class="headerlink" title="Array.fill()"></a>Array.fill()</h4><p><code>Array.fill(context[,start][,end])</code> 用于填充数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let arr = [1,2,3,4];</span><br><span class="line">arr.fill(&quot;Jack&quot;, 1, 2);</span><br><span class="line">console.log(arr);</span><br><span class="line">//[1, &quot;Jack&quot;, 3, 4]</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/26/ES6(11)Set和Map/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/26/ES6(11)Set和Map/" itemprop="url">ES6(11)Set和Map</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-26T00:00:00+08:00">
                2016-12-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/33/">33</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">onejustonee</p>
              <p class="site-description motion-element" itemprop="description">onejustone's blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">329</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">103</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">onejustonee</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
