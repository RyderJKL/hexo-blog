<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="onejustone&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="onejustone">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="onejustone">
<meta property="og:description" content="onejustone&apos;s blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="onejustone">
<meta name="twitter:description" content="onejustone&apos;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/4/">





  <title>onejustone</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">onejustone</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">--愿你内心有种不灭的火焰，将你与别人区分开来--</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/VueVsRXJS/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/VueVsRXJS/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-05T17:53:02+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Vue-Vs-RxJS"><a href="#Vue-Vs-RxJS" class="headerlink" title="Vue Vs RxJS"></a>Vue Vs RxJS</h1><p>本文主要探讨 Vue 的响应式与 Rxjs 的对比</p>
<p>Vue 的<code>two-ways-data binding</code>是通过<code>ES5 definedProperty</code>的<code>getter/setter</code>。<br>每当数据发生改变时，就会执行<code>getter/setter</code>从而搜集有改动的变量，这被称为 <strong>依赖收集</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/响应式编程/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/响应式编程/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-05T17:53:02+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="响应式编程"><a href="#响应式编程" class="headerlink" title="响应式编程"></a>响应式编程</h1><h2 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h2><p>函数式(<code>Functional Programming</code>)是一种编程范式。<br>在函数式编程中，函数是一等公民(<code>First Class</code>)，强调无副作用(<code>Side Effect</code>),既是使用纯函数(<code>Pure Function</code>)进行运算操作。</p>
<p>函数式编程使用场景是<code>并发/并行</code>操作，通常只做运算，不碰<code>I/O</code>。</p>
<!-- 函数是编程极大的提高了程序的可读性和可维护性 -->
<h2 id="Reactive-Programming"><a href="#Reactive-Programming" class="headerlink" title="Reactive Programming"></a>Reactive Programming</h2><p><code>ReactiveX</code>将观察者模式(<code>Observer Pattern</code>)和迭代器模式(<code>Iterator Pattern</code>)与函数式编程(<code>Function Programming)</code>相结合，以一种理想的方法进行事件流的管理，以此实现响应式(<code>Reactive Programming</code>)编程。</p>
<p>其主要概念如下：</p>
<ul>
<li><code>Observer</code>: 观察者，主要监听被观察者。</li>
<li><code>Observable</code>: 被观察者</li>
<li><code>Subscription</code>: 订阅者</li>
<li><code>Operators</code>: 操作符</li>
<li><code>Subject</code>: 相当于一个<code>EventEmitter</code>，既可以充当<code>Observable</code>也可以充当<code>Observer</code>，其主要角色是作为两者之间的桥梁存在</li>
<li><code>Schedulers</code>: 调度者</li>
</ul>
<h2 id="Observer-Pattern"><a href="#Observer-Pattern" class="headerlink" title="Observer Pattern"></a>Observer Pattern</h2><p><code>观察者模式</code>又叫<code>发布/订阅模式(Publish/Subcribe)</code>，它定义了一种一对多的关系，让多个观察对象同时监听某一个主题对象，而当这个主题对象的状态发生改变时便会通知所有的观察者对象，使它们自动更新自己。</p>
<h2 id="Iterator-Pattern"><a href="#Iterator-Pattern" class="headerlink" title="Iterator Pattern"></a>Iterator Pattern</h2><p><code>迭代器(Iterator)模式</code>,又称为<code>游标模式</code>。它提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。迭代器模式可以把迭代的过程从业务逻辑中分离出来，在使用迭代器模式之后，即使不关心对象的内部构造，也可以按顺序访问其中的每个元素。</p>
<p><a href="https://ithelp.ithome.com.tw/articles/10186465" target="_blank" rel="noopener">参考文章:30 天精通 RxJS系列</a><br><a href="https://dotblogs.com.tw/kinanson/2017/07/06/080727" target="_blank" rel="noopener">使用vue-rx进行状态管理</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/Subject-1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/Subject-1/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-05T17:53:02+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Subject-1"><a href="#Subject-1" class="headerlink" title="Subject(1)"></a>Subject(1)</h1><h2 id="multicast-组播"><a href="#multicast-组播" class="headerlink" title="multicast 组播"></a>multicast 组播</h2><p><code>Observable</code> 是可以多次订阅的，而且各自的订阅之间是相互独立。但是，有时候我们并不希望每个订阅之间相互独立，而是当 <code>ObserverB</code> 订阅的时候可以接着 <code>ObserverA</code> 的进度。 <strong>Subject</strong> 就是干这件事情的。</p>
<p>先来看一个 <code>Subject</code> 的基本实现:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject = &#123;</span><br><span class="line">     observers: [],</span><br><span class="line">     subscribe: <span class="function">(<span class="params">observer</span>) =&gt;</span> subject.observers.push(observer),</span><br><span class="line">     next:<span class="function">(<span class="params">value</span>)=&gt;</span>subject.observers.forEach(<span class="function"><span class="params">o</span> =&gt;</span> o.next(value)),</span><br><span class="line">     error:<span class="function">(<span class="params">error</span>) =&gt;</span> subject.observers.forEach((<span class="function"><span class="params">o</span> =&gt;</span> o.error(error))),</span><br><span class="line">     complete:<span class="function"><span class="params">()</span> =&gt;</span> subject.observers.forEach(<span class="function"><span class="params">o</span> =&gt;</span> o.complete())</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><code>subject.subscribe</code> 的作用很明显，就是将新的 <code>observer</code> 添加到 <code>subject</code> 的缓存清单中。而同时，<code>subject</code> 继承了 <code>observer</code> 的所有方法:<code>next</code>,<code>error</code>,<code>complete</code>。</p>
<p>怎么用？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> source = Observable.interval(<span class="number">1000</span>).take(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">let</span> observerA = &#123;</span><br><span class="line">  next:<span class="function"><span class="params">value</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'A'</span>+value),</span><br><span class="line">  error:<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error),</span><br><span class="line">  complete: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'completeA'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> observerB = &#123;</span><br><span class="line">  next:<span class="function"><span class="params">value</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'B'</span>+value),</span><br><span class="line">  error: <span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error),</span><br><span class="line">  complete: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'completeB'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">source.subscribe(subject)</span><br><span class="line"></span><br><span class="line">subject.subscribe(observerA)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span></span><br><span class="line">  <span class="comment">// 让 B 延迟两秒再订阅</span></span><br><span class="line">  subject.subscribe(observerB),</span><br><span class="line"><span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// A0</span></span><br><span class="line"><span class="comment">// A1</span></span><br><span class="line"><span class="comment">// B1</span></span><br><span class="line"><span class="comment">// A2</span></span><br><span class="line"><span class="comment">// B2</span></span><br><span class="line"><span class="comment">// completeA</span></span><br><span class="line"><span class="comment">// completeB</span></span><br></pre></td></tr></table></figure>
<p>如上，我们首先用 <code>subject</code> 订阅 <code>source</code>，并把 <code>observerA</code> 加入到 <code>subject</code> 内部的订阅清单中，两秒以后再把 <code>observerB</code> 加入到 <code>subject</code> 中去，这时可以看到 <code>observerB</code> 是从 <code>2</code> 开始的，这就是 <strong>组播(multicast)</strong>。</p>
<p>在 <code>Observable</code> 中使用 <code>subject</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Subject&#125; <span class="keyword">from</span> <span class="string">'rxjs/Subject'</span></span><br><span class="line"><span class="keyword">let</span> subject = <span class="keyword">new</span> Subject();</span><br></pre></td></tr></table></figure>
<h2 id="关于-Subject"><a href="#关于-Subject" class="headerlink" title="关于 Subject"></a>关于 Subject</h2><p><code>Subject</code> 可以拿出订阅 <code>Observable(source)</code> 代表它是一个 <code>Observer</code>，同时它也可以被 <code>Observer(observerA,observerB)</code> 订阅，代表它是一个 <code>Observable</code>。即:</p>
<ul>
<li><code>Subject</code> 既是 <code>Observable</code> 也是 <code>Observe</code>。</li>
<li><code>Subject</code> 会对内部的 <code>observers</code> 清单进行组播。</li>
</ul>
<blockquote>
<p><code>Subject</code> 实际上是 <code>Observer Pattern</code> 的实例，它会在内部管理一份 <code>observers</code> 清单，并在接收到值的时候遍历这份清单并送出值。</p>
</blockquote>
<h2 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h2><p>有时，我们希望 <code>Subject</code> 能够代表的是当前的状态，即在一开始订阅的时候就知道的当前的状态是什么，而不是订阅后要等到有变动才能接收到最新的状态。</p>
<p><code>BehaviorSubject</code> 就可以达到这样的效果，它与 <code>Subject</code> 最大的不同在于，<code>BehaviorSubject</code> 可以呈现当前的值，而不是单纯的发送事件。它会记住最新一次发送的元素，并把该元素当作目前的值。使用 <code>BehaviorSubject</code> 时需要传入一个参数来代表起始的状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject = <span class="keyword">new</span> BehaviorSubject(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/* ObserverB 可以获得最后的一次状态，即 2*/</span></span><br><span class="line"><span class="comment">// let subject = new Subject();</span></span><br><span class="line"><span class="comment">/*在 ObseverB 订阅以后没有任何动作，所以 ObserveB 不会有任何值输出*/</span></span><br><span class="line">subject.subscribe(observerA);</span><br><span class="line">subject.next(<span class="number">1</span>)</span><br><span class="line">subject.next(<span class="number">2</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> subject.subscribe(observerB),<span class="number">4000</span>)</span><br></pre></td></tr></table></figure>
<h2 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h2><p>有时候，我们希望 <code>Subject</code> 即代表事件，但又能在新订阅的时候发送最后的几个元素，这时我们就可以使用 <code>ReplaySubject</code> 了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject = <span class="keyword">new</span> ReplaySubject(<span class="number">2</span>);<span class="comment">// 重复发送最后两个元素</span></span><br><span class="line">subject.subscribe(observerA);</span><br><span class="line">subject.next(<span class="number">1</span>)</span><br><span class="line">subject.next(<span class="number">2</span>)</span><br><span class="line">subject.next(<span class="number">3</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> subject.subscribe(observerB),<span class="number">4000</span>)</span><br><span class="line"><span class="comment">// A1</span></span><br><span class="line"><span class="comment">// A2</span></span><br><span class="line"><span class="comment">// A3</span></span><br><span class="line"><span class="comment">// B1</span></span><br><span class="line"><span class="comment">// B2</span></span><br></pre></td></tr></table></figure>
<p><code>BehaviorSubject</code> 代表的是 <strong>状态</strong>,并且其在建立时就会有初始状态，而 <code>ReplaySubject</code> 只是事件的重放而已。</p>
<h2 id="AsyncSubject"><a href="#AsyncSubject" class="headerlink" title="AsyncSubject"></a>AsyncSubject</h2><p><code>AsyncSubject</code> 很少用到，其行为类似于 <code>last</code> 操作符，会在 <code>Subject</code> 结束以后送出最有一个值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject = <span class="keyword">new</span> AsyncSubject();</span><br><span class="line">subject.subscribe(observerA);</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">1</span>)</span><br><span class="line">subject.next(<span class="number">2</span>)</span><br><span class="line">subject.next(<span class="number">3</span>)</span><br><span class="line">subject.complete();</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> subject.subscribe(observerB),<span class="number">4000</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/RxJS初识/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/RxJS初识/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-05T17:53:02+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="RxJS"><a href="#RxJS" class="headerlink" title="RxJS"></a>RxJS</h1><p>可以把<code>RxJS</code>想象成为非同步的<code>Loadsh</code>。</p>
<p><code>RxJS</code>是基于观察者模式和迭代器模式以函数式编程思维来实现的，<code>RxJS</code>可以很好的解决<strong>异步和事件组合</strong>的问题。</p>
<p>它的两个核心的基本概念: <code>Oberservable</code>和<code>Observer</code>，<code>Observable</code>作为被观察者，是一组值或者事件的流的集合。 而<code>Obsever</code>作为观察者，根据<code>Observable</code>进行处理，它们关系如下:</p>
<ul>
<li>订阅: <code>Observer</code> 通过<code>Observable</code>的<code>Subcribe</code>方法订阅<code>Observable</code>.</li>
<li>发布: <code>Observable</code> 通过回调<code>next</code>方法向<code>Observer</code>发布事件。</li>
</ul>
<h2 id="创建-Observable"><a href="#创建-Observable" class="headerlink" title="创建 Observable"></a>创建 Observable</h2><p>在<code>RxJS</code>中，我们可以通过多种方式来创建一个<code>Observable</code>对象：</p>
<ul>
<li>create</li>
<li>of</li>
<li>from</li>
<li>fromEvent</li>
<li>fromPromise</li>
<li>never</li>
<li>empty</li>
<li>throw</li>
<li>interval</li>
<li>timer</li>
</ul>
<p>下面通过<code>Observable.create()</code>方法来创建<code>Observable</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> observable = Observable.create(<span class="function"><span class="keyword">function</span> (<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 创建 Observable 对象</span></span><br><span class="line">      observer.next(<span class="string">'jack'</span>)</span><br><span class="line">      <span class="comment">// 通过 next() 方法向 Observer 中发布数据</span></span><br><span class="line">      observer.next(<span class="string">'mark'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">observable.subscribe(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="built_in">console</span>.log(value))</span><br><span class="line"><span class="comment">// 订阅 Observerable</span></span><br><span class="line"><span class="comment">// jack</span></span><br><span class="line"><span class="comment">// mark</span></span><br></pre></td></tr></table></figure>
<h2 id="创建-Observer"><a href="#创建-Observer" class="headerlink" title="创建 Observer"></a>创建 Observer</h2><p>观察者是一个包含三个方法的对象，每当<code>Observable</code>出发事件时，便会自动调用观察者对应的方法。</p>
<p><code>Observer</code>的接口定义:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface observer&lt;T&gt;&#123;</span><br><span class="line">   <span class="comment">// 标志是否已经取消对 Observable 对象的订阅</span></span><br><span class="line">  closed?: boolean;</span><br><span class="line">  <span class="comment">//每当 Observable 发送新值的时候，next 方法会被调用</span></span><br><span class="line">  next:<span class="function">(<span class="params">value T</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="comment">//当 Observable 内发生错误时，error 方法就会被调用</span></span><br><span class="line">  error:<span class="function">(<span class="params">err:any</span>)  =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="comment">// 当 Observable 数据终止后，complete 方法会被调用。在调用 complete 方法之后，next 方法就不会再次被调用</span></span><br><span class="line">  complete:<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建被观察者</span></span><br><span class="line"><span class="keyword">let</span> observable$ = Observable.create(<span class="function">(<span class="params">observe</span>) =&gt;</span> &#123;</span><br><span class="line">  observe.next(<span class="string">'Jack'</span>)</span><br><span class="line">  observe.next(<span class="string">'mark'</span>)</span><br><span class="line">  observe.complete();</span><br><span class="line">  observe.next(<span class="string">'haha'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建观察者</span></span><br><span class="line"><span class="keyword">let</span> observe = &#123;</span><br><span class="line">  next: <span class="function">(<span class="params">value</span>) =&gt;</span> <span class="built_in">console</span>.log(value),</span><br><span class="line">  error: <span class="function">(<span class="params">error</span>) =&gt;</span> <span class="built_in">console</span>.log(error),</span><br><span class="line">  complete: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'done'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">observable$.subscribe(observe)</span><br></pre></td></tr></table></figure>
<h2 id="Subscription"><a href="#Subscription" class="headerlink" title="Subscription"></a>Subscription</h2><p>Subscription 用来取消定义的资源。有些时候对于一些 Observable 对象 (如通过 interval、timer 操作符创建的对象)，当我们不需要的时候，要释放相关的资源，以避免资源浪费。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> source$ = Observable.timer(<span class="number">1000</span>,<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">let</span> subscription = source$.subscribe(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="built_in">console</span>.log(value))</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> subscription.unsubscribe(),<span class="number">10000</span>)</span><br></pre></td></tr></table></figure>
<h2 id="pull-VS-push"><a href="#pull-VS-push" class="headerlink" title="pull VS push"></a>pull VS push</h2><p><code>pull</code> 和 <code>push</code> 是生产者/消费者之间数据传输的两种不同的体系。</p>
<h3 id="pull"><a href="#pull" class="headerlink" title="pull"></a>pull</h3><p><code>pull</code> 体系中，消费者决定何时从数据生产者那里获取数据。而生产者本身并不知道数据什么时候会发送个消费者。</p>
<p>JavaScript 中在函数就是一个 <code>pull</code> 的体系，函数是数据的生产者，负责产生数据(<code>return 一个返回值</code>)，然后当调用该函数的时候,消费其所返回的值。</p>
<p><img src="https://res.cloudinary.com/dohtkyi84/image/upload/v1482240798/push_pull.png" alt="pull VS push"></p>
<p>如上图所示，调用 <code>iterator.next()</code> 的 <code>x</code> 是消费者，在 <code>pull</code> 体系中。</p>
<h3 id="push"><a href="#push" class="headerlink" title="push"></a>push</h3><p>在 <code>push</code> 体系中，数据的生产者决定何时将数据发送给消费者，消费者不会在接收数据之前意识到它将要接收这个数据。</p>
<p>而 JavaScript 的 <strong>事件系统</strong> 就是一个 <code>push</code> 体系，比如我们通过 <code>addEventListener</code> 去监听 <code>body</code> 的 <code>click</code> 事件，当 <code>click</code> 被触发的时候便会便会将数据 <code>event</code> 对象传递给消费者，即是 <code>addEventListener</code> 中的处理函数。</p>
<h2 id="Observable-VS-Promise"><a href="#Observable-VS-Promise" class="headerlink" title="Observable VS Promise"></a>Observable VS Promise</h2><p>当然还有 <code>Promise</code>，他算是 JavaScript 中最常见的 <code>push</code> 体系了。一个 <code>Promise</code> (数据的生产者)发送一个 <code>resolved value</code> (成功状态的值)来执行一个回调(数据消费者)，但是不同于函数的地方的是：<code>Promise</code> 决定着何时数据才被推送至这个回调函数。</p>
<p>而 Rx 中的 <code>Observable</code>（被观察对象） 是一个全新的 <code>push</code> 体系，<strong> Observable 是基于 推送（Push）运行时执行（lazy）的多值集合。</strong>.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/Operators-7/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/Operators-7/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-05T17:53:02+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Operators-7"><a href="#Operators-7" class="headerlink" title="Operators(7)"></a>Operators(7)</h1><h2 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h2><p><code>subject</code>的一个作用是当有新的订阅的产生的时候，可以延续上一个订阅的结果，而不从头开始订阅。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject</span><br><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>).take(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">source$.subscribe(subject)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observableA = &#123;</span><br><span class="line">  next(value) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'A:'</span>, value)</span><br><span class="line">  &#125;,</span><br><span class="line">  error (e) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  complete () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'complete A'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observableB = &#123;</span><br><span class="line">  next(value) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'B:'</span>, value)</span><br><span class="line">  &#125;,</span><br><span class="line">  error (e) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  complete () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'complete B'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subject.subscribe(observableA)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subject.subscribe(observableB)</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">A: <span class="number">1</span></span><br><span class="line">A: <span class="number">2</span></span><br><span class="line">B: <span class="number">2</span></span><br><span class="line">A: <span class="number">3</span></span><br><span class="line">B: <span class="number">3</span></span><br><span class="line">A: <span class="number">4</span></span><br><span class="line">B: <span class="number">4</span></span><br><span class="line">A: <span class="number">5</span></span><br><span class="line">B: <span class="number">5</span></span><br><span class="line">complete A</span><br><span class="line">complete B</span><br></pre></td></tr></table></figure>
<h2 id="multicast"><a href="#multicast" class="headerlink" title="multicast"></a>multicast</h2><p><code>multicast</code> 可以用来挂载 <code>Subject</code> 并返回一个可连接的 <code>Observable</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject</span><br><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>).take(<span class="number">6</span>)</span><br><span class="line">  .multicast(<span class="keyword">new</span> Subject())</span><br><span class="line"></span><br><span class="line">source$.connect()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observableA = &#123;</span><br><span class="line">  next(value) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'A:'</span>, value)</span><br><span class="line">  &#125;,</span><br><span class="line">  error (e) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  complete () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'complete A'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observableB = &#123;</span><br><span class="line">  next(value) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'B:'</span>, value)</span><br><span class="line">  &#125;,</span><br><span class="line">  error (e) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  complete () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'complete B'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">source$.subscribe(observableA)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  source$.subscribe(observableB)</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出 同上</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>multicast</code> 可以简化多个<code>obsevser</code> 对 <code>subject</code> 依次订阅的操作，不过必须和<code>connet</code>一起使用，这时可以使用<code>refCount</code> 简化 <code>connet</code>操作。</p>
<h2 id="refCount"><a href="#refCount" class="headerlink" title="refCount"></a>refCount</h2><p><code>refCount</code>同样必须和<code>multicast</code>一起使用，他可以建立一个只要订阅就自动<code>connect</code>的<code>observale</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject</span><br><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  .multicast(<span class="keyword">new</span> Subject())</span><br><span class="line">  .refCount()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observableA = &#123;</span><br><span class="line">  next(value) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'A:'</span>, value)</span><br><span class="line">  &#125;,</span><br><span class="line">  error (e) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  complete () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'complete A'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observableB = &#123;</span><br><span class="line">  next(value) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'B:'</span>, value)</span><br><span class="line">  &#125;,</span><br><span class="line">  error (e) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  complete () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'complete B'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subscriptionA = source$.subscribe(observableA)</span><br><span class="line"><span class="keyword">let</span> subscriptionB = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subscriptionB = source$.subscribe(observableB)</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 手动取消订阅</span></span><br><span class="line">  subscriptionA.unsubscribe()</span><br><span class="line">  subscriptionB.unsubscribe()</span><br><span class="line">&#125;, <span class="number">5000</span>)</span><br></pre></td></tr></table></figure>
<h2 id="publish"><a href="#publish" class="headerlink" title="publish"></a>publish</h2><p><code>multicast(new Subject())</code>可以简写成<code>publish</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  .multicast(<span class="keyword">new</span> Subject())</span><br><span class="line">  .refCount()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于：</span></span><br><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  .publish()</span><br><span class="line">  .refCount()</span><br></pre></td></tr></table></figure>
<p>加上 Subject 的三种变形：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  .multicast(<span class="keyword">new</span> ReplaySubject(<span class="number">1</span>))</span><br><span class="line">  .refCount()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于：</span></span><br><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  .publishReplay(<span class="number">1</span>)</span><br><span class="line">  .refCount()</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  .multicast(<span class="keyword">new</span> BehaviorSubject(<span class="number">0</span>))</span><br><span class="line">  .refCount()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于：</span></span><br><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  .publishBehavior(<span class="number">0</span>)</span><br><span class="line">  .refCount()</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  .multicast(<span class="keyword">new</span> AsyncSubject(<span class="number">1</span>))</span><br><span class="line">  .refCount()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于：</span></span><br><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  .publishLast(<span class="number">0</span>)</span><br><span class="line">  .refCount()</span><br></pre></td></tr></table></figure>
<h2 id="share"><a href="#share" class="headerlink" title="share"></a>share</h2><p>最后的最后，<code>publish</code> 和 <code>refCount</code> 可以简化为 <code>share</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  .multicast(<span class="keyword">new</span> Subject())</span><br><span class="line">  .refCount() <span class="comment">// 自动 connect</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于：</span></span><br><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  .publish()</span><br><span class="line">  .refCount()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>).share()</span><br></pre></td></tr></table></figure>
<h2 id="最终-demo"><a href="#最终-demo" class="headerlink" title="最终 demo"></a>最终 demo</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source$ = Observable.interval(<span class="number">1000</span>).take(<span class="number">6</span>).share()</span><br><span class="line"><span class="comment">// 返回一个新的 Observable，该 Observable 多播(共享)源 Observable。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observableA = &#123;</span><br><span class="line">  next(value) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'A:'</span>, value)</span><br><span class="line">  &#125;,</span><br><span class="line">  error (e) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  complete () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'complete A'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observableB = &#123;</span><br><span class="line">  next(value) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'B:'</span>, value)</span><br><span class="line">  &#125;,</span><br><span class="line">  error (e) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  complete () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'complete B'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subscriptionA = source$.subscribe(observableA)</span><br><span class="line"><span class="keyword">let</span> subscriptionB = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subscriptionB = source$.subscribe(observableB)</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 手动取消订阅</span></span><br><span class="line">  subscriptionA.unsubscribe()</span><br><span class="line">  subscriptionB.unsubscribe()</span><br><span class="line">&#125;, <span class="number">10000</span>)</span><br></pre></td></tr></table></figure>
<h2 id="在-vue-中一个例子"><a href="#在-vue-中一个例子" class="headerlink" title="在 vue 中一个例子"></a>在 vue 中一个例子</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;template lang=<span class="string">"pug"</span>&gt;</span><br><span class="line">  .section</span><br><span class="line">    .title Operators<span class="number">-7</span> share</span><br><span class="line">    .section</span><br><span class="line">      p.title subject</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">import &#123; Observable, Subject &#125; from 'rxjs'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default &#123;</span></span><br><span class="line"><span class="regexp">  name: 'Operators7',</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  subscriptions () &#123;</span></span><br><span class="line"><span class="regexp">    const source$ = Observable.timer(1000)</span></span><br><span class="line"><span class="regexp">    const example$ = source$</span></span><br><span class="line"><span class="regexp">      .do(v =&gt; console.log('***SIDE EFFECT***'))</span></span><br><span class="line"><span class="regexp">      .mapTo('***RESULT***')</span></span><br><span class="line"><span class="regexp">      .share() /</span><span class="regexp">/ 共享的话副作用只执行一次</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ .share() /</span><span class="regexp">/ 不共享副作用执行两次</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    const observableA$ = example$</span></span><br><span class="line"><span class="regexp">    const observableB$ = example$</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">      observableA$,</span></span><br><span class="line"><span class="regexp">      observableB$</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/Operators-6/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/Operators-6/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-05T17:53:02+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Operators-6"><a href="#Operators-6" class="headerlink" title="Operators(6)"></a>Operators(6)</h1><h2 id="concatAll"><a href="#concatAll" class="headerlink" title="concatAll"></a>concatAll</h2><p><code>switch</code>,<code>mergeAll</code>,<code>concatAll</code> 都是用来处理 <code>height Order Observable</code>的。</p>
<p><code>concatAll</code> 的特性是只有当前一个 <code>Observable</code> 处理完成以后才会处理后面的。<br><code>switch</code> 的特性是永远只处理最新的 <code>Observable</code>,而不管旧的 <code>Observable</code> 是否完成,如果旧的 <code>Observable</code> 未完成则直接退订<code>unsubscribe</code>。<br><code>mergeAll</code> 与 <code>merge</code> 是一样的，不过 <code>mergeAll</code> 会把二维的 <code>Observable</code> 拍扁以后再进行合并。</p>
<h2 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> demo = <span class="built_in">document</span>.querySelector(<span class="string">'.demo'</span>)</span><br><span class="line"><span class="keyword">let</span> click = Observable.fromEvent&lt;KeyboardEvent&gt;(demo,<span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">let</span> source = click.map(<span class="function">(<span class="params">ev:any</span>)=&gt;</span>Observable.interval(<span class="number">300</span>).take(<span class="number">3</span>))</span><br><span class="line"><span class="keyword">let</span> example = source.switch();</span><br><span class="line">example.subscribe(<span class="function">(<span class="params">value</span>)=&gt;</span><span class="built_in">console</span>.log(value));</span><br></pre></td></tr></table></figure>
<p>Marble Diagram 如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">click  : ---------c-c------------------c--..</span><br><span class="line">        map(e =&gt; Rx.Observable.interval(1000))</span><br><span class="line"><span class="built_in">source</span> : ---------o-o------------------o--..</span><br><span class="line">                   \ \                  \----0----1--...</span><br><span class="line">                    \ ----0----1----2----3----4--...</span><br><span class="line">                     ----0----1----2----3----4--...</span><br><span class="line">                     switch()</span><br><span class="line">example: -----------------0----1----2--------0----1--...</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> demo = <span class="built_in">document</span>.querySelector(<span class="string">'.demo'</span>)</span><br><span class="line"><span class="keyword">let</span> click = Observable.fromEvent&lt;KeyboardEvent&gt;(demo,<span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">let</span> source = click.map(<span class="function">(<span class="params">ev:any</span>)=&gt;</span>Observable.interval(<span class="number">300</span>).take(<span class="number">3</span>))</span><br><span class="line"><span class="keyword">let</span> example = source.concatAll();</span><br><span class="line">example.subscribe(<span class="function">(<span class="params">value</span>)=&gt;</span><span class="built_in">console</span>.log(value));</span><br></pre></td></tr></table></figure>
<p>Marble Diagram:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">click  : ---------c-c------------------c--..</span><br><span class="line">        map(e =&gt; Rx.Observable.interval(1000))</span><br><span class="line"><span class="built_in">source</span> : ---------o-o------------------o--..</span><br><span class="line">                   \ \                  \</span><br><span class="line">                    \ ----0----1----2|   ----0----1----2|</span><br><span class="line">                     ----0----1----2|</span><br><span class="line">                     concatAll()</span><br><span class="line">example: ----------------0----1----2----0----1----2--..</span><br></pre></td></tr></table></figure>
<h2 id="mergeAll"><a href="#mergeAll" class="headerlink" title="mergeAll"></a>mergeAll</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> demo = <span class="built_in">document</span>.querySelector(<span class="string">'.demo'</span>)</span><br><span class="line"><span class="keyword">let</span> click = Observable.fromEvent&lt;KeyboardEvent&gt;(demo,<span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">let</span> source = click.map(<span class="function">(<span class="params">ev:any</span>)=&gt;</span>Observable.interval(<span class="number">300</span>).take(<span class="number">3</span>))</span><br><span class="line"><span class="keyword">let</span> example = source.concatAll();</span><br><span class="line">example.subscribe(<span class="function">(<span class="params">value</span>)=&gt;</span><span class="built_in">console</span>.log(value));</span><br></pre></td></tr></table></figure>
<p>Marble Diagram如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">click  : ---------c-c------------------c--..</span><br><span class="line">        map(e =&gt; Rx.Observable.interval(1000))</span><br><span class="line"><span class="built_in">source</span> : ---------o-o------------------o--..</span><br><span class="line">                   \ \                  \----0----1--...</span><br><span class="line">                    \ ----0----1----2----3----4--...</span><br><span class="line">                     ----0----1----2----3----4--...</span><br><span class="line">                     switch()</span><br><span class="line">example: ----------------00---11---22---33---(04)4--...</span><br></pre></td></tr></table></figure>
<h2 id="concatMap"><a href="#concatMap" class="headerlink" title="concatMap"></a>concatMap</h2><p><code>concatMap</code> 其实就是 <code>map</code> 和 <code>concatAll</code> 的简化写法。</p>
<p><code>concatMap</code> 最常应用的场景就是从后台获取数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> demo = <span class="built_in">document</span>.querySelector(<span class="string">'.demo'</span>)</span><br><span class="line"><span class="keyword">let</span> source = Observable.fromEvent&lt;KeyboardEvent&gt;(demo,<span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">let</span> getData = <span class="keyword">this</span>.http.get(<span class="keyword">this</span>.base_api);</span><br><span class="line"><span class="keyword">let</span> example = source.concatMap(<span class="function">(<span class="params">e:any</span>)=&gt;</span>Observable.from(getData));</span><br><span class="line">example.subscribe(<span class="function">(<span class="params">value</span>)=&gt;</span><span class="built_in">console</span>.log(value));</span><br></pre></td></tr></table></figure>
<p><code>concatMap</code> 可以接收第二个参数，该参数一个 <code>callback</code>,该回调函数接受四个参数，分别是:</p>
<ul>
<li>外部 <code>Observable</code> 送出的元素</li>
<li>内部 <code>Observable</code> 送出的元素</li>
<li>外部 <code>Observable</code> 送出的元素的 <code>index</code></li>
<li>内部 <code>Observable</code> 送出的元素的 <code>index</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> base_api = <span class="string">'https://api.github.com/search/repositories?sort=stars&amp;order=desc&amp;q=123'</span>;</span><br><span class="line"><span class="keyword">let</span>  demo = <span class="built_in">document</span>.querySelector(<span class="string">'.demo'</span>)</span><br><span class="line"><span class="keyword">let</span> source = Observable.fromEvent&lt;KeyboardEvent&gt;(demo,<span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">let</span> getData = <span class="keyword">this</span>.http.get(base_api).map(<span class="function">(<span class="params">res:any</span>)=&gt;</span>res.json());</span><br><span class="line"><span class="keyword">let</span> example = source.concatMap(</span><br><span class="line">  (e:any)=&gt;Observable.from(getData),</span><br><span class="line">  (e,res,eIndex,resIndex)=&gt;res.total_count</span><br><span class="line">);</span><br><span class="line">example.subscribe(<span class="function">(<span class="params">value</span>)=&gt;</span><span class="built_in">console</span>.log(value));</span><br></pre></td></tr></table></figure>
<p>这个方法很适合用在 <code>request</code> 要选取的值跟前一个事件或在 <code>index</code> 有管理的情况下。</p>
<h2 id="siwtchMap"><a href="#siwtchMap" class="headerlink" title="siwtchMap"></a>siwtchMap</h2><p><code>switchMap</code> 顾名思义，就是 <code>map</code> 加上 <code>switch</code> 的简化。</p>
<p>同样，下面是一个通过 <code>switchMap</code> 请求 <code>request</code> 的例子:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> base_api = <span class="string">'https://api.github.com/search/repositories?sort=stars&amp;order=desc&amp;q=123'</span>;</span><br><span class="line"><span class="keyword">let</span>  demo = <span class="built_in">document</span>.querySelector(<span class="string">'.demo'</span>)</span><br><span class="line"><span class="keyword">let</span> source = Observable.fromEvent&lt;KeyboardEvent&gt;(demo,<span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">let</span> getData = <span class="keyword">this</span>.http.get(base_api).map(<span class="function">(<span class="params">res:any</span>)=&gt;</span>res.json());</span><br><span class="line"><span class="keyword">let</span> example = source.switchMap(</span><br><span class="line">  (e:any)=&gt;Observable.from(getData),</span><br><span class="line">  (e,res,eIndex,resIndex)=&gt;res.total_count</span><br><span class="line">);</span><br><span class="line">example.subscribe(<span class="function">(<span class="params">value</span>)=&gt;</span><span class="built_in">console</span>.log(value));</span><br></pre></td></tr></table></figure>
<p>同样 <code>switchMap</code> 会在下一个 <code>Observable</code> 被送出以后直接退订前一个未处理完成的 <code>Observable</code>。</p>
<p><code>switchMap</code> 与 <code>concatMap</code> 一样可以接受第二个回调函数当作参数。</p>
<h2 id="mergeMap"><a href="#mergeMap" class="headerlink" title="mergeMap"></a>mergeMap</h2><p>同样 <code>mergeMap</code> 可以看作是<code>map</code> 和 <code>mergeAll</code> 的合体简化。</p>
<p><code>mergeMap</code> 的特性在于，可以并行处理多个 <code>Observable</code>。</p>
<p>此外，<code>mergeMap</code> 可以接受三个参数，第二参与 <code>concalMap</code>,<code>switchMap</code> 一样，为一个回调函数，而第三个参数可以用来控制 <code>mergeMap</code> 并行处理 <code>Observable</code> 的数量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> base_api = <span class="string">'https://api.github.com/search/repositories?sort=stars&amp;order=desc&amp;q=123'</span>;</span><br><span class="line"><span class="keyword">let</span>  demo = <span class="built_in">document</span>.querySelector(<span class="string">'.demo'</span>)</span><br><span class="line"><span class="keyword">let</span> source = Observable.fromEvent&lt;KeyboardEvent&gt;(demo,<span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">let</span> getData = <span class="keyword">this</span>.http.get(base_api).map(<span class="function">(<span class="params">res:any</span>)=&gt;</span>res.json());</span><br><span class="line"><span class="keyword">let</span> example = source.mergeMap(</span><br><span class="line">  (e:any)=&gt;getData,</span><br><span class="line">  (e,res,eIndex,resIndex)=&gt;res.total_count,</span><br><span class="line">  <span class="number">3</span></span><br><span class="line">);</span><br><span class="line">example.subscribe(<span class="function">(<span class="params">value</span>)=&gt;</span><span class="built_in">console</span>.log(value));</span><br></pre></td></tr></table></figure>
<p>连续触发 5 次 <code>click</code> 事件，可以发现前 3 个 <code>request</code> 是同步发出的，但是第四个是等待第一个完成以后才发出的。</p>
<p>RxJS5 中的 <code>flatMap</code> 与 <code>mergeMap</code> 是同样的。</p>
<h2 id="场景使用"><a href="#场景使用" class="headerlink" title="场景使用"></a>场景使用</h2><blockquote>
<p><code>concatMap</code>,<code>switchMap</code>,<code>mergeMap</code> 还有一个共同的特点，就是会将第二个参数传回的 <code>promise</code> 对象自动转换为 <code>Observable</code>。</p>
</blockquote>
<p>至于各自的使用场景:</p>
<ul>
<li><p><code>concatMap</code> 可以用在确定内部的 <code>Observable</code> 结束时间比外部 <code>Observable</code> 发送时间要快的情况，并且不希望有任何并行处理的行为，适合一次一次完成到底的 UI 动画，或者特别的 <code>request</code></p>
</li>
<li><p><code>siwtchMap</code> 适合大多数的场景，用于只要最后一次行为结果。</p>
</li>
<li><p><code>mergeMap</code> 用在并行处理多个 <code>Observable</code>的情况，比如多个 I/O 的并行处理。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/Operators-5/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/Operators-5/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-05T17:53:02+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Operators-5"><a href="#Operators-5" class="headerlink" title="Operators(5)"></a>Operators(5)</h1><h2 id="catch"><a href="#catch" class="headerlink" title="catch"></a>catch</h2><h2 id="retry"><a href="#retry" class="headerlink" title="retry"></a>retry</h2><h2 id="retryWhen"><a href="#retryWhen" class="headerlink" title="retryWhen"></a>retryWhen</h2><h2 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/Operators-4/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/Operators-4/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-05T17:53:02+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Operators-4"><a href="#Operators-4" class="headerlink" title="Operators(4)"></a>Operators(4)</h1><h2 id="debounce-debounceTime"><a href="#debounce-debounceTime" class="headerlink" title="debounce,debounceTime"></a>debounce,debounceTime</h2><p><code>debouce</code> 通俗点讲是 <code>防抖</code>。它会把每次接收到的元素 <code>cache</code> 一段时间，如果超过这个时间都还没有收到新的元素，则将 <code>cache</code> 中的内容发送出去。如果在这段时间之内又有新的值送过来，则丢弃原来 <code>cache</code> 中的值，并开始缓存新的值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> input = <span class="built_in">document</span>.querySelector(<span class="string">'#input'</span>);</span><br><span class="line"><span class="keyword">let</span> example$ = Observable.fromEvent&lt;KeyboardEvent&gt;(input,<span class="string">'keypress'</span>);</span><br><span class="line">example$.debounceTime(<span class="number">300</span>)</span><br><span class="line">.map(<span class="function">(<span class="params">e:any</span>)=&gt;</span>e.target.value)</span><br><span class="line">.subscribe(<span class="function"><span class="params">value</span>=&gt;</span><span class="built_in">console</span>.log(value))</span><br></pre></td></tr></table></figure>
<p> 与 <code>buffer</code>,<code>bufferTime</code> 一样。<code>debounce</code> 接收的是一个 <code>observable</code>，<code>debouncTime</code> 接收的是以毫秒为单位的时间参数。</p>
<h2 id="throttle-throttleTime"><a href="#throttle-throttleTime" class="headerlink" title="throttle,throttleTime"></a>throttle,throttleTime</h2><p><code>throttle</code> 通俗点讲就是 <code>节流</code>。可以限制一个动作在规定的时间内至少被执行一次，而且只能执行一次。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> example1$ = Observable.fromEvent&lt;KeyboardEvent&gt;(input2,<span class="string">'keypress'</span>)</span><br><span class="line">example1$.throttleTime(<span class="number">1000</span>)</span><br><span class="line">.map(<span class="function">(<span class="params">e:any</span>)=&gt;</span>e.target.value)</span><br><span class="line">.subscribe(</span><br><span class="line">    value=&gt;<span class="built_in">console</span>.log(value)</span><br></pre></td></tr></table></figure>
<p>如上，使用 <code>throttleTime</code> 我们可以让<code>keypress</code> 触发的值每隔一秒送出一次。这样可以减少 <code>request</code> 的次数。但是这种存在一个问题，就是每次拿到的值并不是最新的，总是上一次的 <code>input.value</code>。这是因为浏览器中的 <code>keypress</code> 等原生的事件总是会在自定义事件之前触发，这不难理解，类似于<code>click</code> 等事件，它们都是观察者模式，只有原生事件触发以后才能执行自定义事件。</p>
<p>解决这个问题的方法，在原生 <code>JavaScript</code> 中可以使用 <code>setTimeout</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'input2'</span>).onkeypress = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    self.value = self.value.toUpperCase();</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但结合 <code>Rx.js</code> 中的 <code>debouce</code> 和 <code>throtle</code> 可以更加完美的解决这个问题:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">example1$</span><br><span class="line">.debounceTime(<span class="number">300</span>)</span><br><span class="line">.throttleTime(<span class="number">1000</span>)</span><br><span class="line">.map(<span class="function">(<span class="params">e:any</span>)=&gt;</span>e.target.value)</span><br><span class="line">.subscribe(<span class="function"><span class="params">value</span>=&gt;</span><span class="built_in">console</span>.log(value)</span><br></pre></td></tr></table></figure>
<h2 id="distinct-distinctUntilChanged"><a href="#distinct-distinctUntilChanged" class="headerlink" title="distinct, distinctUntilChanged"></a>distinct, distinctUntilChanged</h2><p><code>distinct</code> 可以过滤掉相同的数据而只留下一份。<code>distinct</code> 与 <code>distinctUntilChanged</code> 的不同之处在于，<code>distinct</code> 会缓存所以已经发送的元素并与新的元素进行对比，而 <code>distinctUntilChanged</code> 只会缓存最后一个已经发送的元素然后与新元素对比，如果相同则不发送，如果不同则丢弃之前缓存的元素，换成最新的元素并发送该元素。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obs1$ = Observable.from([<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>])</span><br><span class="line">      .zip(Observable.interval(<span class="number">300</span>),(x,y)=&gt;x)</span><br><span class="line"><span class="keyword">let</span> example1$ = obs1$.distinct().subscribe(<span class="function"><span class="params">value</span>=&gt;</span><span class="built_in">console</span>.log(value))</span><br><span class="line"><span class="comment">// a</span></span><br><span class="line"><span class="comment">// b</span></span><br><span class="line"><span class="comment">// c</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obs2$ = Observable.from([<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'a'</span>,<span class="string">'a'</span>,<span class="string">'c'</span>])</span><br><span class="line">    .zip(Observable.interval(<span class="number">300</span>),(x,y)=&gt;x)</span><br><span class="line"><span class="keyword">let</span> example2$ = obs2$.distinctUntilChanged().subscribe(<span class="function"><span class="params">value</span>=&gt;</span><span class="built_in">console</span>.log(value))</span><br><span class="line"><span class="comment">// a</span></span><br><span class="line"><span class="comment">// b</span></span><br><span class="line"><span class="comment">// c</span></span><br><span class="line"><span class="comment">// a</span></span><br><span class="line"><span class="comment">// c</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/Operators-2/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/Operators-2/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-05T17:53:02+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Operators-2"><a href="#Operators-2" class="headerlink" title="Operators(2)"></a>Operators(2)</h1><h2 id="combineLatest"><a href="#combineLatest" class="headerlink" title="combineLatest"></a>combineLatest</h2><p><code>combineLatest</code> 接收两种形式的参数，一个是需要参加合并的计算的 <code>obserable</code>，一个是 <code>callback</code>，而 <code>callback</code>中的参数代表的就是对应的元素。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">500</span>).take(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">var</span> newest = Rx.Observable.interval(<span class="number">300</span>).take(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> example = source.combineLatest(newest, (x, y) =&gt; x + y);</span><br><span class="line"></span><br><span class="line">example.subscribe(&#123;</span><br><span class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</span><br><span class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</span><br><span class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>combineLatest</code>只会在所有参加合并的<code>observable</code>都有值产生时才回开始合并，并且只会提取每个<code>observable</code>中最新的那个值。</p>
<p>Marble Diagram:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> : ----0----1----2|</span><br><span class="line">newest : --0--1--2--3--4--5|</span><br><span class="line"></span><br><span class="line">    combineLatest(newest, (x, y) =&gt; x + y);</span><br><span class="line"></span><br><span class="line">example: ----01--23-4--(56)--7|</span><br></pre></td></tr></table></figure>
<h2 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h2><p><code>zip</code> 会取得每个 <code>observable</code> 序列上相同位置的元素进行合并，而与时间无关。当其中任何一个 <code>observable</code> 结束的时候，整个合并的过程结束。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1$ = Observable.interval(<span class="number">400</span>).take(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">let</span> s2$ = Observable.interval(<span class="number">500</span>).take(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">let</span> s3$ = Observable.interval(<span class="number">600</span>).take(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">let</span> example$ = Observable.zip(</span><br><span class="line">      s1$,</span><br><span class="line">      s2$,</span><br><span class="line">      s3$,</span><br><span class="line">      (x,y,z) =&gt; x + y+z</span><br><span class="line">    )</span><br><span class="line">    example$.subscribe(</span><br><span class="line">      value =&gt; <span class="built_in">console</span>.log(value)</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>Marble Diagram:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s1$:---0---1---2|</span><br><span class="line">s2$:----0----1----2----3|</span><br><span class="line">s3$:-----0-----1-----2-----3-----4|</span><br><span class="line">      zip()</span><br><span class="line">example$:-----0-----3-----6|</span><br></pre></td></tr></table></figure>
<h2 id="withLatestFrom"><a href="#withLatestFrom" class="headerlink" title="withLatestFrom"></a>withLatestFrom</h2><p><code>withLatestFrom</code> 与 <code>combineLatest</code> 比较相似，不过，<code>withLatestForm</code> 是具有从属关系的 <code>operator</code>。只有在主 <code>observable</code> 产生新值的时候，才会执行 <code>callback</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> main$ = Observable.from(<span class="string">'hello'</span>)</span><br><span class="line">  .zip(Observable.interval(<span class="number">500</span>), (x, y) =&gt; x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> some$ = Observable.from([<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line">  .zip(Observable.interval(<span class="number">300</span>), (x, y) =&gt; x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> example$ = main$.withLatestFrom(some$, (x,y) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> y === <span class="number">1</span> ? x.toUpperCase() : x</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">example$.subscribe(<span class="function"><span class="params">value</span> =&gt;</span> <span class="built_in">console</span>.log(value))</span><br></pre></td></tr></table></figure>
<p>如上，我们在<code>main</code>产生值时，去判断<code>some</code>的最近一次的值是否为<code>1</code>,来决定是否切换大小写。</p>
<p>Marble Digram 如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">main$   : ----h----e----l----l----o|</span><br><span class="line">some$   : --0--1--0--0--0--1|</span><br><span class="line"></span><br><span class="line">withLatestFrom(some, (x, y) =&gt; y === 1 ? x.toUpperCase() : x);</span><br><span class="line"></span><br><span class="line">example$: ----h----e----l----L----O|</span><br></pre></td></tr></table></figure>
<p><code>withLatestFrom</code> 会在<code>main</code>产生值时才执行 <code>callback</code>，但如果<code>some</code> 之前没有送出过任何值，那么 <code>callback</code> 仍热不会执行。</p>
<blockquote>
<p><code>merge</code> 像 <code>OR(||)</code> 一样，可以把多个 <code>observable</code> 合并并同时处理，而<code>combineLatest</code>, <code>withLatestFrom</code>,<code>zip</code> 更像一个 <code>AND(&amp;&amp;)</code> 运算，它们都是当有多个元素到来时只送出去一个元素。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/Operators-3/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/Operators-3/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-05T17:53:02+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Operators-3"><a href="#Operators-3" class="headerlink" title="Operators(3)"></a>Operators(3)</h1><h2 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h2><p><code>scan</code>类似于<code>Array.reduce</code>，但是<code>reduce</code>返回的结果由<code>callback</code>决定，而<code>scan</code>一定返回一个<code>observable</code>。</p>
<h2 id="buffer"><a href="#buffer" class="headerlink" title="buffer"></a>buffer</h2><p><code>buffer</code>是一整个家族: <code>buffer</code>,<code>bufferTime</code>,<code>bufferCount</code>,<code>bufferToggle</code>,<code>bufferWhen</code></p>
<p>其中比较常用的是<code>buffer</code>,<code>bufferTime</code>,<code>bufferCount</code></p>
<p><code>buffer</code>要传入一個<code>observable(source2)</code>，它會把原本的<code>observable(source1)</code>送出的元素缓存在内存中，等到传入的<code>observable(source2)</code>送出元素时，就素触发把缓存的元素送出去。</p>
<h2 id="delay"><a href="#delay" class="headerlink" title="delay"></a>delay</h2><p><code>delay</code>对于 UI 操作是非常有用的，它通过给定的超时或者直到一个给定的时间来延迟源<code>Observable</code>的发送。</p>
<h2 id="delayWhen"><a href="#delayWhen" class="headerlink" title="delayWhen"></a>delayWhen</h2><p><code>delayWhen</code>与<code>delay</code>类似，不过<code>delayWhen</code>可以影响源<code>Observable</code>中每一个元素，并且该时间段由另一个<code>Observable</code>的发送决定。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/33/">33</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">onejustonee</p>
              <p class="site-description motion-element" itemprop="description">onejustone's blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">329</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">103</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">onejustonee</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
