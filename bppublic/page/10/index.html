<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="onejustone&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="onejustone">
<meta property="og:url" content="http://yoursite.com/page/10/index.html">
<meta property="og:site_name" content="onejustone">
<meta property="og:description" content="onejustone&apos;s blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="onejustone">
<meta name="twitter:description" content="onejustone&apos;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/10/">





  <title>onejustone</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">onejustone</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">--愿你内心有种不灭的火焰，将你与别人区分开来--</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/10/gulpfile.js/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/10/gulpfile.js/" itemprop="url">gulpfile.js</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-10T09:45:00+08:00">
                2017-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">//引入gulp</span><br><span class="line">var gulp = require(&apos;gulp&apos;);		//基础库</span><br><span class="line">var sass = require(&apos;gulp-ruby-sass&apos;);	//sass/scss编译</span><br><span class="line">var uglify = require(&apos;gulp-uglify&apos;);	//js压缩</span><br><span class="line">var imagemin = require(&apos;gulp-imagemin&apos;)</span><br><span class="line">var pngquant = require(&apos;imagemin-pngquant&apos;);	//图片深度压缩</span><br><span class="line">var sourcemaps = require(&apos;gulp-sourcemaps&apos;);	//来源地图</span><br><span class="line">//引入gulp插件</span><br><span class="line">var livereload = require(&apos;gulp-livereload&apos;);	//网页自动刷新(服务器控制客户端同步刷新)</span><br><span class="line">var webserver = require(&apos;gulp-webserver&apos;);		//本地服务</span><br><span class="line">var rename = require(&apos;gulp-rename&apos;); 			// 文件重命名</span><br><span class="line">var changed = require(&apos;gulp-changed&apos;); // 只操作有过修改的文件</span><br><span class="line">var concat = require(&apos;gulp-concat&apos;);	//文件合并</span><br><span class="line">var clean = require(&apos;gulp-clean&apos;);		//文件清理</span><br><span class="line">var minifyCss = require(&apos;gulp-minify-css&apos;); // CSS压缩</span><br><span class="line">var postcss = require(&apos;gulp-postcss&apos;);	//</span><br><span class="line">var cssnano = require(&apos;gulp-cssnano&apos;);	//用来压缩CSS的</span><br><span class="line">var autoprefixer = require(&apos;autoprefixer&apos;);	//自动添加CSS3浏览器前缀</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//注册web服务任务</span><br><span class="line">gulp.task(&apos;webserver&apos;, function()&#123;</span><br><span class="line">	gulp.src(&apos;./dist&apos;)	//服务器目录(./代表根目录)</span><br><span class="line">	.pipe(webserver(&#123;	//运行gulp-webserver</span><br><span class="line">		livereload:true,	//启动LiveReload</span><br><span class="line">		open:&apos;views/app/index.html&apos;			//服务器启动时自动打开网页</span><br><span class="line">		port: 8877,</span><br><span class="line">	&#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//注册自动刷新任务</span><br><span class="line">//监听任务</span><br><span class="line">gulp.task(&apos;watch&apos;,function()&#123;</span><br><span class="line">	// 监听 html</span><br><span class="line">	gulp.watch(&apos;src/**/*.html&apos;, [&apos;html&apos;])</span><br><span class="line">	// 监听 sacss</span><br><span class="line">	gulp.watch(&apos;src/sass/*.sass&apos;, [&apos;sass&apos;]);</span><br><span class="line">	// 监听 images</span><br><span class="line">	gulp.watch(&apos;src/images/**/*.&#123;png,jpg,gif,svg&#125;&apos;, [&apos;images&apos;]);</span><br><span class="line">	// 监听 js</span><br><span class="line">	gulp.watch(&apos;src/js/*.js&apos;, [&apos;script&apos;]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//sass编译任务</span><br><span class="line">gulp.task(&apos;sass&apos;, function()&#123;</span><br><span class="line">	//插件提供4种输出格式： </span><br><span class="line">	//nested：嵌套缩进的css代码，它是默认值</span><br><span class="line">	//expanded：没有缩进的、扩展的css代码。 </span><br><span class="line">	//compact：简洁格式的css代码。</span><br><span class="line">	//compressed：压缩后的css代码。</span><br><span class="line">	return sass(&apos;src/sass/*.sass&apos;, &#123;style:&apos;compact&apos;&#125;)	</span><br><span class="line">	//指示源文件路径、并进行文件匹配(style: &apos;compressed&apos;表示输出格式)</span><br><span class="line">		.on(&apos;error&apos;, function(err)&#123;</span><br><span class="line">			console.log(&apos;编译sass出错%s&apos;, err.message);</span><br><span class="line">		&#125;)</span><br><span class="line">		/*.pipe(postcss([autoprefixer(&#123;</span><br><span class="line">			browsers:[&apos;last 2 versions&apos;],	</span><br><span class="line">			//主流浏览器的最新两个版本</span><br><span class="line">			//cascade:false	//是否美化属性值</span><br><span class="line">		&#125;)]))*/</span><br><span class="line">		//.pipe(cssnano())</span><br><span class="line">		.pipe(gulp.dest(&apos;src/css&apos;));	</span><br><span class="line">		//输出路径</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//CSS的压缩配置任务</span><br><span class="line">gulp.task(&apos;minify-css&apos;, () =&gt; &#123;</span><br><span class="line">	return gulp.src(&apos;src/sass/*.css&apos;)</span><br><span class="line">		.pipe(gulp.dest(&apos;dist/css&apos;))	</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//添加CSS3前缀任务</span><br><span class="line">gulp.task(&apos;css3-prefix&apos;,() =&gt;&#123;</span><br><span class="line">	gulp.src(&apos;src/css/*.css&apos;)</span><br><span class="line">		.pipe(postcss([autoprefixer(&#123;</span><br><span class="line">			 browsers: [&apos;last 5 versions&apos;],	</span><br><span class="line">			 //主流浏览器的最新两个版本</span><br><span class="line">			 cascade:true,	</span><br><span class="line">			 //是否美化属性值</span><br><span class="line">			 remove:true	</span><br><span class="line">			 //去掉不必要的前缀</span><br><span class="line">		&#125;)]))</span><br><span class="line">		.pipe(gulp.dest(&apos;dist/css&apos;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//gulp脚本压缩任务</span><br><span class="line">gulp.task(&apos;script&apos;, () =&gt; &#123;</span><br><span class="line">	return gulp.src(&apos;src/js/**/*.js&apos;)</span><br><span class="line">		//指明源文件路径、并进行文件匹配</span><br><span class="line">		//gulp.src([&apos;src/js/*.js&apos;,&apos;!*.min.js&apos;])</span><br><span class="line">		//配置源文件路径、并进行文件匹配，排除.min.js后缀的文件</span><br><span class="line">		//.pipe(sourcemaps.init())</span><br><span class="line">		//执行sourcemaps</span><br><span class="line">		//.pipe(changed(&apos;dist/js&apos;,&#123;extension:&apos;.js&apos;&#125;))</span><br><span class="line">		// 对比文件是否有过改动（此处填写的路径和输出路径保持一致）,只要有一个文件变化整个目录都会重新编译</span><br><span class="line">		//.pipe(rename(&#123;suffix:&apos;.min&apos;&#125;))	//后添加的配置，进行重命名</span><br><span class="line">		.pipe(uglify(&#123;preserveComments:&apos;some&apos;&#125;))</span><br><span class="line">		//使用uglify进行压缩，并保留部分注释</span><br><span class="line">		//.pipe(sourcemaps.write(&apos;maps&apos;))	//地图输出路径(存放的位置)</span><br><span class="line">		.pipe(gulp.dest(&apos;dist/js&apos;));	//输出路径</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//gulp文件合并任务</span><br><span class="line">gulp.task(&apos;concat&apos;, () =&gt; &#123;</span><br><span class="line">	gulp.src(&apos;dist/js/*.min.js&apos;)</span><br><span class="line">	//要合并的文件</span><br><span class="line">	.pipe(concat(&apos;libs.js&apos;))</span><br><span class="line">	//合并成libs.js</span><br><span class="line">	.pipe(gulp.dest(&apos;dist/js&apos;));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;clean&apos;, () =&gt; &#123;</span><br><span class="line">	gulp.src([&apos;dist/js/*.min.js&apos;], &#123;read:false&#125;)</span><br><span class="line">	.pipe(clean());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//gulp图片压缩任务</span><br><span class="line">gulp.task(&apos;images&apos;, () =&gt; &#123;</span><br><span class="line">	return gulp.src(&apos;src/images/**/*.&#123;png,jpg,gif&#125;&apos;)</span><br><span class="line">		//指明源文件路径、并进行文件匹配</span><br><span class="line">		.pipe(imagemin(&#123;</span><br><span class="line">			progressive:true,	</span><br><span class="line">			//无损压缩JPG图片</span><br><span class="line">			svgoPlugins:[&#123;removeViewBox:false&#125;],	</span><br><span class="line">			//不移除svg的viewbox属性</span><br><span class="line">			use:[pngquant()]	</span><br><span class="line">			//使用pngquant插件进行深度压缩</span><br><span class="line">		&#125;)).pipe(gulp.dest(&apos;dist/images&apos;));	</span><br><span class="line">		////输出路径</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//发布静态页面到dist目录中</span><br><span class="line">gulp.task(&apos;html&apos;, function()&#123;</span><br><span class="line">	return gulp.src(&apos;src/**/*.html&apos;)	</span><br><span class="line">	//指示文件路径、并进行文件匹配</span><br><span class="line">	.pipe(gulp.dest(&apos;dist&apos;));</span><br><span class="line">	// 输出路径</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//默认任务</span><br><span class="line">gulp.task(&apos;default&apos;,[&apos;script&apos;,&apos;minify-css&apos;,&apos;html&apos;,&apos;webserver&apos;,&apos;watch&apos;]);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/10/Gulp+Babel转码ES6/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/10/Gulp+Babel转码ES6/" itemprop="url">ES6(16)Gulp+Babel转码ES6</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-10T00:00:00+08:00">
                2017-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-安装插件"><a href="#0x00-安装插件" class="headerlink" title="0x00 安装插件"></a>0x00 安装插件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">安装全局 Gulp</span><br><span class="line">npm install -g gulp</span><br><span class="line"></span><br><span class="line">安装项目中使用的 Gulp</span><br><span class="line">npm install --save-dev gulp</span><br><span class="line"></span><br><span class="line">安装 Gulp 上 Babel 的插件</span><br><span class="line">npm install --save-dev gulp-babel</span><br><span class="line"></span><br><span class="line">安装 Babel 上将 ES6 转换成 ES5 的插件</span><br><span class="line">npm install --save-dev babel-preset-es2015</span><br><span class="line"></span><br><span class="line">安装 Gulp 上 uglify 压缩插件</span><br><span class="line">npm install --save-dev gulp-uglify</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x01-Gulp-配置"><a href="#0x01-Gulp-配置" class="headerlink" title="0x01 Gulp 配置"></a>0x01 Gulp 配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">在项目根目录新建 .babelrc ，内容为：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [&quot;es2015&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">在项目根目录新建 gulpfile.js，内容为：</span><br><span class="line"></span><br><span class="line">var gulp = require(&quot;gulp&quot;);</span><br><span class="line">var babel = require(&quot;gulp-babel&quot;);    // 用于ES6转化ES5</span><br><span class="line">var uglify = require(&apos;gulp-uglify&apos;); // 用于压缩 JS</span><br><span class="line"></span><br><span class="line">// ES6转化为ES5</span><br><span class="line">// 在命令行使用 gulp toes5 启动此任务</span><br><span class="line">gulp.task(&quot;toes5&quot;, function () &#123;</span><br><span class="line">  return gulp.src(&quot;src/js/**/*.js&quot;)// ES6 源码存放的路径</span><br><span class="line">    .pipe(babel()) </span><br><span class="line">    .pipe(gulp.dest(&quot;dist&quot;)); //转换成 ES5 存放的路径</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 压缩 js 文件</span><br><span class="line">// 在命令行使用 gulp script 启动此任务</span><br><span class="line">gulp.task(&apos;min&apos;, function() &#123;</span><br><span class="line">    // 1. 找到文件</span><br><span class="line">    gulp.src(&apos;dist/*.js&apos;)</span><br><span class="line">        // 2. 压缩文件</span><br><span class="line">        .pipe(uglify())</span><br><span class="line">        // 3. 另存压缩后的文件</span><br><span class="line">        .pipe(gulp.dest(&apos;min/js&apos;))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 自动监控任务</span><br><span class="line">// 在命令行使用 gulp auto 启动此任务</span><br><span class="line">gulp.task(&apos;auto&apos;, function () &#123;</span><br><span class="line">    // 监听文件修改，当文件被修改则执行 script 任务</span><br><span class="line">    gulp.watch(&apos;src/js/**/*.js&apos;, [&apos;toes5&apos;]);</span><br><span class="line">    gulp.watch(&apos;dist/*.js&apos;, [&apos;min&apos;]);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/09/ AngularJS(5)控制器和作用域/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/09/ AngularJS(5)控制器和作用域/" itemprop="url">AngularJS(5)控制器和作用域</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-09T00:00:00+08:00">
                2017-01-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h3><p>控制器作为视图与模型之间的纽带，它将模型中的数据暴露给视图，以及基于用户与视图的交互使模型产生变化所需的逻辑。具体来说，控制器是通过作用域向视图提供数据和逻辑的。这种方式加强了 AngularJS 数据绑定技术的基础。</p>
<hr>
<h3 id="0x01-创建控制器"><a href="#0x01-创建控制器" class="headerlink" title="0x01 创建控制器"></a>0x01 创建控制器</h3><p>控制器是通过 AngularJS 的 Module 对象提供的 controller 方法创建出来的。controller 方法的参数是新建控制器的名字和一个用于创建控制器的函数（或者是构造器，又或者被称为工厂函数）。</p>
<p>之后通常使用这个工厂函数去创建另一个函数(工人函数)，我们称之为<strong>工厂/工人模式</strong>。</p>
<p>然后将相关的依赖注入到工厂函数（构造器）中去。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by onejustone on 2017/1/9.</span><br><span class="line"> */</span><br><span class="line">angular.module(&apos;serviceDemo&apos;, [])</span><br><span class="line">// 创建一个模块,注意这里的中括号 [],存在中括号代表创建一模块，并且可以写入相关依赖，</span><br><span class="line">// 如果一个模块没有被创建，那么，是无法被查找的。</span><br><span class="line">.controller(&apos;demo1Ctrl&apos;, [&apos;$scope&apos;, function ($scope) &#123;</span><br><span class="line">	$scope.demo1Content = &quot;啊，多么美丽的,&quot;;</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure>
<p>如上，我们创建了一个属于 <code>serviceDemo</code> 应用的 <code>demo1Ctrl</code> 控制器，并声明了该控制器对 <code>$scope</code> 对象的依赖，如此，控制器就可通过其对应的作用域向视图提供各种能力。</p>
<hr>
<h3 id="0x01-修改作用域"><a href="#0x01-修改作用域" class="headerlink" title="0x01 修改作用域"></a>0x01 修改作用域</h3><p>对于作用域其最重要的一点是 <strong>修改会传播下去，并自动更新所有相关依赖的数据值，即使是通过行为产生的</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;well&quot; ng-controller=&quot;simpleCtrl&quot;&gt;</span><br><span class="line">    &lt;label for=&quot;&quot;&gt;Select a city:&lt;/label&gt;</span><br><span class="line">    &lt;select name=&quot;&quot; id=&quot;&quot; ng-options=&quot;city for city in cities&quot; ng-model=&quot;city&quot;&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;div class=&quot;well&quot;&gt;</span><br><span class="line">        &lt;p&gt;the city is &#123;&#123;city&#125;&#125;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;the country is &#123;&#123;getCountry(city)&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var app = angular.module(&apos;serviceDemo&apos;, []).controller(&apos;simpleCtrl&apos;, [&apos;$scope&apos;,function ($scope) &#123;</span><br><span class="line">        $scope.cities = [&apos;London&apos;, &apos;New York&apos;, &apos;Paris&apos;];</span><br><span class="line"></span><br><span class="line">        $scope.city = &apos;London&apos;;</span><br><span class="line"></span><br><span class="line">        $scope.getCountry = function (city) &#123;</span><br><span class="line">            switch (city)&#123;</span><br><span class="line">                case &apos;London&apos;:</span><br><span class="line">                	return &apos;UK&apos;;</span><br><span class="line">                case &apos;New York&apos;:</span><br><span class="line">                	return &apos;USA&apos;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;])</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>如上，当选中 <code>select</code> 元素中的值时，不只 <code>city</code> 所绑定的元素中的值会变，<code>getCountry()</code> 函数所在元素的值也会变，这是因为使用 <strong>ng-model，将会隐式的在控制器的作用域中声明一个变量</strong>。</p>
<p>这是 AnjularJS 的优点之一，但也是一个大坑。</p>
<hr>
<h3 id="0x02-组织控制器"><a href="#0x02-组织控制器" class="headerlink" title="0x02 组织控制器"></a>0x02 组织控制器</h3><p>在 AngularJS 中我们可以使用很多种方式去组织控制器，我们可以在整个 <code>HTML</code> 文档中只定义一个应用并在应用中只使用一个控制器，如此，还不用去担心作用域之间的通信问题,而且行为还可以被整个 <code>HTML</code> 所用，诚然这是最简单的组织控制器的方法，可当页面越来越复杂时，这种方式显然是无法驾驭的。</p>
<p>当但在一个应用中定义多个控制器时，那么在实际应用中，这些控制器之间又如何能通信呢?</p>
<hr>
<h4 id="控制器通信"><a href="#控制器通信" class="headerlink" title="控制器通信"></a>控制器通信</h4><p>实际上，作用域是以层级结构的形式组织起来的，顶层是根 <strong>作用域($rootScpe)</strong> ,每个控制器都会被赋予一个新的作用域，而该作用域是根作用域的一个子集。</p>
<p>基于此，AngularJS 为作用域(包括根作用域( <strong>$rootScope</strong> ))提供了若干用于发送和接收事件的方法，以实现在各个作用域之间通信。它们是:</p>
<ul>
<li><strong>$broadcast</strong>: 向下广播事件，向当前作用域下的所有子作用域发送一个事件。</li>
<li><strong>$emit</strong>: 向下广播事件，向当前作用域的父级作用域发送一个事件，直到根作用域。</li>
<li><strong>$on</strong>: 注册一个事件，通常用来监听广播信息。</li>
</ul>
<p>但是 AngularJS 更习惯于将这些在作用域之间通信的功能写在服务中，如此，在较少代码的同时更加便于维护。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by onejustone on 2017/1/9.</span><br><span class="line"> */</span><br><span class="line">// 创建一个在不同控制器的作用域中传递消息的服务</span><br><span class="line">angular.module(&apos;serviceDemo&apos;)</span><br><span class="line">.service(&apos;broadCastService&apos;, [&apos;$rootScope&apos;, function ($rootScope) &#123;</span><br><span class="line">	return &#123;</span><br><span class="line">	//	返回一个对象，该对象是一个自定义类型</span><br><span class="line">		broadCast: function (eventName, type, data) &#123;</span><br><span class="line">			// eventName</span><br><span class="line">			$rootScope.$broadcast(eventName, &#123;</span><br><span class="line">				type: type,</span><br><span class="line">				data: data</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure>
<p>如上，我们使用 <code>module.service</code> 方法创建了一个 <code>broadCastService</code> 服务对象，该服务可被控制用来发送和接收事件，而无需与作用域中的事件方法产生交互。</p>
<p>服务创建完成以后，可以在控制器中调用服务模块中的服务并使用 <strong>$on()</strong> 方法注册对应的监听事件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by onejustone on 2017/1/9.</span><br><span class="line"> */</span><br><span class="line">angular.module(&apos;serviceDemo&apos;)</span><br><span class="line">// 查找 serviceDemo APP</span><br><span class="line">.controller(&apos;demo2Ctrl&apos;, [&apos;$scope&apos;,&apos;$rootScope&apos;,&apos;broadCastService&apos;,</span><br><span class="line">	// 创建 demo2Ctrl 控制器，并在控制器构造函数中注入相关依赖</span><br><span class="line">	function ($scope, $rootScope,broadCastService) &#123;</span><br><span class="line"></span><br><span class="line">	$scope.sendInformation = function (type, data) &#123;</span><br><span class="line">		// 新建 sendInformation 方法，用于广播信息</span><br><span class="line">		broadCastService.broadCast(&apos;listenInformation&apos;, type, data);</span><br><span class="line">		// 调用 indexService 服务模块中 broadCastService 服务中的 broadCast 对象并为其注册一个</span><br><span class="line">		// listenInformation 事件</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	$scope.$on(&apos;listenInformation&apos;, function (event, args) &#123;</span><br><span class="line">		// 使用 $on() 方法监听 listenInformation</span><br><span class="line">		$scope.c = args.data;</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">&#125;]).controller(&apos;demo2SecondCtrl&apos;, [&apos;$scope&apos;, &apos;$rootScope&apos;, function ($scope, $rootScope) &#123;</span><br><span class="line"></span><br><span class="line">	$scope.$on(&apos;listenInformation&apos;, function (event, args) &#123;</span><br><span class="line">		// 使用 $on() 方法监听 listenInformation</span><br><span class="line">		$scope.c = args.data;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure>
<p>然后在相应的视图中为元素绑定对应的控制器:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller=&quot;demo2Ctrl&quot;&gt;</span><br><span class="line">    这里是 demo2 页面</span><br><span class="line">    &lt;input type=&quot;text&quot; ng-model=&quot;c&quot;&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;button ng-click=&quot;sendInformation(&apos;broadCast&apos;, &apos;那年，大明湖畔。。。&apos;)&quot;&gt;发送广播信息&lt;/button&gt;</span><br><span class="line">    &lt;p&gt;来自广播信息：&#123;&#123;c&#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div ng-controller=&quot;demo2SecondCtrl&quot;&gt;</span><br><span class="line">    来自广播信息: &#123;&#123;c&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>最后，再主页面(APP)中引入相应模块:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line"> &lt;div class=&quot;col-xs-8&quot;&gt;</span><br><span class="line">        &lt;div ng-view&gt;&lt;/div&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--应用控制器--&gt;</span><br><span class="line">&lt;script src=&quot;js/app/controller/demo1Ctrl.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;js/app/controller/demo2Ctrl.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--引入服务器--&gt;</span><br><span class="line">&lt;script src=&quot;js/app/services/indexService.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--引入路由器--&gt;</span><br><span class="line">&lt;script src=&quot;js/app/route/indexRoute.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>而在引入模块时必须注意相互之间的依赖关系，如上，控制器是依赖于服务器的，所以，服务器需要在控制器之后引入。</p>
<p>具体的代码在这里: </p>
<p><a href="https://github.com/onejustone/AngularServiceDemo/tree/master/src" target="_blank" rel="noopener">使用服务器控制作用域间的通信</a></p>
<hr>
<h4 id="控制器继承"><a href="#控制器继承" class="headerlink" title="控制器继承"></a>控制器继承</h4><p><code>ng-controller</code> 可以被内嵌在 HTML 元素上，产生一种被称为控制器继承的效果，从而在一个父级控制器中定义公用功能并在一个或者多个子控制器中使用，以此减少代码重复。</p>
<p><a href="https://github.com/onejustone/SimpleAngularDemo/blob/master/src/AngularJS(5" target="_blank" rel="noopener">清单5-1</a>%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/%E6%B8%85%E5%8D%955-1.html)</p>
<p>当通过 <code>ng-controller</code> 指令将控制器嵌入到另一控制器时，子控制器的作用域便继承了父控制器作用域中的数据和行为。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;body ng-controller=&quot;topLevelCtrl&quot;&gt;</span><br><span class="line">&lt;div class=&quot;well&quot; ng-controller=&quot;firstChildCtrl&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;well&quot; ng-controller=&quot;secondChildCtrl&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>控制器继承的最大好处在于可以将父控制器继承来的功能和子控制器定义的其它功能混合使用，比如只在 <code>secondChildCtrl</code> 控制器的作用域中才有效的  <code>shiftFout()</code> 行为可以对继承自父级作用域中的属性 <code>dataValue</code> 进行修改。但子控制器将会覆盖与父控制器中同名的属性或者行为。</p>
<hr>
<h4 id="数据继承"><a href="#数据继承" class="headerlink" title="数据继承"></a>数据继承</h4><p>值得注意的是 AngularJS 对作用域上的数据值的继承的处理方式以及使用 <code>ng-model</code> 指令对其的影响。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$scope.dataValue = &quot;Hello, Jack&quot;;</span><br><span class="line">&lt;input ng-model=&quot;dataValue&quot; class=&quot;form-control&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>当读取一个直接在作用域上定义的属性的值时，AngularJS 会沿着作用域链去检查该属性。而当使用 <code>ng-model</code> 指令来修改这样一个属性时，AngularJS 会检查当前作用域是否存在该名称的属性，如果没有，便会隐形创建一该属性，结果便会覆盖父级中的同名属性。</p>
<p>_如果想要数据值在开始时是共享的但在修改时会被复制一份，就直接在作用域上定义数据属性。如果想确保始终只有一份数据值，可以通过以对象来定义数据属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$scope.data = &#123;</span><br><span class="line">		dataValue: &quot;hello, world!&quot;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">&lt;input ng-model=&quot;data.dataValue&quot; class=&quot;form-control&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>如果使用在顶层控制器中使用对象来定义数据属性，那么便会使用 javascript 的 <strong>基于原型</strong> 的继承关系。</p>
<p><a href="">清单5-1</a></p>
<hr>
<h4 id="使用多控制器"><a href="#使用多控制器" class="headerlink" title="使用多控制器"></a>使用多控制器</h4><p><a href="https://github.com/onejustone/SimpleAngularDemo/blob/master/src/AngularJS(5" target="_blank" rel="noopener">清单5-2</a>%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/%E6%B8%85%E5%8D%955-2.html)</p>
<p>使用多控制器，每一个都应用于独立的 HTML 元素，意味着各个控制器之间是相互独立的，彼此不共享作用域，也不继承数据或行为。此时，若想在每个控制器创建的作用域之间进行通信则必须使用到根作用域。</p>
<hr>
<h3 id="0x02-使用无作用域控制器"><a href="#0x02-使用无作用域控制器" class="headerlink" title="0x02 使用无作用域控制器"></a>0x02 使用无作用域控制器</h3><p>对于 AngularJS 也可以不使用作用域的情况下向视图提供数据和行为，取而代之的是一个提供给视图的代表控制器的特殊变量。</p>
<p><a href="https://github.com/onejustone/SimpleAngularDemo/blob/master/src/AngularJS(5" target="_blank" rel="noopener">清单5-3</a>%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/%E6%B8%85%E5%8D%955-3.html)</p>
<p>如上清单所示，在控制器中并未声明对 <code>$scope</code> 的依赖，而是通过 javascript 的关键字 <code>this</code> 定义了自己的数据值和行为。</p>
<p>而当应用无作用域控制器时，<code>ng-controller</code> 指令的表达式需要指定一代表控制器的变量名:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;well&quot; ng-controller=&quot;simpleCtrl as ctrl&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>表达式上的格式形如 <em>&lt;要应用的控制器&gt; as &lt;变量名&gt;</em>,然后在视图中使用 <code>ctrl</code> 变量访问数据和行为。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input class=&quot;form-control&quot; ng-model=&quot;ctrl.dataValue&quot;&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x03-显示的更新作用域"><a href="#0x03-显示的更新作用域" class="headerlink" title="0x03 显示的更新作用域"></a>0x03 显示的更新作用域</h3><p>通过显示的更新作用以实现对其更直接的控制，可以将 AngularJS 和其它的 javascript 框架结合起来。</p>
<p>作用域集成方法:</p>
<ul>
<li><code>$watch(expression, handler)</code>: 注册一个处理函数，当 <code>expression</code> 表达式所引用的值变化时，该函数将被通知到；</li>
<li><code>$watchCollection(object, handler)</code>: 注册一个处理函数，当指定的 <code>object</code> 对象的任意属性变化时，该函数将被通知到；</li>
<li><code>$apply(expression)</code>: 向作用域应用变化。</li>
</ul>
<p><a href="https://github.com/onejustone/SimpleAngularDemo/blob/master/src/AngularJS(5" target="_blank" rel="noopener">清单5-4</a>%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/%E6%B8%85%E5%8D%955-4.html)</p>
<p>如上，清单中编写了对 AngularJS 复选框的响应，以便启用或者禁用 jQuery UI 按钮，核心代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$scope.$watch(&apos;buttonEnabled&apos;, function (newValue) &#123;</span><br><span class="line">            $(&apos;#jqui button&apos;).button(&#123;</span><br><span class="line">            	disabled: !newValue</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>
<p><code>$wacth</code> 方法提供了对外集成的手段，作用域上的某个变化可以触发调用另一个框架中的相应变化。</p>
<blockquote>
<p>$watch 方法的第一个参数是一表达式，AngularJS 会计算它并找出你想计算什么。其实也可以是一个函数，该函数会产生一个属性名，但也意味着如果想直接指定一个属性的话就必需使用字符串。 </p>
</blockquote>
<p><code>$apply</code> 方法则提供了对内集成的手段，如此在其他框架中的变化就可以引起 AngularJS 中的相应变化。</p>
<p>比如，对按钮单击进行计数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">angular.element(angularRegion).scope().$apply(&apos;handleClick()&apos;);</span><br></pre></td></tr></table></figure>
<p>AngularJS 提供了 <code>angular.element</code> 方法，只有对其传递一个所关心元素的 <code>id</code>,就可以得到一个定义了 <code>scope</code> 方法的对象，并返回所需要的作用域。</p>
<p>找到作用域以后调用 <code>$apply</code> 方法来调用 <code>handleClick</code> 行为。必须通过 <code>$apply</code> 方法指定一个表达式，以便让作用域知道产生的变化并传播给所绑定的表达式。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/05/前端之坑(1)之原生JavaScript/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/05/前端之坑(1)之原生JavaScript/" itemprop="url">前端之坑(1)之原生JavaScript</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-05T00:00:00+08:00">
                2017-01-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-原生JavaScript"><a href="#0x00-原生JavaScript" class="headerlink" title="0x00 原生JavaScript"></a>0x00 原生JavaScript</h3><hr>
<h4 id="0x00-undefined-amp-amp-null"><a href="#0x00-undefined-amp-amp-null" class="headerlink" title="0x00 undefined &amp;&amp; null"></a>0x00 undefined &amp;&amp; null</h4><p>JS 定义了两个特别的值，<code>undefined</code> 和 <code>null</code>。当试图读取没有赋值的变量或试图取不存在的对象属性时会返回 <code>undefined</code>。</p>
<p>而对于 <code>null</code>，好吧，这是个神奇的符号，它可以是基本的值 <code>null</code>,也可以是对象 <code>null</code>,它是 JS 原型链的顶层，所有的对象都是在它之下衍生出来的，它无处不在又变化多端，所以在此只记录其与 <code>undefined</code> 的区别。</p>
<p>由于 JS 的强制类型转换，下布尔环境中，<code>null</code> 与 <code>undefined</code> 都会被转换为 <code>fasle</code>。</p>
<p>所以，有时会遇到如下情况:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">console.log( null == undefined);</span><br><span class="line">// true</span><br></pre></td></tr></table></figure>
<p>所以，并不是说 <code>null</code> 和 <code>undefinde</code> 是相等，只是它们都被转换为了布尔值.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">console.log( null === undefined);</span><br><span class="line">// false</span><br></pre></td></tr></table></figure>
<p>但是多数情况下，我们并不关心一个值到底是 <code>null</code> 还是 <code>undefined</code> ，因为这两种情况我都需要排除掉，那么这时可以使用 <strong>if</strong> 语句和否定运算符 <strong>(!)</strong> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(!myData.name)&#123;</span><br><span class="line">    //do something</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="0x01-DOM-操作"><a href="#0x01-DOM-操作" class="headerlink" title="0x01 DOM 操作"></a>0x01 DOM 操作</h3><hr>
<h4 id="0x00-element-style-height"><a href="#0x00-element-style-height" class="headerlink" title="0x00 element.style.height"></a>0x00 element.style.height</h4><p>对于 <code>element.style.height</code> 只能在 div 在行内样式设置了 <code>height</code> 才能读取,如果 <code>height</code> 值不写在行内样式（即是若没有在 <code>html</code> 和用 <code>js</code> 设置 <code>height</code> 时），<code>style.height</code>为 <strong>undefind</strong>，无法获取；</p>
<p>所以在需要获得元素的高度时,推荐使用 <code>ele.offsetHeight</code>。</p>
<blockquote>
<p>同样 <code>ele.style.width</code> 存在同样的问题。</p>
</blockquote>
<p>不定期更新。。。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/03/AngularJS(0)极速入门/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/03/AngularJS(0)极速入门/" itemprop="url">AngularJS(0)极速入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-03T00:00:00+08:00">
                2017-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-内置指令"><a href="#0x00-内置指令" class="headerlink" title="0x00 内置指令"></a>0x00 内置指令</h3><p>AngularJS 指令是扩展的 HTML 属性，带有前缀 <strong>ng</strong>。</p>
<h6 id="ng-app"><a href="#ng-app" class="headerlink" title="ng-app"></a>ng-app</h6><p>初始化一个 Angular 应用程序</p>
<h6 id="ng-init"><a href="#ng-init" class="headerlink" title="ng-init"></a>ng-init</h6><p>初始化应用程序数据。通常情况下，不使用 ng-init。而是使用一个控制器或模块来代替它。</p>
<h6 id="ng-model"><a href="#ng-model" class="headerlink" title="ng-model"></a>ng-model</h6><p>指令把元素值（比如输入域的值）绑定到应用程序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html ng-app&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div ng-init=&quot;name=&apos;Jack&apos;&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; ng-model=&quot;name&quot;&gt;</span><br><span class="line">        &lt;p&gt;&lt;b&gt;&#123;&#123;name&#125;&#125;&lt;/b&gt;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script src=&quot;../angular.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>如上， <code></code> 表达式是一个 AngularJS 数据绑定表达式。<code></code> 通过 <code>ng-model = &quot;name&quot;</code> 进行同步。</p>
<h6 id="ng-repeat"><a href="#ng-repeat" class="headerlink" title="ng-repeat"></a>ng-repeat</h6><p>重复一个 HTML 元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--ng-repeat--&gt;</span><br><span class="line">    &lt;div ng-init=&quot;arr=[&apos;first&apos;, &apos;second&apos;, &apos;third&apos;]&quot;&gt;</span><br><span class="line">        &lt;p&gt;循环对象&lt;/p&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li ng-repeat=&quot;x in arr&quot;&gt;</span><br><span class="line">                &#123;&#123;x&#125;&#125;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x01-自定义指令"><a href="#0x01-自定义指令" class="headerlink" title="0x01 自定义指令"></a>0x01 自定义指令</h3><p> AngularJS 内置的指令外，我们还可以使用 <code>.directive</code> 来创建自定义指令。</p>
<h6 id="directive"><a href="#directive" class="headerlink" title=".directive"></a>.directive</h6><p>使用驼峰法来命名一个指令， <code>myDirective</code>, 但在使用它时需要以 <code>-</code> 分割, <code>my-directive</code>:</p>
<p>要调用自定义指令，HTML 元素上需要添加自定义指令名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app=&quot;myApp&quot;&gt;</span><br><span class="line">        &lt;my-directive&gt;&lt;/my-directive&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        var app = angular.module(&quot;myApp&quot;, [])</span><br><span class="line">        app.directive(&quot;myDirective&quot;, function () &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                template: &quot;&lt;h1&gt;自定义指令&lt;/h1&gt;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>你可以通过以下方式来调用指令：</p>
<ul>
<li>元素名 [E]: <code>&lt;my-directive&gt;&lt;/my-directive&gt;</code></li>
<li>属性 [A]: <code>&lt;div my-directive&gt;&lt;/div&gt;</code></li>
<li>类名 [C]: <code>&lt;div class=&quot;my-directive&quot;&gt;&lt;/div&gt;</code></li>
<li>注释 [M]: <code>&lt;!-- directive: my-directive --&gt;</code></li>
</ul>
<h6 id="restrict"><a href="#restrict" class="headerlink" title="restrict"></a>restrict</h6><p>如下，我们可以使用限制指令 <code>resrict</code> 规定只能以某种特性的方式调用.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">return &#123;</span><br><span class="line">    restrict: &quot;A&quot;,</span><br><span class="line">    template: template: &quot;&lt;h1&gt;自定义指令&lt;/h1&gt;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>restrict</code> 默认值为 EA, 即可以通过元素名和属性名来调用指令。</p>
<hr>
<h3 id="0x02-ng-model-指令"><a href="#0x02-ng-model-指令" class="headerlink" title="0x02 ng-model 指令"></a>0x02 ng-model 指令</h3><p><code>ng-model</code> 指令用于绑定应用程序数据到 HTML 控制器(input, select, textarea)的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app=&quot;myApp&quot; ng-controller=&quot;myCtrl&quot;&gt;</span><br><span class="line">        名字: &lt;input ng-model=&quot;name&quot;&gt;</span><br><span class="line">        &lt;h1&gt;你输入了: &#123;&#123;name&#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        var app = angular.module(&apos;myApp&apos;, []);</span><br><span class="line">        app.controller(&apos;myCtrl&apos;, function($scope) &#123;</span><br><span class="line">            $scope.name = &quot;John Doe&quot;;</span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line"></span><br><span class="line">    &lt;p&gt;修改输入框的值，标题的名字也会相应修改。&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x03-控制器-Controller"><a href="#0x03-控制器-Controller" class="headerlink" title="0x03 控制器 Controller"></a>0x03 控制器 Controller</h3><p>AngularJS 应用程序被控制器控制。我们可以使用 <strong>ng-controller</strong> 指令定义控制器。</p>
<p>AngularJS 控制是一个由 JavaScript 创建的对象，所以其内部当然可以包含属性和方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div id=&quot;appBox&quot; ng-app=&quot;myApp&quot; ng-controller=&quot;personCtrl&quot;&gt;</span><br><span class="line">        姓: &lt;input type=&quot;text&quot; ng-model=&quot;firstName&quot;&gt;</span><br><span class="line">        名: &lt;input type=&quot;text&quot; ng-model=&quot;lastName&quot;&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;hr&gt;</span><br><span class="line">        姓名: &#123;&#123;sayName()&#125;&#125;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        var app = angular.module(&apos;myApp&apos;, []);</span><br><span class="line">        app.controller(&apos;personCtrl&apos;, function($scope) &#123;</span><br><span class="line">            $scope.firstName = &quot;马&quot;;</span><br><span class="line">            $scope.lastName = &quot;云&quot;</span><br><span class="line">            $scope.sayName = function () &#123;</span><br><span class="line">                return $scope.firstName + $scope.lastName;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">    &lt;p&gt;在输入框的值，名字也会同步显示。&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>如上, <code>ng-app</code> 定义了一个 AngularJS 应用程序，该程序运行在 <code>div#appBox</code> 中，并使用 <code>ng-controller</code> 定义了一个控制器。</p>
<p>当然，在大型项目中，都是将应用程序存放在外部文件中的，然后再在 <code>app.html</code> 中引入就行了:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// personControl.js </span><br><span class="line">/**</span><br><span class="line"> * Created by onejustone on 2017/1/4.</span><br><span class="line"> */</span><br><span class="line">angular.module(&apos;myApp&apos;, [])</span><br><span class="line">    .controller(&apos;personCtrl&apos;, function ($scope) &#123;</span><br><span class="line">        $scope.firstName = &apos;马&apos;</span><br><span class="line">        $scope.lastName = &apos;云&apos;</span><br><span class="line">        $scope.sayName = function () &#123;</span><br><span class="line">            return $scope.firstName + $scope.lastName</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// index.html</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div ng-app=&quot;myApp&quot; ng-controller=&quot;personCtrl&quot;&gt;</span><br><span class="line">        姓: &lt;input type=&quot;text&quot; ng-model=&quot;firstName&quot;&gt;</span><br><span class="line">        名: &lt;input type=&quot;text&quot; ng-model=&quot;lastName&quot;&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;hr&gt;</span><br><span class="line">        姓名: &#123;&#123;sayName()&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script src=&quot;../controllers/personController.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x04-过滤器-Filter"><a href="#0x04-过滤器-Filter" class="headerlink" title="0x04 过滤器 Filter"></a>0x04 过滤器 Filter</h3><p>过滤器可以使用一个 <strong>管道字符 ( | )</strong> 添加到表达式和指令中。</p>
<p>Angular 过滤器可以转换数据，下面是其内置的几种过滤器:</p>
<ul>
<li><code>currency</code>: 格式化数字为货币格式。</li>
<li><code>filter</code>: 从数组项中选择一个子集。</li>
<li><code>lowercase</code>: 格式化字符串为小写。</li>
<li><code>uppercase</code>: 格式化字符串为大写。</li>
<li><code>orderBy</code>: 根据某个表达式排列数组。</li>
</ul>
<p>来看看下面的例子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// index.html</span><br><span class="line">&lt;div ng-app=&quot;myApp&quot; ng-controller=&quot;myCtrl&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; ng-model=&quot;test&quot;&gt;</span><br><span class="line">       &lt;p ng-repeat=&quot;x in names | filter:test | orderBy:country&quot;&gt;</span><br><span class="line">           &#123;&#123;(x.name | uppercase) + x.country&#125;&#125;</span><br><span class="line">       &lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;../controllers/myController.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">// myController.js</span><br><span class="line">angular.module(&apos;myApp&apos;, [])</span><br><span class="line">    .controller(&apos;myCtrl&apos;, function ($scope) &#123;</span><br><span class="line">        $scope.names = [&#123;name:&apos;Jani&apos;,country:&apos;Norway&apos;&#125;,</span><br><span class="line">            &#123;name:&apos;Hege&apos;,country:&apos;Sweden&apos;&#125;,</span><br><span class="line">            &#123;name:&apos;Kai&apos;,country:&apos;Denmark&apos;&#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x05-模块-Module"><a href="#0x05-模块-Module" class="headerlink" title="0x05 模块 Module"></a>0x05 模块 Module</h3><p>我们可以把模块看作一个容器，模块定义了一个应用程序，而这个应用程序是模块中不同部分的容器。</p>
<p>所以，可以把控制器也看作是模块的一部分，那么我们自然也可以把控制器与模块与拆开：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div ng-app=&quot;myApp&quot; ng-controller=&quot;myCtrl&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; ng-model=&quot;test&quot;&gt;</span><br><span class="line">       &lt;p ng-repeat=&quot;x in names | filter:test | orderBy:country&quot;&gt;</span><br><span class="line">           &#123;&#123;(x.name | uppercase) + x.country&#125;&#125;</span><br><span class="line">       &lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script src=&quot;../controllers/myApp.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;../controllers/myController.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>注意 <code>myApp.js</code> 与 <code>myController.js</code> 的引入顺序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// myApp.js</span><br><span class="line">/**</span><br><span class="line"> * Created by onejustone on 2017/1/4.</span><br><span class="line"> */</span><br><span class="line">var myApp = angular.module(&quot;myApp&quot;, [])</span><br></pre></td></tr></table></figure>
<p>在模块定义中 <code>[]</code> 参数用于定义模块的依赖关系。<br>中括号 <code>[]</code> 表示该模块没有依赖，如果有依赖的话会在中括号写上依赖的模块名字。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// myController.js</span><br><span class="line">myApp.controller(&apos;myCtrl&apos;, function ($scope) &#123;</span><br><span class="line">        $scope.names = [&#123;name:&apos;Jani&apos;,country:&apos;Norway&apos;&#125;,</span><br><span class="line">            &#123;name:&apos;Hege&apos;,country:&apos;Sweden&apos;&#125;,</span><br><span class="line">            &#123;name:&apos;Kai&apos;,country:&apos;Denmark&apos;&#125;]</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x06-依赖注入"><a href="#0x06-依赖注入" class="headerlink" title="0x06 依赖注入"></a>0x06 依赖注入</h3><p>Angular 使用以下五个核心组件来实现依赖注入:</p>
<ul>
<li><code>value</code>： Value 是一个简单的 javascript 对象，用于向控制器传递值（配置阶段）：</li>
<li><code>factory</code>：是一个函数用于返回值。在 service 和 controller 需要时创建。<br>通常我们使用 factory 函数来计算或返回值。</li>
<li><code>provider</code>: AngularJS 中通过 provider 创建一个 service、factory等(配置阶段)。</li>
<li><code>service</code>:</li>
<li><code>constant</code>: constant(常量)用来在配置阶段传递数值，注意这个常量在配置阶段是不可用的。</li>
</ul>
<hr>
<h3 id="0x07-路由"><a href="#0x07-路由" class="headerlink" title="0x07 路由"></a>0x07 路由</h3><p>AngularJS 路由允许我们通过不同的 URL 访问不同的内容。而正是得益于路由功能，才能让我们实现多视图的单页 Web 应用（single page web application，SPA）。</p>
<p>值得注意的是，通常我们的 URL 形式为 <code>http://onejustone.xyz/first/page</code>，但在单页 Web 应用中 AngularJS 通过 <strong># + 标记</strong> 实现，如: <code>http://onejustone.xyz/#/first</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/02/JS服务器编程(6)JSONP/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/02/JS服务器编程(6)JSONP/" itemprop="url">JS服务器编程(6)JSONP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-02T15:32:00+08:00">
                2017-01-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0X00-JSONP"><a href="#0X00-JSONP" class="headerlink" title="0X00 JSONP"></a>0X00 JSONP</h3><p>JSOP 是 JSON with padding (填充式 json 或者 参数式 json 的缩写)，是应用 json 的一种新方法。 JSONP 只不过是被包含在函数调用中的 JSON。</p>
<p>JSONP 由两部分组成: 回调函数和数据。回调函数是当响应到来时应该在页面中调用的函数，而回调函数的名字一般是在请求中指定的。而数据就是传入的 JSON 数据。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/01/Linux缓冲区溢出/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/01/Linux缓冲区溢出/" itemprop="url">Linux缓冲区溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-01T18:30:00+08:00">
                2017-01-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h3><p>其实无论是 Windows 还是 Linux ，当我们对目标进行渗透的时候针对的都是运行目标系统上的软件的，而不是 OS 本身的系统级别的漏洞，那太牛逼了，这事儿应该是 FBI 或者 NAS 玩儿的。</p>
<hr>
<h3 id="0x01-Linux-下的环境准备"><a href="#0x01-Linux-下的环境准备" class="headerlink" title="0x01 Linux 下的环境准备"></a>0x01 Linux 下的环境准备</h3><ul>
<li>目标软件: CrossFire（穿越火线）,一款在线多人 RPG 游戏，其 1.9.0 版本的服务端接受入站 socket 连接(客户端向服务器发起连接)时存在缓冲区溢出漏洞</li>
<li>调试工具： edb</li>
<li>运行平台: Kali i486(CPU 32位)(不是 64 位的Kali哦！)</li>
</ul>
<p>我们选择 Kali i486 目标是，32 位 CPU 的最大寻址空间是 2^32 次方，而 64 位是 2^64 次方，差的不是一点点啊。</p>
<hr>
<h4 id="安装-CrossFire"><a href="#安装-CrossFire" class="headerlink" title="安装 CrossFire"></a>安装 CrossFire</h4><p>因为 CrossFire 是一个游戏软件，而在 Linux 系统中是所有游戏都有一个指定的存放目录 <code>/usr/games</code> 下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop# mv crossfire.tar.gz /usr/games/</span><br><span class="line">root@kali:~/Desktop# cd /usr/games/</span><br><span class="line">root@kali:/usr/games# tar zxpf crossfire.tar.gz </span><br><span class="line">root@kali:/usr/games# cd crossfire/</span><br><span class="line">root@kali:/usr/games/crossfire# ls</span><br><span class="line">bin  etc  lib  man  share  var</span><br><span class="line">root@kali:/usr/games/crossfire# cd bin/</span><br><span class="line">root@kali:/usr/games/crossfire/bin# ./crossfire</span><br><span class="line">// 执行 crossfire 文件，以运行软件</span><br><span class="line">// 看到如下信息，代表运行成功</span><br><span class="line">Waiting for connections...</span><br><span class="line"></span><br><span class="line">root@kali:~# netstat -pantu</span><br><span class="line">// 通过 netstat 命令，查看 corssfire 运行在哪个端口上</span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:13327           0.0.0.0:*               LISTEN      2766/./crossfire</span><br></pre></td></tr></table></figure>
<p>我们主要针对该游戏服务器端的下的 <code>crossfire/bin/crossfire</code> 文件。</p>
<p>打开 Kali 中 <code>edb</code> 调试工具，在 <code>Appicaiton -&gt; Reverse Engineering</code> 中。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1571420-4ecd1d5e1d9df61c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="edb"></p>
<p>可以看到，其操作界面与 Windows 平台下的 <code>Debugger</code> 相差无几。</p>
<hr>
<h4 id="Linux-内核的保护机制"><a href="#Linux-内核的保护机制" class="headerlink" title="Linux 内核的保护机制"></a>Linux 内核的保护机制</h4><p>于 Windows 一样,Linux 也具有自己的内存保护机制，比如 DEP，ASLR，堆栈cookies，堆栈粉碎等等。</p>
<hr>
<h4 id="配置防火墙设置仅本机访问"><a href="#配置防火墙设置仅本机访问" class="headerlink" title="配置防火墙设置仅本机访问"></a>配置防火墙设置仅本机访问</h4><p>我们在自己的计算机上运行一个具有缓冲区漏洞的软件，而当我们暴露在网络中时，这样很有可能会导致我们自己被而已利用。 </p>
<p>下面，我们将对 Linux 自带的 Iptables 防火墙添加对应的规则，规定只要本机才可以访问 13327 端口:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# iptables -A INPUT -p tcp --destination-port 13327 \! -d 127.0.0.1 -j DROP</span><br><span class="line">// 为 crossfire 增加规则</span><br><span class="line">root@kali:~# iptables -A INPUT -p tcp --destination-port 4444 \! -d 127.0.0.1 -j DROP</span><br><span class="line">// 4444 端口为后续的 shellcode 做准备</span><br></pre></td></tr></table></figure>
<p>使用 <code>iptables -L</code> 查看防火墙配置是否生效：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# iptables -L</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DROP       tcp  --  anywhere            !localhost            tcp dpt:13327</span><br><span class="line">DROP       tcp  --  anywhere            !localhost            tcp dpt:4444</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x02-开始调试"><a href="#0x02-开始调试" class="headerlink" title="0x02 开始调试"></a>0x02 开始调试</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/31/Glup/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/31/Glup/" itemprop="url">Glup(1)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-31T09:45:00+08:00">
                2016-12-31
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-What’s-Gulp"><a href="#0x00-What’s-Gulp" class="headerlink" title="0x00 What’s Gulp"></a>0x00 What’s Gulp</h3><p>Gulp 是<strong>基于流的自动化构建工具</strong>。</p>
<blockquote>
<p>开发者可以使用它在项目开发过程中自动执行常见任务。Gulp.js 是基于 Node.js 构建的，利用 Node.js 流的威力，你可以快速构建项目并减少频繁的 IO 操作。Gulp.js 源文件和你用来定义任务的 Gulp 文件都是通过 JavaScript（或者 CoffeeScript ）源码来实现的。</p>
</blockquote>
<p>Gulp 是基于流的，Gulp 对文件的操作就像水管之于水流，水流流经水管，水管将水水流改变成不同的形状。</p>
<hr>
<h3 id="0x01-基于流的-Gulp"><a href="#0x01-基于流的-Gulp" class="headerlink" title="0x01 基于流的 Gulp"></a>0x01 基于流的 Gulp</h3><p>何为 <strong>流</strong>,请参考:</p>
<p>安装 glup: <a href="http://www.gulpjs.com.cn/docs/getting-started/" target="_blank" rel="noopener">http://www.gulpjs.com.cn/docs/getting-started/</a></p>
<p>我们来看看 Gulp 是如何控制和操作流的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;</span><br><span class="line"></span><br><span class="line">var gulp = require(&apos;gulp&apos;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;sync1&apos;, function () &#123;</span><br><span class="line">	console.log(&quot;I am a sync task&quot;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;async&apos;, function (done) &#123;</span><br><span class="line">	setTimeout(function () &#123;</span><br><span class="line">		console.log(&quot;I am a async task&quot;)</span><br><span class="line">		done()</span><br><span class="line">    &#125;, 2000)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>我们可以看到，GUlp 是以任务开始的，<code>gulp.task</code> 可以定义一个任务，然后在命令行下使用 <code>gulp 任务名</code> 就可以执行对应的任务了:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">D:\blog</span><br><span class="line">λ  gulp sync1</span><br><span class="line">[10:30:07] Using gulpfile D:\blog\gulpfile.js</span><br><span class="line">[10:30:07] Starting &apos;sync1&apos;...</span><br><span class="line">I am a sync task</span><br><span class="line">[10:30:07] Finished &apos;sync1&apos; after 724 μs</span><br><span class="line">D:\blog</span><br><span class="line">λ  gulp async</span><br><span class="line">[10:30:14] Using gulpfile D:\blog\gulpfile.js</span><br><span class="line">[10:30:14] Starting &apos;async&apos;...</span><br><span class="line">I am a async task</span><br><span class="line">[10:30:16] Finished &apos;async&apos; after 2 s</span><br></pre></td></tr></table></figure>
<p>Gulp 的任务可以是同步和异步，在异步任务中确定任务完成，可以通过调用函数参数 <code>done()</code> 来实现。</p>
<p>此外，<code>gulp.task</code> 可以有依赖，只要第二个参数传入一个数组，中间加上依赖的任务就行了，而数组里面的这些任务是并行处理的，不会一个执行完才执行另一个（同步任务的输出比异步任务的结束早）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;</span><br><span class="line"></span><br><span class="line">var gulp = require(&apos;gulp&apos;)</span><br><span class="line"></span><br><span class="line">var through = require(&apos;through2&apos;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;sync1&apos;, function () &#123;</span><br><span class="line">	console.log(&apos;i am a sync&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;sync2&apos;, function () &#123;</span><br><span class="line">	console.log(&apos;i am a second sync&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;sync3&apos;, function () &#123;</span><br><span class="line">	console.log(&apos;i am a third sync&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;async&apos;, function (done) &#123;</span><br><span class="line">	console.log(&apos;ready...&apos;)</span><br><span class="line">	setTimeout(function () &#123;</span><br><span class="line">		console.log(&apos;Fire!&apos;)</span><br><span class="line">		done()</span><br><span class="line">    &#125;, 2000)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;asyncs&apos;, [&apos;async&apos;, &apos;sync1&apos;, &apos;sync2&apos;, &apos;sync3&apos;], function (done) &#123;</span><br><span class="line">	console.log(&apos;ok, task all done&apos;)</span><br><span class="line">	done()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如上，我们组合了多个任务,以通过 gulp 依赖进行了并行处理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">D:\blog</span><br><span class="line">λ  gulp asyncs</span><br><span class="line">[11:04:40] Using gulpfile D:\blog\gulpfile.js</span><br><span class="line">[11:04:40] Starting &apos;async&apos;...</span><br><span class="line">ready...</span><br><span class="line">[11:04:40] Starting &apos;sync1&apos;...</span><br><span class="line">i am a sync</span><br><span class="line">[11:04:40] Finished &apos;sync1&apos; after 545 μs</span><br><span class="line">[11:04:40] Starting &apos;sync2&apos;...</span><br><span class="line">i am a second sync</span><br><span class="line">[11:04:40] Finished &apos;sync2&apos; after 291 μs</span><br><span class="line">[11:04:40] Starting &apos;sync3&apos;...</span><br><span class="line">i am a third sync</span><br><span class="line">[11:04:40] Finished &apos;sync3&apos; after 207 μs</span><br><span class="line">Fire!</span><br><span class="line">[11:04:42] Finished &apos;async&apos; after 2 s</span><br><span class="line">[11:04:42] Starting &apos;asyncs&apos;...</span><br><span class="line">ok, task all done</span><br><span class="line">[11:04:42] Finished &apos;asyncs&apos; after 240 μs</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x02-I-O-处理"><a href="#0x02-I-O-处理" class="headerlink" title="0x02 I/O 处理"></a>0x02 I/O 处理</h3><p>除了以上的基本任务模式。对于每个 task, Gulp 通常通常用来操作文件输入和输出流，因此 Gulp 封装了批量操作文件流的 API：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;</span><br><span class="line"></span><br><span class="line">let gulp = require(&apos;gulp&apos;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;src-dist&apos;, function () &#123;</span><br><span class="line">	gulp.src(&quot;./*.js&quot;)</span><br><span class="line">		.pipe(gulp.dest(&apos;./public&apos;))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>上面的命令表示将当前目录下所有的 <code>.js</code> 文件匹配出来，依次输出到目标文件夹 <code>./public</code> 中去。</p>
<p>更高级一点，还可以将当前目录及其所有子目录中的文件提取出来:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;</span><br><span class="line"></span><br><span class="line">let gulp = require(&apos;gulp&apos;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;src-dist&apos;, function () &#123;</span><br><span class="line">	gulp.src(&quot;./**/*.js&quot;)</span><br><span class="line">		.pipe(gulp.dest(&apos;./public&apos;))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x03-Gulp-技巧"><a href="#0x03-Gulp-技巧" class="headerlink" title="0x03 Gulp 技巧"></a>0x03 Gulp 技巧</h3><p>下面一个在开发环境中能够用到的 gulpfile.js 配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">var gulp=require(&quot;gulp&quot;),</span><br><span class="line">	webserver=require(&quot;gulp-webserver&quot;),</span><br><span class="line">	livereload=require(&quot;gulp-livereload&quot;),</span><br><span class="line">	sass=require(&quot;gulp-ruby-sass&quot;),</span><br><span class="line">	uglify=require(&quot;gulp-uglify&quot;);</span><br><span class="line"></span><br><span class="line">// 注册任务：</span><br><span class="line">gulp.task(&quot;webserver&quot;,function()&#123;</span><br><span class="line">	gulp.src(&apos;./dist&apos;).pipe(webserver(&#123;</span><br><span class="line">		livereload:true,</span><br><span class="line">		open:true</span><br><span class="line">	&#125;))</span><br><span class="line">&#125;);</span><br><span class="line">// html任务：</span><br><span class="line">gulp.task(&quot;html&quot;,function()&#123;</span><br><span class="line">	return gulp.src(&quot;src/**/*.html&quot;)</span><br><span class="line">	.pipe(gulp.dest(&quot;dist&quot;));</span><br><span class="line">	//指明源文件路径并输出到发布环境</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// sass任务：</span><br><span class="line">gulp.task(&quot;sass&quot;,function()&#123;</span><br><span class="line">	return sass(&quot;src/sass/*.scss&quot;,&#123;style:&quot;compact&quot;&#125;)</span><br><span class="line">	.on(&quot;error&quot;,function(err)&#123;</span><br><span class="line">		console.log(&quot;编译出错&quot;,err.message);</span><br><span class="line">	&#125;)</span><br><span class="line">	.pipe(gulp.dest(&quot;dist/css&quot;))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// script压缩任务：</span><br><span class="line">gulp.task(&quot;script&quot;,function()&#123;</span><br><span class="line">	return gulp.src(&quot;src/js/*.js&quot;)</span><br><span class="line">			.pipe(uglify(&#123;preserveComment:&quot;some&quot;&#125;)) //压缩并保留注释</span><br><span class="line">			.pipe(gulp.dest(&quot;dist/js&quot;))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 监听任务：</span><br><span class="line">gulp.task(&quot;watch&quot;,function()&#123;</span><br><span class="line">	gulp.watch(&quot;*.html&quot;,[&quot;html&quot;]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//默认执行任务：</span><br><span class="line">gulp.task(&quot;default&quot;,[&quot;sass&quot;,&quot;webserver&quot;,&quot;html&quot;,&quot;script&quot;,&quot;watch&quot;]);</span><br></pre></td></tr></table></figure>
<p>更多的高级用法请参看官方文档。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/31/webpack独立打包与缓存处理/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/31/webpack独立打包与缓存处理/" itemprop="url">webpack独立打包与缓存处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-31T09:42:00+08:00">
                2016-12-31
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="工程目录"><a href="#工程目录" class="headerlink" title="工程目录"></a>工程目录</h3><p>webpack 是一个集前端自动化，模块化，组件化于一体的可扩展系统，你可以更据自己的需求来进行一系列的配置和安装，最终实现想要的功能并打包输出。</p>
<p>假如有如下工程目录:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.webpackdeo</span><br><span class="line">├── app</span><br><span class="line">│   ├── hello.js</span><br><span class="line">│   ├── index.html</span><br><span class="line">│   └── index.js</span><br><span class="line">├── package.json</span><br><span class="line">├── webpack.config.js</span><br><span class="line">└── yarn.lock</span><br></pre></td></tr></table></figure>
<p><code>hello.js</code> 的内容是:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const str = &apos;hello world!&apos;</span><br><span class="line"></span><br><span class="line">module.exports = str;</span><br></pre></td></tr></table></figure>
<p><code>index.js</code> 的内容是:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const $ = require(&apos;jquery&apos;)</span><br><span class="line">const str = require(&apos;./hello&apos;)</span><br><span class="line"></span><br><span class="line">function main () &#123;</span><br><span class="line">    $(&apos;body&apos;).html(str)</span><br><span class="line">&#125;</span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<p>即 <code>index.js</code> 文件会引用 <code>jquery</code> 和 <code>hello.js</code> 文件。</p>
<h3 id="web-config-js"><a href="#web-config-js" class="headerlink" title="web.config.js"></a>web.config.js</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by root on 17-4-1.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">const webpack = require(&apos;webpack&apos;)</span><br><span class="line">const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;)</span><br><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * webpack --config webpack.config.js</span><br><span class="line"> * 对应的简化命令是 webpack</span><br><span class="line"> *</span><br><span class="line"> * webpack -p 打包的同时压缩文件</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        // 多个入口</span><br><span class="line">        main: &apos;./app/index.js&apos;,</span><br><span class="line">        // 主程序入口</span><br><span class="line">        vendor: [&apos;jquery&apos;]</span><br><span class="line">        // 加入 vendor 属性，用于配置打包第三方类库，写入数组的类库名将统一打包到一个文件里</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &apos;[name].[hash].js&apos;,</span><br><span class="line">        // 将生成的文件用 [name] 变量来自动生成文件名</span><br><span class="line">        // [chunkHash:5] 为打包后的文件名添加 hash 值，保证每次修改后打包的文件 hash 值将改变，避免浏览器使用缓存文件</span><br><span class="line">        path: path.resolve(__dirname, &apos;dist&apos;)</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line"></span><br><span class="line">        new webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">            // 优化 JavaScript 代码</span><br><span class="line">            compress: &#123;</span><br><span class="line">                // 去除代码内的警告语句</span><br><span class="line">                warnings: false</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">        new webpack.optimize.OccurrenceOrderPlugin(/*优先考虑使用最多的模块，并为其分配最小的 ID*/),</span><br><span class="line">        // webpack2 中 UglifyPlugin 的 compress 选项默认为 false 并且 OccurrenceOrderPlugin 默认启用</span><br><span class="line">        new webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">            // CommonsChunkPlugin 插件，用于提取 vendor，可以看到 jquery 被提取到 vendor.js 中了</span><br><span class="line">            names: [&apos;vendor&apos;,&apos;manifest&apos;]</span><br><span class="line">            // manifest.js 是 webpack 的启动文件代码，他会直接影响到 hash 值，将其独立出来，这样 vendor 的 hash 就不会改变了</span><br><span class="line">        &#125;),</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            // HtmlWebpackPlugin 用于动态更新 html 页面中引入的各种模块名称</span><br><span class="line">            template: &apos;app/index.html&apos;</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="设置-package-json-文件启动-webpack"><a href="#设置-package-json-文件启动-webpack" class="headerlink" title="设置 package.json 文件启动 webpack"></a>设置 package.json 文件启动 webpack</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;webpack --config webpack.config.js&quot;,</span><br><span class="line">    &quot;dev&quot;: &quot;webpack-dev-server --devtool eval --progress --colors --hot --content-base build&quot;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>最后，运行 <code>npm build</code> 打包工程:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">webpackdemo</span><br><span class="line">├── app</span><br><span class="line">│   ├── hello.js</span><br><span class="line">│   ├── index.html</span><br><span class="line">│   └── index.js</span><br><span class="line">├── dist</span><br><span class="line">│   ├── index.html</span><br><span class="line">│   ├── main.8ea27c786c7c81172664.js</span><br><span class="line">│   ├── manifest.8ea27c786c7c81172664.js</span><br><span class="line">│   └── vendor.8ea27c786c7c81172664.js</span><br><span class="line">├── package.json</span><br><span class="line">├── webpack.config.js</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/30/从一个博客说起(3)Express中间件/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="onejustonee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="onejustone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/30/从一个博客说起(3)Express中间件/" itemprop="url">从一个博客说起(2)Express中间件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-30T20:30:00+08:00">
                2016-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/technology/" itemprop="url" rel="index">
                    <span itemprop="name">technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x00-中间件"><a href="#0x00-中间件" class="headerlink" title="0x00 中间件"></a>0x00 中间件</h3><p>Express 使用中间件(middleware) 来处理请求，当一个中间件处理完，可以通过调用 next() 传递给下一个中间件，如果没有调用 <code>next()</code>，则请求不会往下传递，如内置的 <code>res.render</code> 其实就是渲染完 <code>html</code><br>直接返回给客户端，没有调用 <code>next()</code>，便不会有传递给下一个中间件。</p>
<blockquote>
<p><code>express@4</code> 之前的版本基于 <code>connect</code> 这个模块实现的中间件的架构，<code>express@4</code> 及以上的版本则移除了对 <code>connect</code> 的依赖自己实现了。此外，中间件也是有加载顺序的。</p>
</blockquote>
<hr>
<h3 id="0x01-错误处理"><a href="#0x01-错误处理" class="headerlink" title="0x01 错误处理"></a>0x01 错误处理</h3><p>Express 内置了一个默认的错误处理器，我们可以手动控制返回的错误内容，加载一个自定义错误处理的中间件:</p>
<h5 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&apos;express&apos;)</span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">// 错误处理</span><br><span class="line">app.use(function(err, req, res,next)&#123;</span><br><span class="line">   // err 是自定义的错误处理中间件</span><br><span class="line">   if (err) &#123;</span><br><span class="line">        console.log(err.stack);</span><br><span class="line">   &#125;</span><br><span class="line">   res.status(500).send(&apos;Something worry&apos;)</span><br><span class="line">&#125;</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/33/">33</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">onejustonee</p>
              <p class="site-description motion-element" itemprop="description">onejustone's blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">329</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">103</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">onejustonee</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
