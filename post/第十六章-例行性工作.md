---
title: 第十六章-例行性管理
date: 2016-04-27 11:00
tags: ['鸟哥的Linux读书笔记基础篇']
toc: true
categories: technology

---
### 0x00 what's 例行性工作?
例行性安排就是计划任务了，简单的讲就是计划一些将来需要执行的程序，我们设置好时间，Linux会负责执行的！

---
### 0x01 仅运行一次的工作安排:at
at 是个可以处理仅运行一次就结束排程的命令,不过，并不是所有的人都可以进行 at 工作排程,因为安全性问题哈，所以可以利用 /etc/at.allow 与 /etc/at.deny 这两个文件来进行 at 的使用限制
* 先找寻 **/etc/at.allow** 这个文件，写在这个文件中的使用者才能使用 at，没有在这个文件中的使用者则不能使用at 
* 如果 /etc/at.allow 不存在，就寻找** /etc/at.deny** 这个文件，若写在这个at.deny 的使用者则不能使用 at ，而没有在这个 at.deny 文件中的使用者，就可以使用	at 咯
* 如果两个文件都不存在，那么只有 root 可以使用 at 这个命令

```
root@jack:~# at now +5 minutes
#root@jack:~# at 23:00 2016-5-1
warning: commands will be executed using /bin/sh
at> ping www.sina.com >> pingsina.txt
at> <EOT>
job 6 at Wed Apr 27 09:49:00 2016
```
五分钟以后ping sina.com并将结果保存到pingsina.txt文件里
当我们输入at命令以后，会进去一个at shell的工作环境里，所以当我们在次at里在写入例行程序时最好使用绝对路径哈！

然后，使用atq查询at工作安排
```
root@jack:~# atq
6	Wed Apr 27 09:49:00 2016 a root
```
最后，使用atrm + 例行程序id，atq查询所得的前面的数字代表了该例行程序的ID:
```
root@jack:~# atrm 7
```

---
### 0x02 循环运行的工作安排 
 at 是仅运行一次的工作，循环运行的例行性工作排程则是由 cron (crond)这个系统服务来控制的,由於使用者自己也可以进行例行性工作排程，so, Linux 也提供使用者控制例行性工作排程的命(crontab)

与 at 同样的，我们可以限制使用 crontab 的使用者帐号:
* /etc/cron.allow将可以使用 crontab 的帐号写入其中，若不在这个文件内的使用者则不可使用 crontab
* /etc/cron.deny在文件下的账号均不可使用crontab

#### crontab

__{ Usage $ : crontab [-u username] [-l | e | -r] }__

* -u:只有root才能运行这个任务
* -e:编辑crontab的工作内容
* -l:查询工作内容
* -r :移除所有工作内容

假若你的女朋友生日是 5 月 2 日，你想要在 5 月 1 日的 23:59 发一封信给他，这封信的内容已经写在 /home/dmtsai/lover.txt 内了
```
root@jack:~# crontab -e
59 23 1 5 * mail kili </home/jack/birthday.txt>
crontab: installing new crontab
root@jack:~# crontab -l
59 23 1 5 * mail kili </home/jack/birthday.txt>
```

crontab -e主要是针对使用者的，如果要是对系统经行例行行安排那么请直接修改/etc/crontab文件就行了

```
root@jack:~# cat /etc/crontab
# /etc/crontab: system-wide crontab
# m h dom mon dow user	command
17 *	* * *	root    cd / && run-parts --report /etc/cron.hourly
25 6	* * *	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6	* * 7	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )#
```

``


