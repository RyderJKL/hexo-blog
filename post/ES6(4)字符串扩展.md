---
title: ES6(4)字符串扩展   
date: 2016-12-25  
tags: ['ES6']
toc: true
categories: technology

---
### 0x00 字符串遍历接口
ES6 为字符串添加了遍历器接口，使得字符串可以使用 `for...of` 循环遍历。

```
for (let codePoint of 'foo'){
    console.log(codePoint)
// 'f'
// 'o'
// 'o/
```

---
### 0x01 模板字符串 Template String
ES6 新特性，增强型模板字符串，使用反引号(`)标识。它可以当作普通字符串使用，也可以用来定义多行字符串，或者在字符串中嵌入变量。

```
let basket = {
    count:3,
    onSale:5
}
$("#result").append(`
    There are <b>${basket.count}</b>
    items in your basket,
    <em>${basket.onSale}</em> are on sale!
`)
```

模板字符串中嵌入变量，需要将变量名写在 `${}` 之中。

模板字符串中的所有的空格，新行，缩进都会原样输出在生成的字符串中。

其实，不只是变量，大括号内部可以放入任意的JavaScript表达式，可以进行运算，以及引用对象属性。


---
#### 标签模板 Tagged Template
模板字符串还可以紧跟在一个函数名后面，该函数将被调用来处理这个模板字符串。这被称为 **标签模板** 功能（tagged template）。

标签模板其实不是模板，而是函数调用的一种特殊形式。**标签** 指的就是函数，紧跟在后面的模板字符串就是它的参数。

比如:

```
alert`123`

// 等同于 
alert(123)
```

但，若是 "标签" 之后又有变量，那就不是那么简单的了。

```
let a = 5
let b = 10
tag`hello ${a +b} world ${a * b}`
```

如上 `tag` 是一个函数,整个表达式的返回值，就是tag函数处理模板字符串后的返回值。变量替换只发生在数组的第一个成员与第二个成员之间、第二个成员与第三个成员之间，以此类推。


`tag` 函数的第一个参数是一个数组，该数组的成员是模板字符串中那些没有变量替换的部分。

`tag` 函数的其他参数，都是模板字符串各个变量被替换后的值。

`tag` 函数所有参数的实际值如下:

* 第一个参数: `['hello', 'world', ' ']`
* 第二参数: `15`
* 第三参数: `50`


`tag` 函数实际上以下面的形式调用:

```
tag(['Hello ', ' world ', ''], 15, 50)
```

我们来看一个更复杂的例子:

```
let total = 30
let msg = passthru`The total is ${total} (${total*5} with tax)`

function  passthru(literals) {
    let result = ''
    let i = 0

    console.log(literals)
    console.log(arguments)

    while (i < literals.length){
        result += literals[i++]
        if (i < arguments.length){
            result += arguments[i]
        }
    }

    return result

}

console.log(msg)
```

上面这个例子，展示了如何将各个参数按照原来的位置拼合回去。

输出结果：

```
["The total is ", " (", " with tax)", raw: Array[3]]
[Array[3], 30, 150]
he total is 30 (150 with tax)
```

值得注意的是 `literals` 是一个数组，并且是 `arguments` 中元素之一。



