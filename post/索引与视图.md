---
title: SQL索引与视图
date: 2016-07-05 16:26
tags: ['SQL查询的艺术','索引与视图']
toc: true
categories: technology

---
### 0x00 索引基础

为了提高检索数据的能力，数据库引入了索引机制。索引是一个单独的，物理的数据库结构，是数据库的一个表中所包含的值得列表，注明了表的各个值所在的存储位置。

实际上，一个表的存储是由两部分组成的，一部分用来存放表的数据页面，另一个部分存放索引页面。通常，索引页面相对数据页面来说小得多。当进行数据检索时，系统先搜索索引页面，从中找到所需数据的指针，再通过指针从页面数据中读取数据。

可以把数据库看作一本书，把索引看作书的目录。

---
#### 索引的结构
按照存储结构的不同索引可分为两类，簇索引(ClusteredIndex)和非簇索引(Nonclustre Index)。

* __簇索引__

簇索引与数据是混为一体的，它对表的物理数据页中的数据按列进行排序，然后重新存储到磁盘上，它的叶子节点存储的是实际的数据。

由于对表中的数据一一进行了排序，所以簇索引查找数据很快，但是所需的存储空间也很大，约为数据所占空间的1.2倍。

* __非簇索引__

非簇索引与表的数据完全分离。非簇索引不必将物理数据页中的数据安装列排序，非簇索引值存储关键字的值和行定位器。

由于非簇索引使用索引页存储，比簇索引需要更多的存储空间，其检索效率较低。

表的数据行只能以一种排序方式存储在磁盘上，所以一个表只能有一个簇索引。


---
### 0x01 索引的使用

创建索引的基本语句:

```
CREATED INDEX index_name
ON table_name (colum_name,....)
```

---
#### 非簇索引的使用

##### 为StudentInfo中的sname字段创建非簇索引

```
CREATE INDEX Name_Index
ON StudentInfo (sname)
```

##### 非簇索引的使用
当一个表建立了多个索引以后，数据库优化器会自动决定在查询期间使用哪个索引，当然也可以强制使用某种索引。

```
SELECT colunm1
FROM tabel_name
WITH (INDEX (index_name))
WHERE condition
```

不过，对于查询表中的所有记录，使用索引是毫无意义的。

当数据库表被删除时，和它相关的所有也会被删除。

##### 多字段非簇索引

为StudentInfo表中的性别(sex)和姓名(name)两个字段建立一个索引SexName_Index。

```
CREATE INDEX SexNname_Index
ON StudentInfo (sex,name)
```

##### UNIQUE创建唯一索引

唯一索引是指不允许在两行中存在相同的索引值。所以，如果使用INSERT或者UPDATE在拥有唯一索引的数据中生成一个重复值时，插入或者更新会被终止。

为StudentInfo表中的学号(sno)字段创建唯一索引Sno_Index,且指定降序排序。

```
CREATE UNIQUE INDEX Sno_Index
ON StudentInfo (sno DESC)
```


---
#### CLUSTERDE创建簇索引

不同于非簇索引，簇索引改变了表中数据存放的物理位置。簇索引不仅对索引中的键子值进行排序，而且对表中的行排序，以便使其与索引的排序相匹配。

##### 创建单字段簇索引

为StudentInfo表中的姓名(Sname)字段创建簇索引SnameCluseter_Index。

```
CREATE CLUSTERED SnameCluseter_Index
ON StudentInfo (Sname)
```

##### 创建多字段索引

为StudentInfo表中的sex和address字段创建簇索引SexAddressCluseter_Index。当然，先得删除已有的簇索引Snameclusteter_Index。

```
DROP INDEX StudentInfo.Snamecluseter_Index
CREATE CLUSTERED INDEX SexAddresscluseter_index
on studentinfo (sex,address)
```

---
#### drop索引销毁

无论簇索引还是非簇索引都可以通过DROP INDEX关键字销毁。

```
drop index studentinfo.name_index
```

销毁索引时记得一定要指明索引所在的表的名字。



---
### 0x02 视图

视图不是一个真实存在的基础表，而是一张虚表。它是从一个或者多个表中导出的表，其结构和数据是建立在对表的查询基础上的。

视图有很多优点，主要表现咋简化操作，定制数据，合并分隔数据，安全性等方面。

##### 创建视图
创建一个与studentinfo表具有相同信息的视图studentinfo_view。

```
create view studentinfo_view
as
select * from studentinfo
```

##### 为视图创建视图
为视图studentinfo_view包含的所有男同学创建一个视图boy_view。

```
create view boy_view
as
select * from studentinfo_view
where sex='man'
```

##### 为一列或多列创建视图

```
create view NameAddress_View
as
select snam,address
from studentinfo
```

##### 创建与表具有不同字段名的视图

```
create view new_view(boy_name,boy_address,sex)
as
select sname,address,sex
from studentinfo
where sex='man'
```

##### 利用视图简化表的复杂连接
创建一个视图，包含Studentinfo表中的姓名(sname)字段，recruitinfo表中的系名(dname)以及department表中的录取分数(score)信息。

```
create view join_view
as
select snam,dname,score
from studentinfo,departmet,recruitinfo
where studentinfo.address=recruitinfo.address
and studentinfo.dno=deparentmet.dno
```

---
#### 销毁视图

可以通过drop view关键字销毁创建的视图

```
drop view view_name
```




---
### 0x03 视图的创建与销毁


